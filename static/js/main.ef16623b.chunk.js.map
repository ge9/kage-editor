{"version":3,"sources":["kageUtils/glyph.ts","args.ts","actions/drag.ts","actions/select.ts","reducers/select.ts","kageUtils/freehand.ts","kageUtils/connection.ts","kageUtils/transform.ts","../kage-engine-npm/lib/buhin.js","../kage-engine-npm/lib/polygons.js","../kage-engine-npm/lib/polygon.js","../kage-engine-npm/lib/util.js","../kage-engine-npm/lib/pointmaker.js","../kage-engine-npm/lib/fit-curve.js","../kage-engine-npm/lib/bezier.js","../kage-engine-npm/lib/fontcanvas.js","../kage-engine-npm/lib/gothic.js","../kage-engine-npm/lib/stroketype.js","../kage-engine-npm/lib/2d.js","../kage-engine-npm/lib/mincho.js","kageUtils/reflectrotate.ts","../kage-engine-npm/lib/kage.js","actions/editor.ts","callapi.ts","kage.ts","kageUtils/bbx.ts","selectors/draggedGlyph.ts","reducers/drag.ts","kageUtils/stretchparam.ts","kageUtils/decompose.ts","kageUtils/stroketype.ts","kageUtils/match.ts","reducers/editor.ts","actions/display.ts","reducers/display.ts","actions/undo.ts","reducers/index.ts","reducers/undo.ts","store.ts","xorMask.ts","components/XorMasks.tsx","components/Grid.tsx","components/Stroke.tsx","components/Glyph.tsx","components/StrokeCenterLine.tsx","components/ControlPoint.tsx","components/SelectionControl.tsx","components/AreaSelectRect.tsx","components/GlyphArea.tsx","components/SelectionInfo.tsx","selectors/submitGlyph.ts","components/SubmitPreview.tsx","components/EditorControls.tsx","components/PartsList.tsx","components/PartsSearch.tsx","components/SubmitForm.tsx","components/OptionModal.tsx","App.tsx","shortcuts.ts","reportWebVitals.ts","i18n.ts","index.tsx"],"names":["getNumColumns","strokeType","unparseGlyphLine","glyphLine","values","value","map","num","Math","round","partName","join","parseGlyph","glyphStr","split","line","glyphLineStr","splitLine","numColumns","i","push","floor","parseGlyphLine","filter","gLine","length","unparseGlyph","glyph","args","URLSearchParams","window","location","hash","slice","host","get","ssl","name","related","edittime","data","summary","gwHosts","document","referrer","referrerUrl","URL","includes","protocol","e","RectPointPosition","sanitizedArgs","actionCreator","actionCreatorFactory","selectActions","selectSingle","selectAddSingle","selectRemoveSingle","selectNone","selectAll","selectDeselected","selectPrev","selectNext","updateBuilder","builder","case","state","index","selection","concat","index2","_gLine","firstSelected","min","max","snapped","dragActions","startBackgroundDrag","startSelectionDrag","startPointDrag","startResize","mouseMove","mouseUp","updateCTMInv","connectablePairs","position","strokeTypes","shapeTypes","matchConnectablePoint","point","shapeType","getConnectablePoints","result","coord","pointIndex","endPointIndex","listupConnectedPoints","memoizeOne","points","sPoints","lineIndex","sPoint","forEach","dPoint","some","point2","point1","filter1","filter2","glyph1","points1","glyph2","points2","every","listupConnectedPointsOfSelection","selectedDescs","applyGlyphLineOperation","tX","tY","applyGlyphPointOperation","pdescs","newGlyph","newValue","moveSelectedGlyphLines","dx","dy","targetDescs","x","y","moveSelectedPoint","selectedDesc","targetDesc","resizeSelectedGlyphLines","oldBBX","newBBX","x11","y11","x12","y12","x21","y21","x22","y22","resizeGlyphLine","avg","nums","reduce","a","b","sum","lerp","x1","x2","k","norm2","drawFreehand","startX","startY","endX","endY","lastStroke","newLastStroke","centroidX","centroidY","midX","midY","dis","sqrt","abs","correctStroke","mid1X","mid1Y","mid2X","mid2Y","startType","endType","ev","undefined","minVal","Infinity","datum","val","minBy","leftBottomX","leftBottomY","dx1","dy1","dx2","dy2","cosAngle","newStroke","snapStrokeStart","snapStrokeEnd","snapStrokeTilt","snapToNewStroke","setGlyphValue","column","newGLine","snapVerticalStroke","vertStroke","leftType","middleType","rightType","ti","xi","yi","nx","ny","minX","maxX","minY","maxY","horiStroke","y1","y2","snapHorizontalStroke","midStartShape","rightStartShape","snapStrokeSegmentTilt","point1Index","x1i","y1i","x2i","y2i","sx1","sy1","sx2","sy2","Buhin","number","this","set","Polygons","array","Array","polygon","minx","maxx","miny","maxy","error","isNaN","newArray","shift","temp","polygons","buffer","get_sub_path_svg","get_path_svg","get_sub_path_svg_font","Date","j","Polygon","off","Object","p","reverse","poly","unshift","mode","bez_cir","widfun","t","wid","widfun_d","widfun_stop","widfun_stop_d","get_dir","sin","cos","rad","atan2","DIR_POSX","DIR_NEGX","moved_point","dir","delta","get_extended_dest","destX","destY","srcX","srcY","get_extended_dest_wrong","destX_new","destY_new","v","atan","unit_normal_vector","ix","iy","ia","ib","ir","vector_to_len","l","len","get_rad","PI","rad_to_vector","stretch_bezier_end","bez","bezier_to_y","res","c","d","yy","solveCubic","sort","shorten_bezier_to_y","extend_bezier_to_y","D","roots","q","cuberoot","u","acos","pow","stretch","dp","sp","p1","p2","p3","p4","getBoundingBox","strokes","PointMaker","scale","fitCubic_tang","tangents","progressCallback","bezCurve","uPrime","maxError","prevErr","splitPoint","prevSplit","dist","leftTangent","rightTangent","maths","mulItems","vectorLen","subtract","addArrays","generateAndReport","chordLengthParameterize","reparameterize","errChange","paramsOrig","paramsPrime","parameters","maxDist","count","t_distMap","mapTtoRelativeDistances","find_t","bezier","computeMaxError","A","C","X","det_C0_C1","det_C0_X","det_X_C1","alpha_l","alpha_r","epsilon","segLength","tmp","ux","firstPoint","lastPoint","zeros_Xx2x2","dot","generateBezier","params","maxErr","maxPoint","qprime","numerator","mulMatrix","denominator","squareItems","qprimeprime","newtonRaphsonRootFind","currU","prevU","prevP","B_parts","B_t_curr","B_t_dist","B_t_prev","sumLen","param","lenMin","tMax","tMin","zs","items","multiplier","m1","m2","arr1","arr2","addition","hypot","divisor","divItems","ctrlPoly","tx","pA","pB","pC","pD","bezier_steps","Bezier","x_fun","y_fun","dx_fun","dy_fun","width_func","width_func_d","a1","a2","tang1","tang2","tt","vx","vy","deltad","velocity","width_rad","dir_func","sx","sy","generalBezier","rad_begin","rad_end","generalBezier2","dir_x","dir_y","ex","ey","width_tan","bez_tan","rad1","rad2","slantBezier","bez1","FontCanvas","inside","kMinWidthT","push2","vec","kagekMinWidthY","kagekWidth","rad_offset","offs_sin","offs_cos","new_dir","setscale","setdir","setpos","drawOpenBegin_curve_down2","x2m","tailX","tailY","r","tan1","tan2","vec1","vec2","kMinWidthT2","kagekL2RDfatten","type","pm","length_param","urokoX","urokoY","halfWidth","off_left1","off_right1","off_left2","off_right2","curve_step","cBezier","bez2","bez_to_poly","qBezier","qBezier2","Gothic","size","kRate","kWidth","kKakato","kMage","glyphData","cv","drawStroke","getPolygons","s","a3","x3","y3","x4","y4","tx1","ty1","gothicDrawLine","gothicDrawCurve","tx2","ty2","tx3","ty3","tx4","ty4","drawCBezier","ta1","ta2","drawQBezier","drawLine","STROKETYPE","STARTTYPE","ENDTYPE","isCross","b1","c1","b2","c2","getCrossPoint","isCrossBox","bx1","by1","bx2","by2","isCrossBoxWithOthers","strokesArray","isCrossWithOthers","ReflectRotateType","Mincho","kMinWidthY","kL2RDfatten","kAdjustKakatoL","kAdjustKakatoR","kAdjustKakatoRangeX","kAdjustKakatoRangeY","kAdjustKakatoStep","kAdjustUrokoX","kAdjustUrokoY","kAdjustUrokoLength","kAdjustUrokoLengthStep","kAdjustUrokoLine","kAdjustUroko2Step","kAdjustUroko2Length","kAdjustTateStep","kAdjustMageStep","tempdata","splice","drawAdjustedStroke","strokesArrays","cp","other_groups","flat","others","console","log","dir12","dir23","dir34","flip_left_right","flip_up_down","rotate90","rotate180","rotate270","param_uroko","adjustUrokoParam","param_uroko2","adjustUroko2Param","uroko_max","drawUroko_h","drawUroko","poly_end","param_tate","adjustTateParam","kMinWidthT_m","poly_start","getStartOfVLine","right2","left2","getEndOfOffsetLine","new_x2","param_hane","adjustHaneParam","drawTurnLeft","getEndOfLine","param_kakato","adjustKakatoParam","drawNewGTHbox_v","m","drawNewGTHbox","drawLowerRightHT_v","drawLowerRightHT","addPolygon","x1ext","y1ext","drawOpenBegin_curve_down","drawOpenBegin_curve_up","drawUpperRightCorner2","drawUpperLeftCorner","a2temp","adjustKirikuchiParam","minchoDrawCurve","drawTailCircle","drawTurnUpwards_pos","drawL2RSweepEnd","param_mage","adjustMageParam","kMinWidthT_mage","drawOffsetLine","drawCircle_bend_pos","drawCircle_bend_neg","drawTurnUpwards_neg","rate","drawUpperRightCorner","minchoDrawBezier","x4ex","y4ex","drawTailCircle_tan","x1pre","y1pre","x2pre","y2pre","thin_stop_param","enddir","bez1e","bez1c2","bez2s","bez2c1","widfun_fat","widfun_fat_d","right1","left1","getStartOfOffsetLine","drawUpperRightCorner_straight_v","drawOpenBegin_straight","getStartOfLine","stroke","other","ty","tlen","pressure","epx","epy","nearest","FONTTYPE","Kage","kBuhin","setFont","kFont","buhin","search","makeGlyph2","kageStrokes","getStrokes","subdata","getPolygonsSeparated","textData","columns","getStrokesOfBuhin","box","editorActions","loadedBuhin","loadedStretchParam","changeStrokeType","changeHeadShapeType","changeTailShapeType","changeStretchCoeff","changeReflectRotateOpType","swapWithPrev","swapWithNext","insertPart","paste","copy","cut","delete","decomposeSelected","moveSelected","toggleFreehand","escape","finishEdit","callApi","path","fetch","response","ok","Error","text","getSource","encodeURIComponent","query","kage_","getKage","buhinMap","fallback","shotai","kShotai","waiting","Set","loadAbsentBuhin","has","add","then","source","stretchMatch","exec","store","dispatch","catch","err","filteredGlyphIsEqual","gLine1","makeGlyphSeparated_","makeGlyphSeparated","map1","shotai1","map2","shotai2","makeGlyphSeparatedFactory","isEqual","makeGlyphSeparatedForSubmit","bbxOfPoints","xs","ys","getGlyphLineBBX","mergeBBX","getGlyphLinesBBX","glyphLines","gLines1","gLines2","resizeSelected","selectedGlyphLine","north","west","south","east","southeast","newGlyphLine","minSize","draggedGlyphSelector","createSelector","dragSelection","dragPoint","resizeSelection","freehandStroke","evt","ctmInv","clientX","clientY","freehandMode","areaSelectRect","lastX","lastY","intersections","polygonsSep","gAreaPolygon","gPolygon","polygonInPolygon","polygonIntersectsPolygon","performAreaSelect","newSelection","from","getStretchPositions","setStretchPositions","positions","normalizeStretchPositions","calcStretchScalar","x0","y0","decomposeDeepGlyph","getEachStrokes","a2_100","kirikuchiAdjustment","tateAdjustment","a3_100","opt3","mageAdjustment","decomposeDeep","headShapeTypes","1","2","3","4","6","7","tailShapeTypes","validStrokeShapeTypes","isValidStrokeShapeTypes","s0","s1","s2","MatchType","reflectRotateTypes","reflectX","reflectY","reflectRotateTypeParamsMap","setGlyphLine","newMap","Map","stretchParamMap","newType","oldType","oldNumPoints","newNumPoints","xm","ym","xm1","ym1","xm2","ym2","selectedLine","stretchParam","calcStretchPositions","opType","clipboard","targetLines","newLines","buhinSource","failedBuhin","kage","getBox","isStretchEnabled","oldGlyphLine","stretchedX","stretchedY","px1","py1","px2","py2","revX","revY","decompose","subindex","showOptionModal","exitEvent","displayActions","openOptionModal","closeOptionModal","setGridDisplay","setGridOriginX","setGridOriginY","setGridSpacingX","setGridSpacingY","setShotai","setStrokeCenterLineDisplay","setXorMaskType","grid","display","originX","originY","spacingX","spacingY","showStrokeCenterLine","xorMaskType","undoActions","undo","redo","initialState","undoStacks","reducer","reducerWithInitialState","default","oldState","action","newState","glyphLine1","glyphLine2","value1","pushUndo","undoable","withHandling","select","drag","editor","createStore","xorMaskShapeMap","none","circle","squareWithRoundedCorners","square","diamond","xorMaskTypes","keys","XorMasks","maskType","id","Grid","useSelector","className","StrokeComponent","props","GlyphComponent","nonSelection","_polygons","onMouseDown","handleMouseDownDeselectedStroke","Stroke","xlinkHref","clipPath","handleMouseDownSelectedStroke","StrokeCenterLine","getMatchType","isOnline","match","online","ControlPoint","width","height","handleMouseDown","selectionControlSelector","rectControl","pointControl","selectedStrokes","multiSelect","coords","selectedStroke","matchType","SelectionControl","useDispatch","handleMouseDownRectControl","useCallback","stopPropagation","handleMouseDownNorthPoint","handleMouseDownWestPoint","handleMouseDownSouthPoint","handleMouseDownEastPoint","handleMouseDownSoutheastPoint","handleMouseDownPointControls","useMemo","_control","AreaSelectRect","rect","GlyphArea","svgClassName","handleMouseDownCapture","ctm","currentTarget","getScreenCTM","pt","createSVGPoint","ictm","inverse","evtx","evty","matrixTransform","handleMouseDownBackground","shiftKey","ctrlKey","preventDefault","useEffect","handleMouseMove","handleMouseUp","addEventListener","removeEventListener","viewBox","onMouseDownCapture","selectedGlyphLineSelector","draggedGlyph","strokeInfoSelector","headShapeType","tailShapeType","validTypes","coordString","partInfoSelector","entityName","aliasMatch","stretchCoeff","reflectRotateInfoSelector","find","param1","param2","otherInfoSelector","selectedStroke_","isMultiple","selectIndexStringSelector","glyphLength","selectedIndexString","buttonsDisabledSelector","swapPrevDisabled","swapNextDisabled","selectPrevDisabled","selectNextDisabled","SelectionInfo","strokeInfo","partInfo","reflectRotateInfo","otherInfo","selectIndexString","shallowEqual","useTranslation","onChange","entity","disabled","onClick","submitGlyphSelector","SubmitPreview","submitGlyph","EditorControls","undoDisabled","redoDisabled","pasteDisabled","decomposeDisabled","options","nativeEvent","getImageURL","PartsList","handleItemClick","handleItemMouseEnter","handleImageClick","dataset","handleImageMouseEnter","names","alt","title","data-name","src","loading","onMouseEnter","searchSuggestions","initialQuery","QueryTooShortError","initialSearchState","PartsSearch","queryInputRef","useRef","useState","searchState","setSearchState","startSearch","reason","newSearchState","currentSearchState","handleSearch","current","handleFormSubmit","hoverNameRef","textContent","onSubmit","defaultValue","list","ref","suggestion","message","glyphName","formAction","formStyle","visibility","SubmitForm","formRef","submit","style","method","ReactModal","setAppElement","OptionModal","handleRequestClose","handleGridDisplayChange","checked","handleGridOriginXChange","valueAsNumber","handleGridOriginYChange","handleGridSpacingXChange","handleGridSpacingYChange","handleShotaiChange","handleStrokeCenterLineChange","handleXorMaskTypeChange","i18n","handleLanguageChange","changeLanguage","isOpen","onRequestClose","shouldCloseOnEsc","language","App","useHotkeys","useShortcuts","lang","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","resources","translation","lng","use","initReactI18next","init","fallbackLng","returnObjects","interpolation","escapeValue","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.ef16623b.chunk.js","sourcesContent":["export interface GlyphLine {\n  value: number[];\n  partName?: string;\n}\n\nexport const getNumColumns = (strokeType: number): number => {\n  switch (strokeType) {\n    case 0:\n    case 1:\n    case 9:\n      return 7;\n    case 2:\n    case 3:\n    case 4:\n      return 9;\n    case 6:\n    case 7:\n    case 99:\n      return 11;\n    default:\n      return 0;\n  }\n};\n\nexport const parseGlyphLine = (glyphLineStr: string): GlyphLine => {\n  const splitLine = glyphLineStr.split(':');\n  const strokeType = +splitLine[0];\n  const numColumns = getNumColumns(strokeType);\n  const value = [];\n  for (let i = 0; i < numColumns; i++) {\n    value.push(Math.floor(+splitLine[i] || 0));\n  }\n  if (value[0] === 99) {\n    const partName = splitLine[7] || '';\n    return { value, partName }\n  }\n  return { value };\n};\n\nexport const unparseGlyphLine = (glyphLine: GlyphLine): string => {\n  const values: (number | string)[] = glyphLine.value.map((num) => Math.round(num));\n  if (values[0] === 99) {\n    values[7] = glyphLine.partName || '';\n  }\n  return values.join(':');\n};\n\nexport const isValidGlyphLine = (glyphLine: GlyphLine): boolean => (\n  glyphLine.value.length !== 0 &&\n  (\n    glyphLine.value[0] !== 0 ||\n    glyphLine.value[1] === 97 || glyphLine.value[1] === 98 || glyphLine.value[1] === 99\n  )\n);\n\n\nexport type Glyph = GlyphLine[];\n\nexport const parseGlyph = (glyphStr: string): Glyph => (\n  glyphStr.split(/[$\\r\\n]+/)\n    .map((line) => parseGlyphLine(line))\n    .filter((gLine) => isValidGlyphLine(gLine))\n);\n\nexport const unparseGlyph = (glyph: Glyph): string => (\n  glyph\n    .map((gLine) => unparseGlyphLine(gLine))\n    .join('$')\n);\n\nexport const isGlyphDeepEqual = (glyph1: Glyph, glyph2: Glyph) => (\n  glyph1 === glyph2 || (\n    glyph1.length === glyph2.length &&\n    glyph1.every((glyphLine1, index) => {\n      const glyphLine2 = glyph2[index];\n      return glyphLine1 === glyphLine2 || (\n        glyphLine1.partName === glyphLine2.partName &&\n        glyphLine1.value.length === glyphLine2.value.length &&\n        glyphLine1.value.every((value1, index) => value1 === glyphLine2.value[index])\n      );\n    })\n  )\n);\n\n\nexport interface PointDescriptor {\n  lineIndex: number;\n  pointIndex: number;\n}\n","const args = new URLSearchParams(window.location.hash.slice(1));\n\nlet host = args.get('host');\nlet ssl = args.get('ssl') !== 'false';\nconst name = args.get('name');\nconst related = args.get('related') || 'u3013';\nconst edittime = args.get('edittime');\nconst data = args.get('data') || '';\nconst summary = args.get('summary') || '';\n\nconst gwHosts = [\n  'glyphwiki.org',\n  'en.glyphwiki.org',\n  'ko.glyphwiki.org',\n  'zhs.glyphwiki.org',\n  'zht.glyphwiki.org',\n  'non-ssl.glyphwiki.org',\n];\n\nif (!host && document.referrer) {\n  try {\n    const referrerUrl = new URL(document.referrer);\n    if (gwHosts.includes(referrerUrl.host)) {\n      host = referrerUrl.host;\n      ssl = referrerUrl.protocol === 'https:';\n    }\n  } catch (e) {\n  }\n}\n\nif (!host || !gwHosts.includes(host)) {\n  host = 'glyphwiki.org';\n}\n\nconst sanitizedArgs = {\n  host,\n  ssl,\n  name,\n  related,\n  edittime,\n  data,\n  summary,\n};\n\nexport default sanitizedArgs;\n","import actionCreatorFactory from 'typescript-fsa';\n\nexport type CTMInv = (x: number, y: number) => [number, number];\nexport enum RectPointPosition {\n  north,\n  south,\n  east,\n  west,\n  southeast,\n}\n\nconst actionCreator = actionCreatorFactory('EDITOR');\n\nexport const dragActions = {\n  startBackgroundDrag: actionCreator<React.MouseEvent>('BACKGROUND_DRAG_START'),\n  startSelectionDrag: actionCreator<React.MouseEvent>('SELECTION_DRAG_START'),\n  startPointDrag: actionCreator<[React.MouseEvent, number]>('MOVE_POINT_START'),\n  startResize: actionCreator<[React.MouseEvent, RectPointPosition]>('RESIZE_START'),\n\n  mouseMove: actionCreator<MouseEvent>('MOUSE_MOVE'),\n  mouseUp: actionCreator<MouseEvent>('MOUSE_UP'),\n\n  updateCTMInv: actionCreator<CTMInv>('UPDATE_CTMINV'),\n}\n","import actionCreatorFactory from 'typescript-fsa';\n\nconst actionCreator = actionCreatorFactory('SELECT');\n\nexport const selectActions = {\n  selectSingle: actionCreator<number>('SELECT_SINGLE'),\n  selectAddSingle: actionCreator<number>('SELECT_ADD_SINGLE'),\n  selectRemoveSingle: actionCreator<number>('SELECT_REMOVE_SINGLE'),\n  selectNone: actionCreator('SELECT_NONE'),\n  selectAll: actionCreator('SELECT_ALL'),\n  selectDeselected: actionCreator('SELECT_TOGGLE_ALL'),\n  selectPrev: actionCreator('SELECT_PREV'),\n  selectNext: actionCreator('SELECT_NEXT'),\n};\n","import { ReducerBuilder } from 'typescript-fsa-reducers';\n\nimport { selectActions } from '../actions/select';\n\nimport { AppState } from '.';\n\nconst updateBuilder = (builder: ReducerBuilder<AppState>) => builder\n  .case(selectActions.selectSingle, (state, index) => ({\n    ...state,\n    selection: [index],\n  }))\n  .case(selectActions.selectAddSingle, (state, index) => ({\n    ...state,\n    selection: state.selection.includes(index) ? state.selection : state.selection.concat([index]),\n  }))\n  .case(selectActions.selectRemoveSingle, (state, index) => ({\n    ...state,\n    selection: state.selection.filter((index2) => index !== index2),\n  }))\n  .case(selectActions.selectAll, (state) => ({\n    ...state,\n    selection: state.glyph.map((_gLine, index) => index),\n  }))\n  .case(selectActions.selectDeselected, (state) => ({\n    ...state,\n    selection: state.glyph.map((_gLine, index) => index).filter((index) => !state.selection.includes(index)),\n  }))\n  .case(selectActions.selectNone, (state) => ({\n    ...state,\n    selection: [],\n  }))\n  .case(selectActions.selectPrev, (state) => {\n    if (state.glyph.length === 0) {\n      return { ...state, selection: [] };\n    }\n    const firstSelected = state.selection.length === 0 ? 0 : Math.min(...state.selection);\n    return {\n      ...state,\n      selection: [(firstSelected - 1 + state.glyph.length) % state.glyph.length],\n    };\n  })\n  .case(selectActions.selectNext, (state) => {\n    if (state.glyph.length === 0) {\n      return { ...state, selection: [] };\n    }\n    const firstSelected = state.selection.length === 0 ? -1 : Math.max(...state.selection);\n    return {\n      ...state,\n      selection: [(firstSelected + 1 + state.glyph.length) % state.glyph.length],\n    };\n  });\n\n\nexport default updateBuilder;\n","import { Glyph, GlyphLine } from './glyph';\nimport { applyGlyphLineOperation } from './transform';\n\nconst sum = (nums: number[]) => nums.reduce((a, b) => a + b, 0);\nconst avg = (nums: number[]) => sum(nums) / nums.length;\nconst min: {\n  (data: number[]): number;\n  <T>(data: T[], ev: (val: T) => number): number;\n} = (data: any[], ev?: (val: any) => number) => {\n  let result = Infinity;\n  for (const datum of data) {\n    const val = ev ? ev(datum) : datum as number;\n    if (val < result) {\n      result = val;\n    }\n  }\n  return result;\n};\nconst minBy = <T>(data: T[], ev: (val: T) => number): T | undefined => {\n  let result: T | undefined = undefined;\n  let minVal = Infinity;\n  for (const datum of data) {\n    const val = ev(datum);\n    if (val < minVal) {\n      result = datum;\n      minVal = val;\n    }\n  }\n  return result;\n};\n\nconst lerp = (x1: number, x2: number, k: number) => x1 * (1 - k) + x2 * k;\nconst norm2 = (dx: number, dy: number) => dx * dx + dy * dy;\n\nexport const drawFreehand = (glyph: Glyph, points: [number, number][]): Glyph => {\n  const [startX, startY] = points[0];\n  const [endX, endY] = points[points.length - 1];\n  const dx = endX - startX;\n  const dy = endY - startY;\n\n  if (glyph.length > 0 && norm2(dx, dy) < 25 ** 2) {\n    const lastStroke = glyph[glyph.length - 1];\n    // \n    if (\n      [1, 2, 3, 4, 6].includes(lastStroke.value[0]) &&\n      norm2(\n        startX - lastStroke.value[lastStroke.value.length - 2],\n        startY - lastStroke.value[lastStroke.value.length - 1]\n      ) < 10 ** 2\n    ) {\n      if ([1, 2, 6].includes(lastStroke.value[0]) && dx < 0) { // \n        const newLastStroke: GlyphLine = {\n          value: lastStroke.value.slice(),\n        };\n        newLastStroke.value[2] = 4;\n        if (newLastStroke.value[1] === 27) {\n          newLastStroke.value[1] = 22;\n        }\n        return glyph.slice(0, -1).concat([newLastStroke]);\n      }\n      if ([2, 6].includes(lastStroke.value[0]) && dx >= 0 && dy < 0) { // \n        const newLastStroke: GlyphLine = {\n          value: lastStroke.value.slice(),\n        };\n        newLastStroke.value[2] = 5;\n        if (newLastStroke.value[1] === 7) {\n          newLastStroke.value[1] = 0;\n        } else if (newLastStroke.value[1] === 27) {\n          newLastStroke.value[1] = 22;\n        }\n        return glyph.slice(0, -1).concat([newLastStroke]);\n      }\n      if ([3, 4].includes(lastStroke.value[0]) && dy < 0) { // \n        const newLastStroke: GlyphLine = {\n          value: lastStroke.value.slice(),\n        };\n        newLastStroke.value[2] = 5;\n        return glyph.slice(0, -1).concat([newLastStroke]);\n      }\n    }\n  }\n\n  const centroidX = avg(points.map(([x]) => x));\n  const centroidY = avg(points.map(([_x, y]) => y));\n\n  const midLerpRate = 3;\n  const midX = lerp((startX + endX) / 2, centroidX, midLerpRate);\n  const midY = lerp((startY + endY) / 2, centroidY, midLerpRate);\n\n  const dis = (dx * midY - dy * midX + startX * endY - startY * endX) / Math.sqrt(norm2(dx, dy));\n  if (\n    Math.abs(dis) <= 5 && // \n    (\n      (dx > 0 && Math.abs(dy) <= dx * 0.5) || // \n      (dy > 0 && -dy <= dx && dx <= dy * 0.5) // \n    )\n  ) { // \n    const newStroke: GlyphLine = {\n      value: [1, 0, 0, startX, startY, endX, endY],\n    };\n    return correctStroke(glyph, newStroke);\n  }\n  if (dx < 0 && dy >= 50 && dis < 0 && dx * -3 < dy) { // \n    const mid1X = startX;\n    const mid1Y = lerp(startY, endY, 1 / 3);\n    const mid2X = startX;\n    const mid2Y = lerp(startY, endY, 2 / 3);\n    const newStroke: GlyphLine = {\n      value: [7, 0, 7, startX, startY, mid1X, mid1Y, mid2X, mid2Y, endX, endY],\n    };\n    return correctStroke(glyph, newStroke);\n  }\n  // \n  let startType = 0;\n  let endType = 7;\n  if (dx > 0 && dy > 0 && dis > 0) { //  or \n    const [leftBottomX, leftBottomY] = minBy(points, ([x, y]) => x - y)!;\n    const dx1 = startX - leftBottomX;\n    const dy1 = startY - leftBottomY;\n    const dx2 = endX - leftBottomX;\n    const dy2 = endY - leftBottomY;\n    const cosAngle = (dx1 * dx2 + dy1 * dy2) / Math.sqrt(norm2(dx1, dy1) * norm2(dx2, dy2));\n    if (dx1 < 50 && dx2 > 30 && -20 <= dy2 && dy2 <= 20 && cosAngle > -0.15) {\n      // \n      const midX = min(points, ([x]) => x);\n      const midY = endY;\n      const newStroke: GlyphLine = {\n        value: [3, 0, 0, startX, startY, midX, midY, endX, endY],\n      };\n      return correctStroke(glyph, newStroke);\n    }\n    startType = 7;\n    endType = 0;\n  } else if (dx > 0 && dy > 0 && dis < 0) { // \n    startType = 7;\n    endType = 8;\n  }\n  const newStroke: GlyphLine = {\n    value: [2, startType, endType, startX, startY, midX, midY, endX, endY],\n  };\n  return correctStroke(glyph, newStroke);\n};\n\nconst round = (x: number) => Math.round(x);\n\nlet snapped: boolean[];\n\nconst correctStroke = (glyph: Glyph, newStroke: GlyphLine): Glyph => {\n  snapped = newStroke.value.map(() => false);\n  glyph = snapStrokeStart(glyph, newStroke);\n  glyph = snapStrokeEnd(glyph, newStroke);\n  snapStrokeTilt(newStroke);\n  newStroke = applyGlyphLineOperation(newStroke, round, round)\n  glyph = snapToNewStroke(glyph, newStroke);\n  return glyph.concat([newStroke]);\n};\n\nconst setGlyphValue = (glyph: Glyph, lineIndex: number, column: number, value: number): Glyph => {\n  if (glyph[lineIndex].value[column] === value) {\n    return glyph;\n  }\n  return glyph.map((gLine, index) => {\n    if (index !== lineIndex) {\n      return gLine;\n    }\n    const newGLine: GlyphLine = {\n      ...gLine,\n      value: gLine.value.slice(),\n    };\n    newGLine.value[column] = value;\n    return newGLine;\n  });\n};\n\nconst snapVerticalStroke = (\n  glyph: Glyph, vertStroke: GlyphLine, position: 'start' | 'end',\n  leftType: number, middleType: number, rightType: number\n): Glyph => {\n  const ti = position === 'start' ? 1 : 2;\n  const xi = position === 'start' ? 3 : vertStroke.value.length - 2;\n  const yi = xi + 1;\n  const nx = vertStroke.value[xi];\n  const ny = vertStroke.value[yi];\n  const minX = nx - 10;\n  const maxX = nx + 10;\n  const minY = ny - 10;\n  const maxY = ny + 10;\n  for (let lineIndex = glyph.length - 1; lineIndex >= 0; lineIndex--) {\n    const horiStroke = glyph[lineIndex];\n    if (horiStroke.value[0] !== 1) {\n      continue;\n    }\n    const x1 = horiStroke.value[3];\n    const y1 = horiStroke.value[4];\n    const x2 = horiStroke.value[5];\n    const y2 = horiStroke.value[6];\n    if (x2 - x1 < Math.abs(y2 - y1)) {\n      continue;\n    }\n    if (\n      [0, 2].includes(horiStroke.value[1]) &&\n      minX <= x1 && x1 <= maxX &&\n      minY <= y1 && y1 <= maxY\n    ) {\n      vertStroke.value[xi] = x1;\n      vertStroke.value[yi] = y1;\n      snapped[xi] = snapped[yi] = true;\n      vertStroke.value[ti] = leftType;\n      return setGlyphValue(glyph, lineIndex, 1, 2); // ()\n    }\n    if (\n      [0, 2].includes(horiStroke.value[2]) &&\n      minX <= x2 && x2 <= maxX &&\n      minY <= y2 && y2 <= maxY\n    ) {\n      vertStroke.value[xi] = x2;\n      vertStroke.value[yi] = y2;\n      snapped[xi] = snapped[yi] = true;\n      vertStroke.value[ti] = rightType;\n      return setGlyphValue(glyph, lineIndex, 2, 2); // ()\n    }\n    if (y1 === y2 && minY <= y1 && y1 <= maxY && x1 <= nx && nx <= x2) {\n      vertStroke.value[yi] = y1;\n      snapped[yi] = true;\n      vertStroke.value[ti] = middleType;\n      return glyph;\n    }\n  }\n  return glyph;\n};\n\nconst snapHorizontalStroke = (glyph: Glyph, horiStroke: GlyphLine, position: 'start' | 'end'): Glyph => {\n  const ti = position === 'start' ? 1 : 2;\n  const xi = position === 'start' ? 3 : 5;\n  const yi = xi + 1;\n  const nx = horiStroke.value[xi];\n  const ny = horiStroke.value[yi];\n  const minX = nx - 10;\n  const maxX = nx + 10;\n  const minY = ny - 10;\n  const maxY = ny + 10;\n  for (let lineIndex = glyph.length - 1; lineIndex >= 0; lineIndex--) {\n    const vertStroke = glyph[lineIndex];\n    if (![1, 2, 3, 4, 6, 7].includes(vertStroke.value[0])) {\n      continue;\n    }\n    const x1 = vertStroke.value[3];\n    const y1 = vertStroke.value[4];\n    const x2 = vertStroke.value[5];\n    const y2 = vertStroke.value[6];\n    if (vertStroke.value[0] === 1 && x2 - x1 > Math.abs(y2 - y1)) {\n      continue;\n    }\n    if (position === 'start') {\n      if (\n        [0, 12].includes(vertStroke.value[1]) &&\n        minX <= x1 && x1 <= maxX &&\n        minY <= y1 && y1 <= maxY\n      ) {\n        horiStroke.value[xi] = x1;\n        horiStroke.value[yi] = y1;\n        snapped[xi] = snapped[yi] = true;\n        horiStroke.value[ti] = 2;\n        return setGlyphValue(glyph, lineIndex, 1, 12); // \n      }\n      if (\n        vertStroke.value[0] === 1 &&\n        [0, 13, 313, 413].includes(vertStroke.value[2]) &&\n        minX <= x2 && x2 <= maxX &&\n        minY <= y2 && y2 <= maxY\n      ) {\n        horiStroke.value[xi] = x2;\n        horiStroke.value[yi] = y2;\n        snapped[xi] = snapped[yi] = true;\n        horiStroke.value[ti] = 2;\n        return vertStroke.value[2] === 0\n          ? setGlyphValue(glyph, lineIndex, 2, 13) // \n          : glyph;\n      }\n    } else {\n      if (\n        [0, 22].includes(vertStroke.value[1]) &&\n        minX <= x1 && x1 <= maxX &&\n        minY <= y1 && y1 <= maxY\n      ) {\n        horiStroke.value[xi] = x1;\n        horiStroke.value[yi] = y1;\n        snapped[xi] = snapped[yi] = true;\n        horiStroke.value[ti] = 2;\n        return setGlyphValue(glyph, lineIndex, 1, 22); // \n      }\n      if (\n        vertStroke.value[0] === 1 &&\n        [0, 23, 24].includes(vertStroke.value[2]) &&\n        minX <= x2 && x2 <= maxX &&\n        minY <= y2 && y2 <= maxY\n      ) {\n        horiStroke.value[xi] = x2;\n        horiStroke.value[yi] = y2;\n        snapped[xi] = snapped[yi] = true;\n        horiStroke.value[ti] = 2;\n        return vertStroke.value[2] === 0\n          ? setGlyphValue(glyph, lineIndex, 2, 23) // \n          : glyph;\n      }\n    }\n    if (x1 === x2 && minX <= x1 && x1 <= maxX && y1 <= ny && ny <= y2) {\n      horiStroke.value[xi] = x1;\n      snapped[xi] = true;\n      horiStroke.value[ti] = 2;\n      return glyph;\n    }\n  }\n  return glyph;\n};\n\nconst snapStrokeStart = (glyph: Glyph, newStroke: GlyphLine): Glyph => {\n  if (newStroke.value[0] !== 1) {\n    const y1 = newStroke.value[4];\n    const y2 = newStroke.value[6];\n    if (y1 > y2) {\n      return glyph;\n    }\n    const midStartShape = newStroke.value[1] === 7 ? 7 : 32;\n    const rightStartShape = newStroke.value[1] === 7 ? 27 : 22;\n    return snapVerticalStroke(glyph, newStroke, 'start', 12, midStartShape, rightStartShape);\n  }\n  const x1 = newStroke.value[3];\n  const y1 = newStroke.value[4];\n  const x2 = newStroke.value[5];\n  const y2 = newStroke.value[6];\n  if (x2 - x1 > Math.abs(y2 - y1)) {\n    return snapHorizontalStroke(glyph, newStroke, 'start');\n  }\n  if (y2 - y1 > 0) {\n    return snapVerticalStroke(glyph, newStroke, 'start', 12, 32, 22);\n  }\n  return glyph;\n};\nconst snapStrokeSegmentTilt = (newStroke: GlyphLine, point1Index: number) => {\n  const x1i = 3 + point1Index * 2;\n  const y1i = x1i + 1;\n  const x2i = x1i + 2;\n  const y2i = x1i + 3;\n\n  const x1 = newStroke.value[x1i];\n  const y1 = newStroke.value[y1i];\n  const x2 = newStroke.value[x2i];\n  const y2 = newStroke.value[y2i];\n\n  const dx = x2 - x1;\n  const dy = y2 - y1;\n\n  if (Math.abs(dx) > Math.abs(dy) * 20) {\n    if (!snapped[y2i]) {\n      newStroke.value[y2i] = y1;\n      return;\n    }\n    if (!snapped[y1i]) {\n      newStroke.value[y1i] = y2;\n      return;\n    }\n  }\n  if (Math.abs(dy) > Math.abs(dx) * 20) {\n    if (!snapped[x2i]) {\n      newStroke.value[x2i] = x1;\n      return;\n    }\n    if (!snapped[x1i]) {\n      newStroke.value[x1i] = x2;\n      return;\n    }\n  }\n};\nconst snapStrokeTilt = (newStroke: GlyphLine) => {\n  switch (newStroke.value[0]) {\n    case 1:\n      snapStrokeSegmentTilt(newStroke, 0);\n      return;\n    case 3:\n      snapStrokeSegmentTilt(newStroke, 0);\n      snapStrokeSegmentTilt(newStroke, 1);\n      return;\n    case 4:\n      snapStrokeSegmentTilt(newStroke, 1);\n      return;\n    case 7:\n      newStroke.value[5] = newStroke.value[7] = newStroke.value[3];\n  }\n};\nconst snapStrokeEnd = (glyph: Glyph, newStroke: GlyphLine): Glyph => {\n  if (newStroke.value[0] !== 1) {\n    return glyph;\n  }\n  const x1 = newStroke.value[3];\n  const y1 = newStroke.value[4];\n  const x2 = newStroke.value[5];\n  const y2 = newStroke.value[6];\n  if (x2 - x1 > Math.abs(y2 - y1)) {\n    return snapHorizontalStroke(glyph, newStroke, 'end');\n  }\n  if (y2 - y1 > 0) {\n    return snapVerticalStroke(glyph, newStroke, 'end', 13, 32, 23);\n  }\n  return glyph;\n};\nconst snapToNewStroke = (glyph: Glyph, newStroke: GlyphLine): Glyph => {\n  if (newStroke.value[0] !== 1) {\n    return glyph;\n  }\n  const x1 = newStroke.value[3];\n  const y1 = newStroke.value[4];\n  const x2 = newStroke.value[5];\n  const y2 = newStroke.value[6];\n  if (y1 !== y2) {\n    return glyph;\n  }\n  const minY = y1 - 10;\n  const maxY = y1 + 10;\n  glyph.forEach((gLine, lineIndex) => {\n    if (gLine.value[0] !== 1 || gLine.value[2] !== 0) {\n      return;\n    }\n    const sx1 = gLine.value[3];\n    const sy1 = gLine.value[4];\n    const sx2 = gLine.value[5];\n    const sy2 = gLine.value[6];\n    if (sx2 - sx1 > Math.abs(sy2 - sy1)) {\n      return;\n    }\n    if (minY <= sy2 && sy2 <= maxY && x1 <= sx2 && sx2 <= x2) {\n      glyph = setGlyphValue(glyph, lineIndex, 2, 32);\n      glyph = setGlyphValue(glyph, lineIndex, 6, y1);\n    }\n  });\n  return glyph;\n};\n","import memoizeOne from 'memoize-one';\n\nimport { GlyphLine, Glyph, PointDescriptor, getNumColumns } from './glyph';\n\ninterface ConnectablePoint {\n  position: 'start' | 'end';\n  strokeType: number;\n  shapeType: number;\n  coord: [number, number];\n  pointIndex: number;\n}\n\ninterface ConnectablePointFilter {\n  position: 'start' | 'end';\n  strokeTypes: number[];\n  shapeTypes: number[];\n}\n\nconst connectablePairs: [ConnectablePointFilter, ConnectablePointFilter][] = [\n  [\n    // \n    {\n      position: 'start',\n      strokeTypes: [1],\n      shapeTypes: [2],\n    },\n    {\n      position: 'start',\n      strokeTypes: [1, 2, 3, 4, 6, 7],\n      shapeTypes: [12],\n    },\n  ],\n  [\n    // \n    {\n      position: 'start',\n      strokeTypes: [1],\n      shapeTypes: [2],\n    },\n    {\n      position: 'end',\n      strokeTypes: [1],\n      shapeTypes: [13, 313, 413],\n    },\n  ],\n  [\n    // \n    {\n      position: 'end',\n      strokeTypes: [1],\n      shapeTypes: [2],\n    },\n    {\n      position: 'start',\n      strokeTypes: [1, 2, 3, 4, 6, 7],\n      shapeTypes: [22, 27],\n    },\n  ],\n  [\n    // \n    {\n      position: 'end',\n      strokeTypes: [1],\n      shapeTypes: [2],\n    },\n    {\n      position: 'end',\n      strokeTypes: [1],\n      shapeTypes: [23, 24],\n    },\n  ],\n];\n\nconst matchConnectablePoint = (filter: ConnectablePointFilter, point: ConnectablePoint) => (\n  filter.position === point.position &&\n  filter.strokeTypes.includes(point.strokeType) &&\n  filter.shapeTypes.includes(point.shapeType)\n)\n\nconst isConnectable = (point1: ConnectablePoint, point2: ConnectablePoint) => (\n  point1.coord[0] === point2.coord[0] &&\n  point1.coord[1] === point2.coord[1] &&\n  connectablePairs.some(([filter1, filter2]) => (\n    (matchConnectablePoint(filter1, point1) && matchConnectablePoint(filter2, point2)) ||\n    (matchConnectablePoint(filter2, point1) && matchConnectablePoint(filter1, point2))\n  ))\n);\n\nconst getConnectablePoints = (glyphLine: GlyphLine): ConnectablePoint[] => {\n  const result: ConnectablePoint[] = [];\n  switch (glyphLine.value[0]) {\n    case 1:\n    case 2:\n    case 3:\n    case 4:\n    case 6:\n    case 7: {\n      result.push({\n        position: 'start',\n        strokeType: glyphLine.value[0],\n        shapeType: glyphLine.value[1],\n        coord: [\n          glyphLine.value[3],\n          glyphLine.value[4],\n        ],\n        pointIndex: 0,\n      });\n      const endPointIndex = (getNumColumns(glyphLine.value[0]) - 3) / 2 - 1;\n      result.push({\n        position: 'end',\n        strokeType: glyphLine.value[0],\n        shapeType: glyphLine.value[2],\n        coord: [\n          glyphLine.value[3 + endPointIndex * 2],\n          glyphLine.value[3 + endPointIndex * 2 + 1],\n        ],\n        pointIndex: endPointIndex,\n      });\n      break;\n    }\n  }\n  return result;\n};\n\nexport const listupConnectedPoints = memoizeOne((glyph: Glyph, points: PointDescriptor[]): PointDescriptor[] => {\n  const sPoints: ConnectablePoint[] = [];\n  for (const { lineIndex, pointIndex } of points) {\n    for (const sPoint of getConnectablePoints(glyph[lineIndex])) {\n      if (sPoint.pointIndex === pointIndex) {\n        sPoints.push(sPoint);\n      }\n    }\n  }\n  const result: PointDescriptor[] = [];\n  glyph.forEach((glyphLine, lineIndex) => {\n    for (const dPoint of getConnectablePoints(glyphLine)) {\n      if (sPoints.some((sPoint) => isConnectable(sPoint, dPoint))) {\n        result.push({\n          lineIndex,\n          pointIndex: dPoint.pointIndex,\n        });\n      }\n    }\n  });\n  return result;\n}, ([glyph1, points1], [glyph2, points2]) => (\n  glyph1 === glyph2 &&\n  points1.length === points2.length &&\n  points1.every((point1, index) => (\n    point1.lineIndex === points2[index].lineIndex &&\n    point1.pointIndex === points2[index].pointIndex\n  ))\n));\n\nexport const listupConnectedPointsOfSelection = memoizeOne((glyph: Glyph, selection: number[]): PointDescriptor[] => {\n  const selectedDescs: PointDescriptor[] = [];\n  for (const lineIndex of selection) {\n    const glyphLine = glyph[lineIndex];\n    selectedDescs.push({ lineIndex, pointIndex: 0 });\n    selectedDescs.push({ lineIndex, pointIndex: (getNumColumns(glyphLine.value[0]) - 3) / 2 - 1 });\n  }\n  return listupConnectedPoints(glyph, selectedDescs)\n    .filter(({ lineIndex }) => !selection.includes(lineIndex));\n});\n","import { GlyphLine, Glyph, PointDescriptor } from './glyph';\n\nimport { BBX } from './bbx';\nimport { listupConnectedPoints, listupConnectedPointsOfSelection } from './connection';\n\nexport const applyGlyphLineOperation = (glyphLine: GlyphLine, tX: (x: number) => number, tY: (y: number) => number): GlyphLine => {\n  switch (glyphLine.value[0]) {\n    case 99: {\n      const value = glyphLine.value.slice();\n      value[3] = tX(value[3]);\n      value[4] = tY(value[4]);\n      value[5] = tX(value[5]);\n      value[6] = tY(value[6]);\n      return { value, partName: glyphLine.partName };\n    }\n    case 0:\n    case 1:\n    case 2:\n    case 3:\n    case 4:\n    case 6:\n    case 7:\n    case 9: {\n      const value = glyphLine.value.slice();\n      for (let i = 3; i + 2 <= value.length; i += 2) {\n        value[i] = tX(value[i]);\n        value[i + 1] = tY(value[i + 1]);\n      }\n      return { value };\n    }\n    default:\n      return glyphLine;\n  }\n}\n\nexport const applyGlyphPointOperation = (glyph: Glyph, pdescs: PointDescriptor[], tX: (x: number) => number, tY: (y: number) => number): Glyph => {\n  if (pdescs.length === 0) {\n    return glyph;\n  }\n  const newGlyph = glyph.slice();\n  for (const { lineIndex, pointIndex } of pdescs) {\n    const glyphLine = newGlyph[lineIndex];\n    const newValue = glyphLine.value.slice();\n    newValue[3 + pointIndex * 2] = tX(newValue[3 + pointIndex * 2]);\n    newValue[3 + pointIndex * 2 + 1] = tY(newValue[3 + pointIndex * 2 + 1]);\n    newGlyph[lineIndex] = {\n      ...glyphLine,\n      value: newValue,\n    };\n  }\n  return newGlyph;\n};\n\n\nexport const moveSelectedGlyphLines = (glyph: Glyph, selection: number[], dx: number, dy: number): Glyph => {\n  if (selection.length === 0) {\n    return glyph;\n  }\n  const targetDescs = listupConnectedPointsOfSelection(glyph, selection);\n\n  const tX = (x: number) => Math.round(x + dx);\n  const tY = (y: number) => Math.round(y + dy);\n  glyph = glyph.map((glyphLine, index) => selection.includes(index)\n    ? applyGlyphLineOperation(glyphLine, tX, tY)\n    : glyphLine\n  );\n  glyph = applyGlyphPointOperation(glyph, targetDescs, tX, tY);\n  return glyph;\n};\n\nexport const moveSelectedPoint = (glyph: Glyph, selection: number[], pointIndex: number, dx: number, dy: number): Glyph => {\n  if (selection.length === 0) {\n    return glyph;\n  }\n  const lineIndex = selection[0];\n  const selectedDesc: PointDescriptor = { lineIndex, pointIndex };\n  const targetDescs = listupConnectedPoints(glyph, [selectedDesc])\n    .filter((targetDesc) => targetDesc.lineIndex !== lineIndex);\n  targetDescs.push(selectedDesc);\n\n  const tX = (x: number) => Math.round(x + dx);\n  const tY = (y: number) => Math.round(y + dy);\n  glyph = applyGlyphPointOperation(glyph, targetDescs, tX, tY);\n  return glyph;\n};\n\nexport const resizeGlyphLine = (glyphLine: GlyphLine, oldBBX: BBX, newBBX: BBX): GlyphLine => {\n  const [x11, y11, x12, y12] = oldBBX;\n  const [x21, y21, x22, y22] = newBBX;\n  const tX = (x: number) => Math.round(x21 + (x - x11) * (x22 - x21) / (x12 - x11));\n  const tY = (y: number) => Math.round(y21 + (y - y11) * (y22 - y21) / (y12 - y11));\n  return applyGlyphLineOperation(glyphLine, tX, tY);\n};\n\nexport const resizeSelectedGlyphLines = (glyph: Glyph, selection: number[], oldBBX: BBX, newBBX: BBX): Glyph => {\n  return glyph.map((glyphLine, index) => selection.includes(index)\n    ? resizeGlyphLine(glyphLine, oldBBX, newBBX)\n    : glyphLine\n  );\n};\n","export class Buhin{\n  constructor(number){\n    this.hash = {};\n  }\n  set(name, data){ // void\n    this.hash[name] = data;\n  }\n  push(name, data){ // void\n    this.set(name, data)\n  }search(name){ // string\n    if(this.hash[name]){\n      return this.hash[name];\n    }\n    return \"\"; // no data\n  }\n}\n","export class Polygons{\n  // method\n  constructor(){\n    this.array = new Array();\n  }\n \tclear(){ // void\n    this.array = new Array();\n  }\n  push(polygon){ // void\n    // only a simple check\n    var minx = 200;\n    var maxx = 0;\n    var miny = 200;\n    var maxy = 0;\n    var error = 0;\n    for(var i = 0; i < polygon.array.length; i++){\n      if(polygon.array[i].x < minx){\n        minx = polygon.array[i].x;\n      }\n      if(polygon.array[i].x > maxx){\n        maxx = polygon.array[i].x;\n      }\n      if(polygon.array[i].y < miny){\n        miny = polygon.array[i].y;\n      }\n      if(polygon.array[i].y > maxy){\n        maxy = polygon.array[i].y;\n      }\n      if(isNaN(polygon.array[i].x) || isNaN(polygon.array[i].y)){\n        error++;\n      }\n    }\n    if(error == 0 && minx != maxx && miny != maxy && polygon.array.length >= 3){\n      var newArray = new Array();\n      newArray.push(polygon.array.shift());\n      while(polygon.array.length != 0){\n        var temp = polygon.array.shift();\n        //if(newArray[newArray.length - 1].x != temp.x ||\n        //   newArray[newArray.length - 1].y != temp.y){\n          newArray.push(temp);\n        //}\n      }\n      if(newArray.length >= 3){\n        polygon.array = newArray;\n        this.array.push(polygon);\n      }\n    }\n  }\n  concat(polygons){\n    for(let polygon of polygons.array){\n      this.push(polygon);\n    }\n  }\n  generateSVG(){ // string\n    var buffer = \"\";\n    buffer += \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\" version=\\\"1.1\\\" baseProfile=\\\"full\\\" viewBox=\\\"0 0 200 200\\\" width=\\\"200\\\" height=\\\"200\\\">\\n\";\n    for(var i = 0; i < this.array.length; i++){\n      buffer += \"<path d=\\\"\";\n      buffer += this.array[i].get_sub_path_svg();\n      buffer += \"\\\" fill=\\\"black\\\" />\\n\";\n    }\n    buffer += \"</svg>\\n\";\n    return buffer;\n  }\n  generateSVG2(){ // string\n    var buffer = \"\";\n    buffer += \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\" version=\\\"1.1\\\" baseProfile=\\\"full\\\" viewBox=\\\"0 0 200 200\\\" width=\\\"200\\\" height=\\\"200\\\">\\n\";\n    buffer += \"<path d=\\\"\";\n    buffer += this.get_path_svg();\n    buffer += \"\\\" fill=\\\"black\\\" />\\n\";\n    buffer += \"</svg>\\n\";\n    return buffer;\n  }\n  get_path_svg(){\n    var buffer = \"\";\n    for(var i = 0; i < this.array.length; i++){\n      buffer += this.array[i].get_sub_path_svg();\n    }\n    return buffer;\n  }\n  get_path_svg_font(){\n    var buffer = \"\";\n    for(var i = 0; i < this.array.length; i++){\n      buffer += this.array[i].get_sub_path_svg_font();\n    }\n    return buffer;\n  }\n  generateEPS(){ // string\n    var buffer = \"\";\n    buffer += \"%!PS-Adobe-3.0 EPSF-3.0\\n\";\n    buffer += \"%%BoundingBox: 0 -208 1024 816\\n\";\n    buffer += \"%%Pages: 0\\n\";\n    buffer += \"%%Title: Kanji glyph\\n\";\n    buffer += \"%%Creator: GlyphWiki powered by KAGE system\\n\";\n    buffer += \"%%CreationDate: \" + new Date() + \"\\n\";\n    buffer += \"%%EndComments\\n\";\n    buffer += \"%%EndProlog\\n\";\n    \n    for(var i = 0; i < this.array.length; i++){\n      for(var j = 0; j < this.array[i].array.length; j++){\n        buffer += (this.array[i].array[j].x * 5) + \" \" + (1000 - this.array[i].array[j].y * 5 - 200) + \" \";\n        if(j == 0){\n          buffer += \"newpath\\nmoveto\\n\";\n        } else {\n          buffer += \"lineto\\n\";\n        }\n      }\n      buffer += \"closepath\\nfill\\n\";\n    }\n    buffer += \"%%EOF\\n\";\n    return buffer;\n  }\n\n}\n","export class Polygon{\n  // resolution : 0.0001\n  constructor(number){\n    this.array = new Array();\n    // initialize\n    if(number){\n      for(var i = 0; i < number; i++){\n        this.push(0, 0, 0);\n      }\n    }\n  }\n  push(x, y, off){ // void\n    var temp = new Object();\n    temp.x = Math.round(x*10000)/10000;\n    temp.y = Math.round(y*10000)/10000;\n    if(off != 1 && off != 2){\n      off = 0;\n    }\n    temp.off = off;\n    this.array.push(temp);\n  }\n  push2(p, off){\n    let [x, y] = p;\n    this.push(x, y, off);\n  }\n  set(index, x, y, off){ // void\n    this.array[index].x = Math.round(x*10000)/10000;\n    this.array[index].y = Math.round(y*10000)/10000;\n    if(off != 1 && off != 2){\n      off = 0;\n    }\n    this.array[index].off = off;\n  }\n  to_font1000(){\n    for(var j = 0; j < this.array.length; j++){\n      this.array[j].x = this.array[j].x*5;\n      this.array[j].y = this.array[j].y*-5 - 200;\n    }\n  }\n  reverse(){ // void\n    this.array.reverse();\n  }\n  concat(poly){ // void\n    this.array = this.array.concat(poly.array);\n  }\n  shift(){ // void\n    this.array.shift();\n  }\n  unshift(x, y, off){ // void\n    var temp = new Object();\n    temp.x = Math.round(x*10000)/10000;\n    temp.y = Math.round(y*10000)/10000;\n    if(off != 1 && off != 2){\n      off = 0;\n    }\n    temp.off = off;\n    this.array.unshift(temp);\n  }\n  get_sub_path_svg(){\n    let buffer = \"\";\n    buffer += \"M\";\n    buffer += this.array[0].x + \",\" + this.array[0].y + \" \";\n    let mode = \"\";\n    for(var j = 1; j < this.array.length; j++){\n      if(this.array[j].off == 1 && mode != \"Q\"){\n        buffer += \"Q\"; mode = \"Q\";\n      } else if(this.array[j-1].off == 0 && this.array[j].off == 2 && mode != \"C\"){\n        buffer += \"C\"; mode = \"C\";\n      } else if(this.array[j-1].off == 0 && this.array[j].off == 0 && mode != \"L\"){\n        buffer += \"L\"; mode = \"L\";\n      }\n      buffer += this.array[j].x + \",\" + this.array[j].y + \" \";\n    }\n    buffer += \"Z\";\n    return buffer;\n  }\n  get_sub_path_svg_font(){\n    let buffer = \"\";\n    buffer += \"M\";\n    buffer += (this.array[0].x*5) + \",\" + (800-this.array[0].y*5) + \" \";\n    let mode = \"\";\n    for(var j = 1; j < this.array.length; j++){\n      if(this.array[j].off == 1 && mode != \"Q\"){\n        buffer += \"Q\"; mode = \"Q\";\n      } else if(this.array[j-1].off == 0 && this.array[j].off == 2 && mode != \"C\"){\n        buffer += \"C\"; mode = \"C\";\n      } else if(this.array[j-1].off == 0 && this.array[j].off == 0 && mode != \"L\"){\n        buffer += \"L\"; mode = \"L\";\n      }\n      buffer += (this.array[j].x*5) + \",\" + (800-this.array[j].y*5) + \" \";\n    }\n    buffer += \"Z\";\n    return buffer;\n  }\n}\n","export const bez_cir = 4*(Math.sqrt(2)-1)/3;\n//a constant for drawing circles with Bezier curves\n\n//width functions (using circle)\nexport function widfun(t, x1, y1, x2, y2, wid){\n  const len = Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));\n  const p = 1 + (100/len);\n  return (  (Math.sqrt(p*p+(p-1)*(p-1)-(p-t)*(p-t))-(p-1))*0.778+0.222  )*wid;\n}\n\nexport function widfun_d(t, x1, y1, x2, y2, wid){\n  const len = Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));\n  const p = 1 + (100/len);\n  return wid*0.778*0.5*2*(p-t) / Math.sqrt(p*p+(p-1)*(p-1)-(p-t)*(p-t));\n}\n\nexport function widfun_stop(t, x1, y1, x2, y2, wid){\n  const len = Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));\n  const p = 1 + (100/len);\n  return (  (Math.sqrt(p*p+(p-1)*(p-1)-(p-t)*(p-t))-(p-1))*0.878+0.222  )*wid;\n}\n\nexport function widfun_stop_d(t, x1, y1, x2, y2, wid){\n  const len = Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));\n  const p = 1 + (100/len);\n  return wid*0.878*0.5*2*(p-t) / Math.sqrt(p*p+(p-1)*(p-1)-(p-t)*(p-t));\n}\n\n//fat version (used in cubic bezier)\nexport function widfun_fat(t, x1, y1, x2, y2, wid){\n  const len = Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));\n  const p = 1+ (40/len);\n  return (  (Math.sqrt(p*p + (p-1)*(p-1) - (p-t)*(p-t)) - (p-1)  )*0.778+0.222  )*wid;\n}\n\nexport function widfun_fat_d(t, x1, y1, x2, y2, wid){\n  const len = Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));\n  const p = 1+ (40/len);\n  return wid*0.778*0.5*2*(p-t) / Math.sqrt(p*p + (p-1)*(p-1) - (p-t)*(p-t));\n}\n\nexport function get_dir(x, y){\n  if (y==0){\n    if(x<0){\n      return {sin: 0, cos: -1};\n    }else{\n      return {sin: 0, cos:  1};\n    }\n  }else if(x==0){\n    if(y<0){\n      return {sin: -1, cos: 0};\n    }else{\n      return {sin:  1, cos: 0};\n    }\n  }else{\n    const rad = Math.atan2(y, x);\n    return {sin:  Math.sin(rad), cos: Math.cos(rad)};\n  }\n}\nexport const DIR_POSX = {sin: 0, cos: 1};\nexport const DIR_POSY = {sin: 1, cos: 0};\nexport const DIR_NEGX = {sin: 0, cos: -1};\nexport const DIR_NEGY = {sin: -1, cos: 0};\n\nexport function moved_point(x, y, dir, delta){\n  return [x + delta*dir.cos, y + delta*dir.sin];\n}\nexport function get_extended_dest(destX, destY, srcX, srcY, delta) {\n  const dir = get_dir(destX - srcX, destY - srcY);\n  return moved_point(destX, destY, dir, delta);\n}\n\nexport function get_extended_dest_wrong(destX, destY, srcX, srcY, delta) {\n  //The process for lines directed exactly in the negative x-direction or y-direction is not correct, so it's named as \"wrong\".\n  var destX_new = destX;\n  var destY_new = destY;\n  if (srcX == destX) {\n    destY_new = destY + delta;\n  }\n  else if (srcY == destY) {\n    destX_new = destX + delta;\n  }\n  else {\n    var v;\n    const rad = Math.atan((destY - srcY) / (destX - srcX));\n    if (srcX < destX) { v = 1; } else { v = -1; }\n    destX_new = destX + delta * Math.cos(rad) * v;\n    destY_new = destY + delta * Math.sin(rad) * v;\n  }\n  return [destX_new, destY_new]\n}\n\nexport function unit_normal_vector(ix, iy) {//to the right(clockwise (in the display coordinate))\n  var ia, ib;\n  // line SUICHOKU by vector\n  if (ix != 0 && iy != 0) {\n    const ir = Math.atan(iy / ix * -1.0);\n    ia = Math.sin(ir);\n    ib = Math.cos(ir);\n  }\n  else if (ix == 0) {\n    if (iy < 0) {\n      ia = -1;\n    } else {\n      ia = 1;\n    }\n    ib = 0;\n  }\n  else {\n    ia = 0;\n    ib = 1;\n  }\n  //reverse if vector is going 2nd/3rd quadrants\n  if (ix <= 0) {\n    ia = ia * -1;\n    ib = ib * -1;\n  }\n  return [ia, ib];\n}\n\nfunction normal_vector_of_len(v, l){//to the right(clockwise (in the display coordinate))\n  const len=Math.sqrt(v[0]*v[0]+v[1]*v[1]);\n  return [-v[1]*l/len,v[0]*l/len];\n}\n\nexport function vector_to_len(v, l){\n  const len=Math.sqrt(v[0]*v[0]+v[1]*v[1]);\n  return [v[0]*l/len,v[1]*l/len];\n}\n\nfunction calc_hosomi(x1, y1, x2, y2) {\n  var hosomi = 0.5;\n  if (Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1)) < 50) {\n    hosomi += 0.4 * (1 - Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1)) / 50);\n  }\n  return hosomi;\n}\n\nexport function get_rad(x, y) {\n  var rad;\n  if (x == 0) {\n    if (y > 0) {\n      rad = Math.PI / 2;\n    } else {\n      rad = -Math.PI / 2;\n    }\n  } else {\n    rad = Math.atan(y / x);\n    if (x < 0) { rad += Math.PI }\n  }\n  return rad;\n}\n\nexport function rad_to_vector(rad) {\n  return [Math.cos(rad), Math.sin(rad)];\n}\n\nfunction stretch_bezier_end(bez, t){\n  const start = [bez[0][0],\n                 bez[0][1]];\n  const c1 = [(1-t) * bez[0][0]+t * bez[1][0],\n              (1-t) * bez[0][1]+t * bez[1][1]];\n  const c2 = [(1-t) * (1-t) * bez[0][0] + 2.0 * t * (1-t) * bez[1][0] + t * t * bez[2][0],\n              (1-t) * (1-t) * bez[0][1] + 2.0 * t * (1-t) * bez[1][1] + t * t * bez[2][1]]\n  const end = [(1-t) * (1-t) * (1-t) * bez[0][0] + 3 * t * (1-t) * (1-t) * bez[1][0] + 3 * t * t * (1-t) * bez[2][0] + t * t * t * bez[3][0],\n               (1-t) * (1-t) * (1-t) * bez[0][1] + 3 * t * (1-t) * (1-t) * bez[1][1] + 3 * t * t * (1-t) * bez[2][1] + t * t * t * bez[3][1],]\n  return [start, c1, c2, end];\n}\nexport function bezier_to_y(bez, y){\n  const res = shorten_bezier_to_y(bez, y);\n  if(res){return res;}else{\n    return extend_bezier_to_y(bez, y);\n  }\n}\nfunction extend_bezier_to_y(bez, y) {\n  const a =     bez[3][1] - 3 * bez[2][1] + 3 * bez[1][1] - bez[0][1];\n  const b = 3 * bez[2][1] - 6 * bez[1][1] + 3 * bez[0][1];\n  const c = 3 * bez[1][1] - 3 * bez[0][1];\n  const d =     bez[0][1];\n  const yy = solveCubic(a, b, c, d - y);\n  yy.sort(function (a, b) {//ascending order\n    return a - b;\n  });\n  for (let i of yy) {\n    if (i > 1) {\n      return stretch_bezier_end(bez, i);\n    }\n  }\n  return false;\n}\n\nfunction shorten_bezier_to_y(bez, y) {\n  const a =     bez[3][1] - 3 * bez[2][1] + 3 * bez[1][1] - bez[0][1];\n  const b = 3 * bez[2][1] - 6 * bez[1][1] + 3 * bez[0][1];\n  const c = 3 * bez[1][1] - 3 * bez[0][1];\n  const d =     bez[0][1];\n  const yy = solveCubic(a, b, c, d - y);\n  yy.sort(function (a, b) {//descending order\n    return b - a;\n  });\n  for (let i of yy) {\n    if (0 < i && i < 1) {\n      return stretch_bezier_end(bez, i);\n    }\n  }\n  return false;\n}\n\nfunction solveCubic(a, b, c, d) {\n  if (Math.abs(a) < 1e-8) { // Quadratic case, ax^2+bx+c=0\n      a = b; b = c; c = d;\n      if (Math.abs(a) < 1e-8) { // Linear case, ax+b=0\n          a = b; b = c;\n          if (Math.abs(a) < 1e-8) // Degenerate case\n              return [];\n          return [-b/a];\n      }\n\n      var D = b*b - 4*a*c;\n      if (Math.abs(D) < 1e-8)\n          return [-b/(2*a)];\n      else if (D > 0)\n          return [(-b+Math.sqrt(D))/(2*a), (-b-Math.sqrt(D))/(2*a)];\n      return [];\n  }\n\n  // Convert to depressed cubic t^3+pt+q = 0 (subst x = t - b/3a)\n  var p = (3*a*c - b*b)/(3*a*a);\n  var q = (2*b*b*b - 9*a*b*c + 27*a*a*d)/(27*a*a*a);\n  var roots;\n\n  if (Math.abs(p) < 1e-8) { // p = 0 -> t^3 = -q -> t = -q^1/3\n      roots = [cuberoot(-q)];\n  } else if (Math.abs(q) < 1e-8) { // q = 0 -> t^3 + pt = 0 -> t(t^2+p)=0\n      roots = [0].concat(p < 0 ? [Math.sqrt(-p), -Math.sqrt(-p)] : []);\n  } else {\n      var D = q*q/4 + p*p*p/27;\n      if (Math.abs(D) < 1e-8) {       // D = 0 -> two roots\n          roots = [-1.5*q/p, 3*q/p];\n      } else if (D > 0) {             // Only one real root\n          var u = cuberoot(-q/2 - Math.sqrt(D));\n          roots = [u - p/(3*u)];\n      } else {                        // D < 0, three roots, but needs to use complex numbers/trigonometric solution\n          var u = 2*Math.sqrt(-p/3);\n          var t = Math.acos(3*q/p/u)/3;  // D < 0 implies p < 0 and acos argument in [-1..1]\n          var k = 2*Math.PI/3;\n          roots = [u*Math.cos(t), u*Math.cos(t-k), u*Math.cos(t-2*k)];\n      }\n  }\n\n  // Convert back from depressed cubic\n  for (var i = 0; i < roots.length; i++)\n      roots[i] -= b/(3*a);\n\n  return roots;\n}\nfunction cuberoot(x) {\n  var y = Math.pow(Math.abs(x), 1/3);\n  return x < 0 ? -y : y;\n}\n\nexport function stretch(dp, sp, p, min, max) { // integer\n  var p1, p2, p3, p4;\n  if (p < sp + 100) {\n    p1 = min;\n    p3 = min;\n    p2 = sp + 100;\n    p4 = dp + 100;\n  } else {\n    p1 = sp + 100;\n    p3 = dp + 100;\n    p2 = max;\n    p4 = max;\n  }\n  return Math.floor(((p - p1) / (p2 - p1)) * (p4 - p3) + p3);\n}\n\nexport function getBoundingBox(strokes) { // minX, minY, maxX, maxY\n  var a = new Object();\n  a.minX = 200;\n  a.minY = 200;\n  a.maxX = 0;\n  a.maxY = 0;\n  for (var i = 0; i < strokes.length; i++) {\n    if (strokes[i][0] == 0) { continue; }\n    a.minX = Math.min(a.minX, strokes[i][3]);\n    a.maxX = Math.max(a.maxX, strokes[i][3]);\n    a.minY = Math.min(a.minY, strokes[i][4]);\n    a.maxY = Math.max(a.maxY, strokes[i][4]);\n    a.minX = Math.min(a.minX, strokes[i][5]);\n    a.maxX = Math.max(a.maxX, strokes[i][5]);\n    a.minY = Math.min(a.minY, strokes[i][6]);\n    a.maxY = Math.max(a.maxY, strokes[i][6]);\n    if (strokes[i][0] == 1) { continue; }\n    if (strokes[i][0] == 99) { continue; }\n    a.minX = Math.min(a.minX, strokes[i][7]);\n    a.maxX = Math.max(a.maxX, strokes[i][7]);\n    a.minY = Math.min(a.minY, strokes[i][8]);\n    a.maxY = Math.max(a.maxY, strokes[i][8]);\n    if (strokes[i][0] == 2) { continue; }\n    if (strokes[i][0] == 3) { continue; }\n    if (strokes[i][0] == 4) { continue; }\n    a.minX = Math.min(a.minX, strokes[i][9]);\n    a.maxX = Math.max(a.maxX, strokes[i][9]);\n    a.minY = Math.min(a.minY, strokes[i][10]);\n    a.maxY = Math.max(a.maxY, strokes[i][10]);\n  }\n  return a;\n}","import {DIR_POSX} from \"./util\";\nexport class PointMaker{\n  constructor(x, y, dir, scale){\n    this.x = x;\n    this.y = y;\n    this.dir = dir;\n    this.scale = scale;\n    if(!scale){\n      this.scale = 1;\n    }\n    if(!dir){\n    this.dir = DIR_POSX;//positive x\n    }\n  }\n  setpos(x, y){\n    this.x = x;\n    this.y = y;\n  }\n  vec(x, y){ // void\n    return [this.x + this.scale*this.dir.cos*x - this.scale*this.dir.sin*y,\n            this.y + this.scale*this.dir.sin*x + this.scale*this.dir.cos*y]\n  }\n  setdir(dir){\n    this.dir = dir;\n  }\n  setscale(scale){\n    this.scale = scale;\n  }\n}\n","// ==ClosureCompiler==\r\n// @output_file_name fit-curve.min.js\r\n// @compilation_level SIMPLE_OPTIMIZATIONS\r\n// ==/ClosureCompiler==\r\n\r\n/**\r\n *  @preserve  JavaScript implementation of\r\n *  Algorithm for Automatically Fitting Digitized Curves\r\n *  by Philip J. Schneider\r\n *  \"Graphics Gems\", Academic Press, 1990\r\n *\r\n *  The MIT License (MIT)\r\n *\r\n *  https://github.com/soswow/fit-curves\r\n */\r\n\r\n/**\r\n * Fit one or more Bezier curves to a set of points.\r\n *\r\n * @param {Array<Array<Number>>} points - Array of digitized points, e.g. [[5,5],[5,50],[110,140],[210,160],[320,110]]\r\n * @param {Number} maxError - Tolerance, squared error between points and fitted curve\r\n * @returns {Array<Array<Array<Number>>>} Array of Bezier curves, where each element is [first-point, control-point-1, control-point-2, second-point] and points are [x, y]\r\n */\r\nexport function fitCurve(points, maxError, progressCallback) {\r\n    if (!Array.isArray(points)) {\r\n        throw new TypeError(\"First argument should be an array\");\r\n    }\r\n    points.forEach((point) => {\r\n        if(!Array.isArray(point) || point.some(item => typeof item !== 'number')\r\n        || point.length !== points[0].length) {\r\n            throw Error(\"Each point should be an array of numbers. Each point should have the same amount of numbers.\");\r\n        }\r\n    });\r\n\r\n    // Remove duplicate points\r\n    points = points.filter((point, i) =>\r\n      i === 0 || !point.every((val, j) => val === points[i-1][j])\r\n    );\r\n\r\n    if (points.length < 2) {\r\n        return [];\r\n    }\r\n\r\n    const len = points.length;\r\n    const leftTangent = createTangent(points[1], points[0]);\r\n    const rightTangent = createTangent(points[len - 2], points[len - 1]);\r\n\r\n    return fitCubic(points, leftTangent, rightTangent, maxError, progressCallback);\r\n}\r\n\r\n/**\r\n * Fit a Bezier curve to a (sub)set of digitized points.\r\n * Your code should not call this function directly. Use {@link fitCurve} instead.\r\n *\r\n * @param {Array<Array<Number>>} points - Array of digitized points, e.g. [[5,5],[5,50],[110,140],[210,160],[320,110]]\r\n * @param {Array<Number>} leftTangent - Unit tangent vector at start point\r\n * @param {Array<Number>} rightTangent - Unit tangent vector at end point\r\n * @param {Number} error - Tolerance, squared error between points and fitted curve\r\n * @returns {Array<Array<Array<Number>>>} Array of Bezier curves, where each element is [first-point, control-point-1, control-point-2, second-point] and points are [x, y]\r\n */\r\n\r\nexport function fitCubic_tang(points, tangents, error, progressCallback) {\r\n    const MaxIterations = 20;   //Max times to try iterating (to find an acceptable curve)\r\n\r\n    var bezCurve,               //Control points of fitted Bezier curve\r\n        u,                      //Parameter values for point\r\n        uPrime,                 //Improved parameter values\r\n        maxError, prevErr,      //Maximum fitting error\r\n        splitPoint, prevSplit,  //Point to split point set at if we need more than one curve\r\n        //centerVector, toCenterTangent, fromCenterTangent,  //Unit tangent vector(s) at splitPoint\r\n        beziers,                //Array of fitted Bezier curves if we need more than one curve\r\n        dist, i;\r\n\r\n    //console.log('fitCubic, ', points.length);\r\n    const leftTangent = tangents[0];\r\n    const rightTangent = maths.mulItems(tangents[points.length - 1], -1);\r\n    //Use heuristic if region only has two points in it\r\n    if (points.length === 2) {\r\n        dist = maths.vectorLen(maths.subtract(points[0], points[1])) / 3.0;\r\n        bezCurve = [\r\n            points[0],\r\n            maths.addArrays(points[0], maths.mulItems(leftTangent,  dist)),\r\n            maths.addArrays(points[1], maths.mulItems(rightTangent, dist)),\r\n            points[1]\r\n        ];\r\n        return [bezCurve];\r\n    }\r\n\r\n\r\n    //Parameterize points, and attempt to fit curve\r\n    u = chordLengthParameterize(points);\r\n    [bezCurve, maxError, splitPoint] = generateAndReport(points, u, u, leftTangent, rightTangent, progressCallback)\r\n\r\n    if (maxError < error) {\r\n        return [bezCurve];\r\n    }\r\n    //If error not too large, try some reparameterization and iteration\r\n    if (maxError < (error*error)) {\r\n\r\n        uPrime = u;\r\n        prevErr = maxError;\r\n        prevSplit = splitPoint;\r\n\r\n        for (i = 0; i < MaxIterations; i++) {\r\n\r\n            uPrime = reparameterize(bezCurve, points, uPrime);\r\n            [bezCurve, maxError, splitPoint] = generateAndReport(points, u, uPrime, leftTangent, rightTangent, progressCallback);\r\n\r\n            if (maxError < error) {\r\n                return [bezCurve];\r\n            }\r\n            //If the development of the fitted curve grinds to a halt,\r\n            //we abort this attempt (and try a shorter curve):\r\n            else if(splitPoint === prevSplit) {\r\n                let errChange = maxError/prevErr;\r\n                if((errChange > .9999) && (errChange < 1.0001)) {\r\n                    break;\r\n                }\r\n            }\r\n\r\n            prevErr = maxError;\r\n            prevSplit = splitPoint;\r\n        }\r\n    }\r\n\r\n    //Fitting failed -- split at max error point and fit recursively\r\n    beziers = [];\r\n\r\n    //To and from need to point in opposite directions:\r\n    /*\r\n    Note: An alternative to this \"divide and conquer\" recursion could be to always\r\n          let new curve segments start by trying to go all the way to the end,\r\n          instead of only to the end of the current subdivided polyline.\r\n          That might let many segments fit a few points more, reducing the number of total segments.\r\n\r\n          However, a few tests have shown that the segment reduction is insignificant\r\n          (240 pts, 100 err: 25 curves vs 27 curves. 140 pts, 100 err: 17 curves on both),\r\n          and the results take twice as many steps and milliseconds to finish,\r\n          without looking any better than what we already have.\r\n    */\r\n    beziers = beziers.concat(fitCubic_tang(points.slice(0, splitPoint + 1), tangents.slice(0, splitPoint + 1), error, progressCallback));\r\n    beziers = beziers.concat(fitCubic_tang(points.slice(splitPoint),        tangents.slice(splitPoint)       , error, progressCallback));\r\n    return beziers;\r\n};\r\n\r\n\r\n\r\n\r\nfunction fitCubic(points, leftTangent, rightTangent, error, progressCallback) {\r\n    const MaxIterations = 20;   //Max times to try iterating (to find an acceptable curve)\r\n\r\n    var bezCurve,               //Control points of fitted Bezier curve\r\n        u,                      //Parameter values for point\r\n        uPrime,                 //Improved parameter values\r\n        maxError, prevErr,      //Maximum fitting error\r\n        splitPoint, prevSplit,  //Point to split point set at if we need more than one curve\r\n        centerVector, toCenterTangent, fromCenterTangent,  //Unit tangent vector(s) at splitPoint\r\n        beziers,                //Array of fitted Bezier curves if we need more than one curve\r\n        dist, i;\r\n\r\n    //console.log('fitCubic, ', points.length);\r\n    //console.log(points);\r\n    //console.log(tangents);\r\n    //console.log(leftTangent,rightTangent);\r\n    \r\n    //Use heuristic if region only has two points in it\r\n    if (points.length === 2) {\r\n        dist = maths.vectorLen(maths.subtract(points[0], points[1])) / 3.0;\r\n        bezCurve = [\r\n            points[0],\r\n            maths.addArrays(points[0], maths.mulItems(leftTangent,  dist)),\r\n            maths.addArrays(points[1], maths.mulItems(rightTangent, dist)),\r\n            points[1]\r\n        ];\r\n        return [bezCurve];\r\n    }\r\n\r\n\r\n    //Parameterize points, and attempt to fit curve\r\n    u = chordLengthParameterize(points);\r\n    [bezCurve, maxError, splitPoint] = generateAndReport(points, u, u, leftTangent, rightTangent, progressCallback)\r\n\r\n    if (maxError < error) {\r\n        return [bezCurve];\r\n    }\r\n    //If error not too large, try some reparameterization and iteration\r\n    if (maxError < (error*error)) {\r\n\r\n        uPrime = u;\r\n        prevErr = maxError;\r\n        prevSplit = splitPoint;\r\n\r\n        for (i = 0; i < MaxIterations; i++) {\r\n\r\n            uPrime = reparameterize(bezCurve, points, uPrime);\r\n            [bezCurve, maxError, splitPoint] = generateAndReport(points, u, uPrime, leftTangent, rightTangent, progressCallback);\r\n\r\n            if (maxError < error) {\r\n                return [bezCurve];\r\n            }\r\n            //If the development of the fitted curve grinds to a halt,\r\n            //we abort this attempt (and try a shorter curve):\r\n            else if(splitPoint === prevSplit) {\r\n                let errChange = maxError/prevErr;\r\n                if((errChange > .9999) && (errChange < 1.0001)) {\r\n                    break;\r\n                }\r\n            }\r\n\r\n            prevErr = maxError;\r\n            prevSplit = splitPoint;\r\n        }\r\n    }\r\n\r\n    //Fitting failed -- split at max error point and fit recursively\r\n    beziers = [];\r\n\r\n    //To create a smooth transition from one curve segment to the next, we\r\n    //calculate the line between the points directly before and after the\r\n    //center, and use that as the tangent both to and from the center point.\r\n    centerVector = maths.subtract(points[splitPoint-1], points[splitPoint+1]);\r\n    //However, this won't work if they're the same point, because the line we\r\n    //want to use as a tangent would be 0. Instead, we calculate the line from\r\n    //that \"double-point\" to the center point, and use its tangent.\r\n    if(centerVector.every(val => val === 0)) {\r\n        //[x,y] -> [-y,x]: http://stackoverflow.com/a/4780141/1869660\r\n        centerVector = maths.subtract(points[splitPoint-1], points[splitPoint]);\r\n        [centerVector[0],centerVector[1]] = [-centerVector[1],centerVector[0]];\r\n    }\r\n    toCenterTangent = maths.normalize(centerVector);\r\n    //To and from need to point in opposite directions:\r\n    fromCenterTangent = maths.mulItems(toCenterTangent, -1);\r\n\r\n    /*\r\n    Note: An alternative to this \"divide and conquer\" recursion could be to always\r\n          let new curve segments start by trying to go all the way to the end,\r\n          instead of only to the end of the current subdivided polyline.\r\n          That might let many segments fit a few points more, reducing the number of total segments.\r\n\r\n          However, a few tests have shown that the segment reduction is insignificant\r\n          (240 pts, 100 err: 25 curves vs 27 curves. 140 pts, 100 err: 17 curves on both),\r\n          and the results take twice as many steps and milliseconds to finish,\r\n          without looking any better than what we already have.\r\n    */\r\n    beziers = beziers.concat(fitCubic(points.slice(0, splitPoint + 1), leftTangent, toCenterTangent,    error, progressCallback));\r\n    beziers = beziers.concat(fitCubic(points.slice(splitPoint),        fromCenterTangent, rightTangent, error, progressCallback));\r\n    return beziers;\r\n};\r\n\r\nfunction generateAndReport(points, paramsOrig, paramsPrime, leftTangent, rightTangent, progressCallback) {\r\n    var bezCurve, maxError, splitPoint;\r\n\r\n    bezCurve = generateBezier(points, paramsPrime, leftTangent, rightTangent, progressCallback);\r\n    //Find max deviation of points to fitted curve.\r\n    //Here we always use the original parameters (from chordLengthParameterize()),\r\n    //because we need to compare the current curve to the actual source polyline,\r\n    //and not the currently iterated parameters which reparameterize() & generateBezier() use,\r\n    //as those have probably drifted far away and may no longer be in ascending order.\r\n    [maxError, splitPoint] = computeMaxError(points, bezCurve, paramsOrig);\r\n\r\n    if(progressCallback) {\r\n        progressCallback({\r\n            bez: bezCurve,\r\n            points: points,\r\n            params: paramsOrig,\r\n            maxErr: maxError,\r\n            maxPoint: splitPoint,\r\n        });\r\n    }\r\n\r\n    return [bezCurve, maxError, splitPoint];\r\n}\r\n\r\n/**\r\n * Use least-squares method to find Bezier control points for region.\r\n *\r\n * @param {Array<Array<Number>>} points - Array of digitized points\r\n * @param {Array<Number>} parameters - Parameter values for region\r\n * @param {Array<Number>} leftTangent - Unit tangent vector at start point\r\n * @param {Array<Number>} rightTangent - Unit tangent vector at end point\r\n * @returns {Array<Array<Number>>} Approximated Bezier curve: [first-point, control-point-1, control-point-2, second-point] where points are [x, y]\r\n */\r\nfunction generateBezier(points, parameters, leftTangent, rightTangent) {\r\n    var bezCurve,                       //Bezier curve ctl pts\r\n        A, a,                           //Precomputed rhs for eqn\r\n        C, X,                           //Matrices C & X\r\n        det_C0_C1, det_C0_X, det_X_C1,  //Determinants of matrices\r\n        alpha_l, alpha_r,               //Alpha values, left and right\r\n\r\n        epsilon, segLength,\r\n        i, len, tmp, u, ux,\r\n        firstPoint = points[0],\r\n        lastPoint = points[points.length-1];\r\n\r\n    bezCurve = [firstPoint, null, null, lastPoint];\r\n    //console.log('gb', parameters.length);\r\n\r\n    //Compute the A's\r\n    A = maths.zeros_Xx2x2(parameters.length);\r\n    for (i = 0, len = parameters.length; i < len; i++) {\r\n        u = parameters[i];\r\n        ux = 1 - u;\r\n        a = A[i];\r\n\r\n        a[0] = maths.mulItems(leftTangent,  3 * u  * (ux*ux));\r\n        a[1] = maths.mulItems(rightTangent, 3 * ux * (u*u));\r\n    }\r\n\r\n    //Create the C and X matrices\r\n    C = [[0,0], [0,0]];\r\n    X = [0,0];\r\n    for (i = 0, len = points.length; i < len; i++) {\r\n        u = parameters[i];\r\n        a = A[i];\r\n\r\n        C[0][0] += maths.dot(a[0], a[0]);\r\n        C[0][1] += maths.dot(a[0], a[1]);\r\n        C[1][0] += maths.dot(a[0], a[1]);\r\n        C[1][1] += maths.dot(a[1], a[1]);\r\n\r\n        tmp = maths.subtract(points[i], bezier.q([firstPoint, firstPoint, lastPoint, lastPoint], u));\r\n\r\n        X[0] += maths.dot(a[0], tmp);\r\n        X[1] += maths.dot(a[1], tmp);\r\n    }\r\n\r\n    //Compute the determinants of C and X\r\n    det_C0_C1 = (C[0][0] * C[1][1]) - (C[1][0] * C[0][1]);\r\n    det_C0_X  = (C[0][0] * X[1]   ) - (C[1][0] * X[0]   );\r\n    det_X_C1  = (X[0]    * C[1][1]) - (X[1]    * C[0][1]);\r\n\r\n    //Finally, derive alpha values\r\n    alpha_l = det_C0_C1 === 0 ? 0 : det_X_C1 / det_C0_C1;\r\n    alpha_r = det_C0_C1 === 0 ? 0 : det_C0_X / det_C0_C1;\r\n\r\n    //If alpha negative, use the Wu/Barsky heuristic (see text).\r\n    //If alpha is 0, you get coincident control points that lead to\r\n    //divide by zero in any subsequent NewtonRaphsonRootFind() call.\r\n    segLength = maths.vectorLen(maths.subtract(firstPoint, lastPoint));\r\n    epsilon = 1.0e-6 * segLength;\r\n    if (alpha_l < epsilon || alpha_r < epsilon) {\r\n        //Fall back on standard (probably inaccurate) formula, and subdivide further if needed.\r\n        bezCurve[1] = maths.addArrays(firstPoint, maths.mulItems(leftTangent,  segLength / 3.0));\r\n        bezCurve[2] = maths.addArrays(lastPoint,  maths.mulItems(rightTangent, segLength / 3.0));\r\n    } else {\r\n        //First and last control points of the Bezier curve are\r\n        //positioned exactly at the first and last data points\r\n        //Control points 1 and 2 are positioned an alpha distance out\r\n        //on the tangent vectors, left and right, respectively\r\n        bezCurve[1] = maths.addArrays(firstPoint, maths.mulItems(leftTangent,  alpha_l));\r\n        bezCurve[2] = maths.addArrays(lastPoint,  maths.mulItems(rightTangent, alpha_r));\r\n    }\r\n\r\n    return bezCurve;\r\n};\r\n\r\n/**\r\n * Given set of points and their parameterization, try to find a better parameterization.\r\n *\r\n * @param {Array<Array<Number>>} bezier - Current fitted curve\r\n * @param {Array<Array<Number>>} points - Array of digitized points\r\n * @param {Array<Number>} parameters - Current parameter values\r\n * @returns {Array<Number>} New parameter values\r\n */\r\nfunction reparameterize(bezier, points, parameters) {\r\n    /*\r\n    var j, len, point, results, u;\r\n    results = [];\r\n    for (j = 0, len = points.length; j < len; j++) {\r\n        point = points[j], u = parameters[j];\r\n\r\n        results.push(newtonRaphsonRootFind(bezier, point, u));\r\n    }\r\n    return results;\r\n    //*/\r\n    return parameters.map((p, i) => newtonRaphsonRootFind(bezier, points[i], p));\r\n};\r\n\r\n/**\r\n * Use Newton-Raphson iteration to find better root.\r\n *\r\n * @param {Array<Array<Number>>} bez - Current fitted curve\r\n * @param {Array<Number>} point - Digitized point\r\n * @param {Number} u - Parameter value for \"P\"\r\n * @returns {Number} New u\r\n */\r\nfunction newtonRaphsonRootFind(bez, point, u) {\r\n    /*\r\n        Newton's root finding algorithm calculates f(x)=0 by reiterating\r\n        x_n+1 = x_n - f(x_n)/f'(x_n)\r\n        We are trying to find curve parameter u for some point p that minimizes\r\n        the distance from that point to the curve. Distance point to curve is d=q(u)-p.\r\n        At minimum distance the point is perpendicular to the curve.\r\n        We are solving\r\n        f = q(u)-p * q'(u) = 0\r\n        with\r\n        f' = q'(u) * q'(u) + q(u)-p * q''(u)\r\n        gives\r\n        u_n+1 = u_n - |q(u_n)-p * q'(u_n)| / |q'(u_n)**2 + q(u_n)-p * q''(u_n)|\r\n    */\r\n\r\n    var d = maths.subtract(bezier.q(bez, u), point),\r\n        qprime = bezier.qprime(bez, u),\r\n        numerator = maths.mulMatrix(d, qprime),\r\n        denominator = maths.sum(maths.squareItems(qprime)) + 2 * maths.mulMatrix(d, bezier.qprimeprime(bez, u));\r\n\r\n    if (denominator === 0) {\r\n        return u;\r\n    } else {\r\n        return u - (numerator/denominator);\r\n    }\r\n};\r\n\r\n/**\r\n * Assign parameter values to digitized points using relative distances between points.\r\n *\r\n * @param {Array<Array<Number>>} points - Array of digitized points\r\n * @returns {Array<Number>} Parameter values\r\n */\r\nfunction chordLengthParameterize(points) {\r\n    var u = [], currU, prevU, prevP;\r\n\r\n    points.forEach((p, i) => {\r\n        currU = i ? prevU + maths.vectorLen(maths.subtract(p, prevP))\r\n                  : 0;\r\n        u.push(currU);\r\n\r\n        prevU = currU;\r\n        prevP = p;\r\n    })\r\n    u = u.map(x => x/prevU);\r\n\r\n    return u;\r\n};\r\n\r\n/**\r\n * Find the maximum squared distance of digitized points to fitted curve.\r\n *\r\n * @param {Array<Array<Number>>} points - Array of digitized points\r\n * @param {Array<Array<Number>>} bez - Fitted curve\r\n * @param {Array<Number>} parameters - Parameterization of points\r\n * @returns {Array<Number>} Maximum error (squared) and point of max error\r\n */\r\nfunction computeMaxError(points, bez, parameters) {\r\n    var dist,       //Current error\r\n        maxDist,    //Maximum error\r\n        splitPoint, //Point of maximum error\r\n        v,          //Vector from point to curve\r\n        i, count, point, t;\r\n\r\n    maxDist = 0;\r\n    splitPoint = points.length / 2;\r\n\r\n    const t_distMap = mapTtoRelativeDistances(bez, 10);\r\n\r\n    for (i = 0, count = points.length; i < count; i++) {\r\n        point = points[i];\r\n        //Find 't' for a point on the bez curve that's as close to 'point' as possible:\r\n        t = find_t(bez, parameters[i], t_distMap, 10);\r\n\r\n        v = maths.subtract(bezier.q(bez, t), point);\r\n        dist = v[0]*v[0] + v[1]*v[1];\r\n\r\n        if (dist > maxDist) {\r\n            maxDist = dist;\r\n            splitPoint = i;\r\n        }\r\n    }\r\n\r\n    return [maxDist, splitPoint];\r\n};\r\n\r\n//Sample 't's and map them to relative distances along the curve:\r\nvar mapTtoRelativeDistances = function (bez, B_parts) {\r\n    var B_t_curr;\r\n    var B_t_dist = [0];\r\n    var B_t_prev = bez[0];\r\n    var sumLen = 0;\r\n\r\n    for (var i=1; i<=B_parts; i++) {\r\n      B_t_curr = bezier.q(bez, i/B_parts);\r\n\r\n      sumLen += maths.vectorLen(maths.subtract(B_t_curr, B_t_prev));\r\n\r\n      B_t_dist.push(sumLen);\r\n      B_t_prev = B_t_curr;\r\n    }\r\n\r\n    //Normalize B_length to the same interval as the parameter distances; 0 to 1:\r\n    B_t_dist = B_t_dist.map(x => x/sumLen);\r\n    return B_t_dist;\r\n};\r\n\r\nfunction find_t(bez, param, t_distMap, B_parts) {\r\n    if(param < 0) { return 0; }\r\n    if(param > 1) { return 1; }\r\n\r\n    /*\r\n        'param' is a value between 0 and 1 telling us the relative position\r\n        of a point on the source polyline (linearly from the start (0) to the end (1)).\r\n        To see if a given curve - 'bez' - is a close approximation of the polyline,\r\n        we compare such a poly-point to the point on the curve that's the same\r\n        relative distance along the curve's length.\r\n\r\n        But finding that curve-point takes a little work:\r\n        There is a function \"B(t)\" to find points along a curve from the parametric parameter 't'\r\n        (also relative from 0 to 1: http://stackoverflow.com/a/32841764/1869660\r\n                                    http://pomax.github.io/bezierinfo/#explanation),\r\n        but 't' isn't linear by length (http://gamedev.stackexchange.com/questions/105230).\r\n\r\n        So, we sample some points along the curve using a handful of values for 't'.\r\n        Then, we calculate the length between those samples via plain euclidean distance;\r\n        B(t) concentrates the points around sharp turns, so this should give us a good-enough outline of the curve.\r\n        Thus, for a given relative distance ('param'), we can now find an upper and lower value\r\n        for the corresponding 't' by searching through those sampled distances.\r\n        Finally, we just use linear interpolation to find a better value for the exact 't'.\r\n\r\n        More info:\r\n            http://gamedev.stackexchange.com/questions/105230/points-evenly-spaced-along-a-bezier-curve\r\n            http://stackoverflow.com/questions/29438398/cheap-way-of-calculating-cubic-bezier-length\r\n            http://steve.hollasch.net/cgindex/curves/cbezarclen.html\r\n            https://github.com/retuxx/tinyspline\r\n    */\r\n    var lenMax, lenMin, tMax, tMin, t;\r\n\r\n    //Find the two t-s that the current param distance lies between,\r\n    //and then interpolate a somewhat accurate value for the exact t:\r\n    for(var i = 1; i <= B_parts; i++) {\r\n\r\n        if(param <= t_distMap[i]) {\r\n            tMin   = (i-1) / B_parts;\r\n            tMax   = i / B_parts;\r\n            lenMin = t_distMap[i-1];\r\n            lenMax = t_distMap[i];\r\n\r\n            t = (param-lenMin)/(lenMax-lenMin) * (tMax-tMin) + tMin;\r\n            break;\r\n        }\r\n    }\r\n    return t;\r\n}\r\n\r\n/**\r\n * Creates a vector of length 1 which shows the direction from B to A\r\n */\r\nfunction createTangent(pointA, pointB) {\r\n    return maths.normalize(maths.subtract(pointA, pointB));\r\n}\r\n\r\n/*\r\n    Simplified versions of what we need from math.js\r\n    Optimized for our input, which is only numbers and 1x2 arrays (i.e. [x, y] coordinates).\r\n*/\r\nclass maths {\r\n    //zeros = logAndRun(math.zeros);\r\n    static zeros_Xx2x2(x) {\r\n        var zs = [];\r\n        while(x--) { zs.push([0,0]); }\r\n        return zs\r\n    }\r\n\r\n    //multiply = logAndRun(math.multiply);\r\n    static mulItems(items, multiplier) {\r\n        return items.map(x => x*multiplier);\r\n    }\r\n    static mulMatrix(m1, m2) {\r\n        //https://en.wikipedia.org/wiki/Matrix_multiplication#Matrix_product_.28two_matrices.29\r\n        //Simplified to only handle 1-dimensional matrices (i.e. arrays) of equal length:\r\n         return m1.reduce((sum,x1,i) => sum + (x1*m2[i]), 0);\r\n    }\r\n\r\n    //Only used to subract to points (or at least arrays):\r\n    //  subtract = logAndRun(math.subtract);\r\n    static subtract(arr1, arr2) {\r\n        return arr1.map((x1, i) => x1 - arr2[i]);\r\n    }\r\n\r\n    //add = logAndRun(math.add);\r\n    static addArrays(arr1, arr2) {\r\n        return arr1.map((x1, i) => x1 + arr2[i]);\r\n    }\r\n    static addItems(items, addition) {\r\n        return items.map(x => x+addition);\r\n    }\r\n\r\n    //var sum = logAndRun(math.sum);\r\n    static sum(items) {\r\n        return items.reduce((sum,x) => sum + x);\r\n    }\r\n\r\n    //chain = math.chain;\r\n\r\n    //Only used on two arrays. The dot product is equal to the matrix product in this case:\r\n    //  dot = logAndRun(math.dot);\r\n    static dot(m1, m2) {\r\n        return maths.mulMatrix(m1, m2);\r\n    }\r\n\r\n    //https://en.wikipedia.org/wiki/Norm_(mathematics)#Euclidean_norm\r\n    //  var norm = logAndRun(math.norm);\r\n    static vectorLen(v) {\r\n        return Math.hypot(...v);\r\n    }\r\n\r\n    //math.divide = logAndRun(math.divide);\r\n    static divItems(items, divisor) {\r\n        return items.map(x => x/divisor);\r\n    }\r\n\r\n    //var dotPow = logAndRun(math.dotPow);\r\n    static squareItems(items) {\r\n        return items.map(x => x*x);\r\n    }\r\n\r\n    static normalize(v) {\r\n        return this.divItems(v, this.vectorLen(v));\r\n    }\r\n\r\n    //Math.pow = logAndRun(Math.pow);\r\n}\r\n\r\n\r\nclass bezier {\r\n    //Evaluates cubic bezier at t, return point\r\n    static q(ctrlPoly, t) {\r\n        var tx = 1.0 - t;\r\n        var pA = maths.mulItems( ctrlPoly[0],      tx * tx * tx ),\r\n            pB = maths.mulItems( ctrlPoly[1],  3 * tx * tx *  t ),\r\n            pC = maths.mulItems( ctrlPoly[2],  3 * tx *  t *  t ),\r\n            pD = maths.mulItems( ctrlPoly[3],       t *  t *  t );\r\n        return maths.addArrays(maths.addArrays(pA, pB), maths.addArrays(pC, pD));\r\n    }\r\n\r\n    //Evaluates cubic bezier first derivative at t, return point\r\n    static qprime(ctrlPoly, t) {\r\n        var tx = 1.0 - t;\r\n        var pA = maths.mulItems( maths.subtract(ctrlPoly[1], ctrlPoly[0]),  3 * tx * tx ),\r\n            pB = maths.mulItems( maths.subtract(ctrlPoly[2], ctrlPoly[1]),  6 * tx *  t ),\r\n            pC = maths.mulItems( maths.subtract(ctrlPoly[3], ctrlPoly[2]),  3 *  t *  t );\r\n        return maths.addArrays(maths.addArrays(pA, pB), pC);\r\n    }\r\n\r\n    //Evaluates cubic bezier second derivative at t, return point\r\n    static qprimeprime(ctrlPoly, t) {\r\n        return maths.addArrays(maths.mulItems( maths.addArrays(maths.subtract(ctrlPoly[2], maths.mulItems(ctrlPoly[1], 2)), ctrlPoly[0]),  6 * (1.0 - t) ),\r\n                               maths.mulItems( maths.addArrays(maths.subtract(ctrlPoly[3], maths.mulItems(ctrlPoly[2], 2)), ctrlPoly[1]),  6 *        t  ));\r\n    }\r\n}\r\n\r\n//module.exports = fitCurve;\r\n","import {unit_normal_vector, rad_to_vector, get_rad} from \"./util\";\r\nimport {Polygon} from \"./polygon\";\r\nimport {fitCubic_tang, fitCurve} from \"./fit-curve\";\r\nconst bezier_steps = 200;\r\nexport class Bezier{\r\n  static generalBezier(x_fun, y_fun, dx_fun, dy_fun, width_func, width_func_d){\r\n    var a1 = [];\r\n    var a2 = [];\r\n    var tang1 = [];\r\n    var tang2 = [];\r\n    for (var tt = 0; tt <= bezier_steps; tt++) {\r\n      const t = tt / bezier_steps;\r\n      const x = x_fun(t);\r\n      const y = y_fun(t);\r\n      const vx = dx_fun(t);\r\n      const vy = dy_fun(t);\r\n\r\n      let [ia, ib] = unit_normal_vector(vx, vy);\r\n      const deltad = width_func(t);\r\n      ia = ia * deltad;\r\n      ib = ib * deltad;\r\n      \r\n      const rad = get_rad(vx, vy);\r\n      const velocity = Math.sqrt(vx*vx+vy*vy);\r\n      const width_rad = Math.atan(width_func_d(t)/velocity);\r\n      a1.push([x - ia, y - ib]);\r\n      a2.push([x + ia, y + ib]);\r\n      tang1.push(rad_to_vector(rad-width_rad));\r\n      tang2.push(rad_to_vector(rad+width_rad-Math.PI));\r\n    }\r\n    const bez1 = fitCubic_tang(a1, tang1, 0.03);\r\n    const bez2 = fitCubic_tang(a2.reverse(), tang2.reverse(), 0.03);\r\n    //const bez1 = fitCurve(a1, 0.01);\r\n    //const bez2 = fitCurve(a2.reverse(), 0.01);\r\n    return [bez1, bez2];\r\n  }\r\n  static generalBezier2(x_fun, y_fun, dx_fun, dy_fun, width_func, width_func_d, dir_func){\r\n    //offset vector (ia, ib) is calculated with dir_func\r\n    var a1 = [];\r\n    var a2 = [];\r\n    var tang1 = [];\r\n    var tang2 = [];\r\n    for (var tt = 0; tt <= bezier_steps; tt++) {\r\n      const t = tt / bezier_steps;\r\n      const x = x_fun(t);\r\n      const y = y_fun(t);\r\n      const vx = dx_fun(t);\r\n      const vy = dy_fun(t);\r\n\r\n      let [ia, ib] = dir_func(t);\r\n      const deltad = width_func(t);\r\n      ia = ia * deltad;\r\n      ib = ib * deltad;\r\n      \r\n      const rad = get_rad(vx, vy);\r\n      const velocity = Math.sqrt(vx*vx+vy*vy);\r\n      const width_rad = Math.atan(width_func_d(t)/velocity);\r\n      a1.push([x - ia, y - ib]);\r\n      a2.push([x + ia, y + ib]);\r\n      tang1.push(rad_to_vector(rad-width_rad));\r\n      tang2.push(rad_to_vector(rad+width_rad-Math.PI));\r\n    }\r\n    const bez1 = fitCubic_tang(a1, tang1, 0.03);\r\n    const bez2 = fitCubic_tang(a2.reverse(), tang2.reverse(), 0.03);\r\n    //const bez1 = fitCurve(a1, 0.03);\r\n    //const bez2 = fitCurve(a2.reverse(), 0.03);\r\n    return [bez1, bez2];\r\n  }\r\n\r\n  static qBezier(x1, y1, sx, sy, x2, y2, width_func, width_func_d){\r\n    const x_fun = t => ((1.0 - t) * (1.0 - t) * x1 + 2.0 * t * (1.0 - t) * sx + t * t * x2);\r\n    const y_fun = t => ((1.0 - t) * (1.0 - t) * y1 + 2.0 * t * (1.0 - t) * sy + t * t * y2);\r\n    const dx_fun = t => (x1 - 2.0 * sx + x2) * 2.0 * t + (-2.0 * x1 + 2.0 * sx);\r\n    const dy_fun = t => (y1 - 2.0 * sy + y2) * 2.0 * t + (-2.0 * y1 + 2.0 * sy);\r\n    return this.generalBezier(x_fun, y_fun, dx_fun, dy_fun, width_func, width_func_d);\r\n  }\r\n  static qBezier2(x1, y1, sx, sy, x2, y2, width_func, width_func_d){\r\n    //similar to qBezier(), but the direction changes at a constant speed (not decided by normal vector)\r\n    const x_fun = t => ((1.0 - t) * (1.0 - t) * x1 + 2.0 * t * (1.0 - t) * sx + t * t * x2);\r\n    const y_fun = t => ((1.0 - t) * (1.0 - t) * y1 + 2.0 * t * (1.0 - t) * sy + t * t * y2);\r\n    const dx_fun = t => (x1 - 2.0 * sx + x2) * 2.0 * t + (-2.0 * x1 + 2.0 * sx);\r\n    const dy_fun = t => (y1 - 2.0 * sy + y2) * 2.0 * t + (-2.0 * y1 + 2.0 * sy);\r\n    const rad_begin = Math.atan2(sy-y1, sx-x1);\r\n    var rad_end = Math.atan2(y2-sy, x2-sx);\r\n    if(rad_end - rad_begin > Math.PI) {\r\n      rad_end -= Math.PI*2;\r\n    }else if(rad_begin - rad_end > Math.PI){\r\n      rad_end += Math.PI*2;\r\n    }\r\n    const dir_func = t => rad_to_vector((1-t)*rad_begin+t*rad_end+Math.PI/2);\r\n    return this.generalBezier2(x_fun, y_fun, dx_fun, dy_fun, width_func, width_func_d, dir_func);\r\n  }\r\n  \r\n  static cBezier(x1, y1, sx1, sy1, sx2, sy2, x2, y2, width_func, width_func_d){\r\n    const x_fun = t => (1.0 - t) * (1.0 - t) * (1.0 - t) * x1 + 3.0 * t * (1.0 - t) * (1.0 - t) * sx1 + 3 * t * t * (1.0 - t) * sx2 + t * t * t * x2;\r\n    const y_fun = t => (1.0 - t) * (1.0 - t) * (1.0 - t) * y1 + 3.0 * t * (1.0 - t) * (1.0 - t) * sy1 + 3 * t * t * (1.0 - t) * sy2 + t * t * t * y2;\r\n    const dx_fun = t => t * t * (-3 * x1 + 9 * sx1 + -9 * sx2 + 3 * x2) + t * (6 * x1 + -12 * sx1 + 6 * sx2) + -3 * x1 + 3 * sx1;\r\n    const dy_fun = t => t * t * (-3 * y1 + 9 * sy1 + -9 * sy2 + 3 * y2) + t * (6 * y1 + -12 * sy1 + 6 * sy2) + -3 * y1 + 3 * sy1;\r\n    return this.generalBezier(x_fun, y_fun, dx_fun, dy_fun, width_func, width_func_d);\r\n  }\r\n  \r\n  static slantBezier(x_fun, y_fun, dx_fun, dy_fun, width_func, width_func_d, dir_x, dir_y){\r\n    var a1 = [];\r\n    var a2 = [];\r\n    var tang1 = [];\r\n    var tang2 = [];\r\n    let [ia, ib] = unit_normal_vector(dir_x, dir_y);\r\n    let len = Math.sqrt(dir_x*dir_x+dir_y*dir_y);\r\n    let ex = dir_x/len;\r\n    let ey = dir_y/len;\r\n    \r\n    for (var tt = 0; tt <= bezier_steps; tt++) {\r\n      const t = tt / bezier_steps;\r\n      const x = x_fun(t);\r\n      const y = y_fun(t);\r\n      const vx = dx_fun(t);\r\n      const vy = dy_fun(t);\r\n\r\n      const deltad = width_func(t);\r\n      \r\n      const velocity = (dir_x*vx+dir_y*vy)/Math.sqrt(dir_x*dir_x+dir_y*dir_y);\r\n      const width_tan = width_func_d(t)/velocity;\r\n      const bez_tan = (dir_x*vy-dir_y*vx)/(dir_x*vx+dir_y*vy);\r\n      const rad1 = Math.atan(bez_tan-width_tan);\r\n      const rad2 = Math.atan(bez_tan+width_tan);\r\n      a1.push([x - ia * deltad, y - ib * deltad]);\r\n      a2.push([x + ia * deltad, y + ib * deltad]);\r\n      tang1.push([ Math.cos(rad1)*ex-Math.sin(rad1)*ey,  Math.sin(rad1)*ex+Math.cos(rad1)*ey]);\r\n      tang2.push([-Math.cos(rad2)*ex+Math.sin(rad2)*ey, -Math.sin(rad2)*ex-Math.cos(rad2)*ey]);\r\n    }\r\n    const bez1 = fitCubic_tang(a1, tang1, 0.03);\r\n    const bez2 = fitCubic_tang(a2.reverse(), tang2.reverse(), 0.03);\r\n    //const bez1 = fitCurve(a1, 0.01);\r\n    //const bez2 = fitCurve(a2.reverse(), 0.01);\r\n    return [bez1, bez2];\r\n  }\r\n\r\n  static qBezier_slant(x1, y1, sx, sy, x2, y2, width_func, width_func_d){\r\n    const x_fun = t => ((1.0 - t) * (1.0 - t) * x1 + 2.0 * t * (1.0 - t) * sx + t * t * x2);\r\n    const y_fun = t => ((1.0 - t) * (1.0 - t) * y1 + 2.0 * t * (1.0 - t) * sy + t * t * y2);\r\n    const dir_x = x2 - x1;\r\n    const dir_y = y2 - y1;\r\n    const dx_fun = t => (x1 - 2.0 * sx + x2) * 2.0 * t + (-2.0 * x1 + 2.0 * sx);\r\n    const dy_fun = t => (y1 - 2.0 * sy + y2) * 2.0 * t + (-2.0 * y1 + 2.0 * sy);\r\n    return this.slantBezier(x_fun, y_fun, dx_fun, dy_fun, width_func, width_func_d, dir_x, dir_y);\r\n  }\r\n  static cBezier_slant(x1, y1, sx1, sy1, sx2, sy2, x2, y2, width_func, width_func_d){\r\n    const x_fun = t => (1.0 - t) * (1.0 - t) * (1.0 - t) * x1 + 3.0 * t * (1.0 - t) * (1.0 - t) * sx1 + 3 * t * t * (1.0 - t) * sx2 + t * t * t * x2;\r\n    const y_fun = t => (1.0 - t) * (1.0 - t) * (1.0 - t) * y1 + 3.0 * t * (1.0 - t) * (1.0 - t) * sy1 + 3 * t * t * (1.0 - t) * sy2 + t * t * t * y2;\r\n    const dx_fun = t => t * t * (-3 * x1 + 9 * sx1 + -9 * sx2 + 3 * x2) + t * (6 * x1 + -12 * sx1 + 6 * sx2) + -3 * x1 + 3 * sx1;\r\n    const dy_fun = t => t * t * (-3 * y1 + 9 * sy1 + -9 * sy2 + 3 * y2) + t * (6 * y1 + -12 * sy1 + 6 * sy2) + -3 * y1 + 3 * sy1;\r\n    const dir_x = x2 - x1;\r\n    const dir_y = y2 - y1;\r\n    return this.slantBezier(x_fun, y_fun, dx_fun, dy_fun, width_func, width_func_d, dir_x, dir_y);\r\n  }\r\n  \r\n static bez_to_poly(bez){\r\n    var poly = new Polygon();\r\n    poly.push(bez[0][0][0], bez[0][0][1]);\r\n    for(let bez1 of bez){\r\n      poly.push(bez1[1][0], bez1[1][1], 2);\r\n      poly.push(bez1[2][0], bez1[2][1], 2);\r\n      poly.push(bez1[3][0], bez1[3][1]);\r\n    }\r\n    return poly;\r\n  }\r\n}","import { Polygons } from \"./polygons\";\nimport { Polygon } from \"./polygon\";\nimport { PointMaker } from \"./pointmaker\";\nimport { Bezier} from \"./bezier\";\nimport {vector_to_len, bez_cir, get_dir, DIR_POSY} from \"./util\";\nexport class FontCanvas {\n  constructor() {\n    this.polygons = new Polygons();\n  }\n  getPolygons() {\n    return this.polygons;\n  }\n  addPolygon(poly) {\n    this.polygons.push(poly);\n  }\n\n  //flipping and rotating\n  //polygons in the rectangle (x1, y1, x2, y2) are flipped or rotated\n  flip_left_right(x1, y1, x2, y2) {\n    for (var i = 0; i < this.polygons.array.length; i++) {\n      var inside = true;\n      for (var j = 0; j < this.polygons.array[i].array.length; j++) {\n        if (x1 > this.polygons.array[i].array[j].x || this.polygons.array[i].array[j].x > x2 ||\n          y1 > this.polygons.array[i].array[j].y || this.polygons.array[i].array[j].y > y2) {\n          inside = false;\n        }\n      }\n      if (inside) {\n        for (var j = 0; j < this.polygons.array[i].array.length; j++) {\n          this.polygons.array[i].array[j].x = x2 - (this.polygons.array[i].array[j].x - x1);\n          this.polygons.array[i].array[j].x = Math.floor(this.polygons.array[i].array[j].x * 10) / 10;\n        }\n      }\n    }\n  }\n\n  flip_up_down(x1, y1, x2, y2) {\n    for (var i = 0; i < this.polygons.array.length; i++) {\n      var inside = true;\n      for (var j = 0; j < this.polygons.array[i].array.length; j++) {\n        if (x1 > this.polygons.array[i].array[j].x || this.polygons.array[i].array[j].x > x2 ||\n          y1 > this.polygons.array[i].array[j].y || this.polygons.array[i].array[j].y > y2) {\n          inside = false;\n        }\n      }\n      if (inside) {\n        for (var j = 0; j < this.polygons.array[i].array.length; j++) {\n          this.polygons.array[i].array[j].y = y2 - (this.polygons.array[i].array[j].y - y1);\n          this.polygons.array[i].array[j].y = Math.floor(this.polygons.array[i].array[j].y * 10) / 10;\n        }\n      }\n    }\n  }\n  \n  rotate90(x1, y1, x2, y2) {\n    for (var i = 0; i < this.polygons.array.length; i++) {\n      var inside = true;\n      for (var j = 0; j < this.polygons.array[i].array.length; j++) {\n        if (x1 > this.polygons.array[i].array[j].x || this.polygons.array[i].array[j].x > x2 ||\n          y1 > this.polygons.array[i].array[j].y || this.polygons.array[i].array[j].y > y2) {\n          inside = false;\n        }\n      }\n      if (inside) {\n        for (var j = 0; j < this.polygons.array[i].array.length; j++) {\n          var x = this.polygons.array[i].array[j].x;\n          var y = this.polygons.array[i].array[j].y;\n          this.polygons.array[i].array[j].x = x1 + (y2 - y);\n          this.polygons.array[i].array[j].y = y1 + (x - x1);\n          this.polygons.array[i].array[j].x = Math.floor(this.polygons.array[i].array[j].x * 10) / 10;\n          this.polygons.array[i].array[j].y = Math.floor(this.polygons.array[i].array[j].y * 10) / 10;\n        }\n      }\n    }\n  }\n\n  rotate180(x1, y1, x2, y2) {\n    for (var i = 0; i < this.polygons.array.length; i++) {\n      var inside = true;\n      for (var j = 0; j < this.polygons.array[i].array.length; j++) {\n        if (x1 > this.polygons.array[i].array[j].x || this.polygons.array[i].array[j].x > x2 ||\n          y1 > this.polygons.array[i].array[j].y || this.polygons.array[i].array[j].y > y2) {\n          inside = false;\n        }\n      }\n      if (inside) {\n        for (var j = 0; j < this.polygons.array[i].array.length; j++) {\n          var x = this.polygons.array[i].array[j].x;\n          var y = this.polygons.array[i].array[j].y;\n          this.polygons.array[i].array[j].x = x2 - (x - x1);\n          this.polygons.array[i].array[j].y = y2 - (y - y1);\n          this.polygons.array[i].array[j].x = Math.floor(this.polygons.array[i].array[j].x * 10) / 10;\n          this.polygons.array[i].array[j].y = Math.floor(this.polygons.array[i].array[j].y * 10) / 10;\n        }\n      }\n    }\n  }\n\n  rotate270(x1, y1, x2, y2) {\n    for (var i = 0; i < this.polygons.array.length; i++) {\n      var inside = true;\n      for (var j = 0; j < this.polygons.array[i].array.length; j++) {\n        if (x1 > this.polygons.array[i].array[j].x || this.polygons.array[i].array[j].x > x2 ||\n          y1 > this.polygons.array[i].array[j].y || this.polygons.array[i].array[j].y > y2) {\n          inside = false;\n        }\n      }\n      if (inside) {\n        for (var j = 0; j < this.polygons.array[i].array.length; j++) {\n          var x = this.polygons.array[i].array[j].x;\n          var y = this.polygons.array[i].array[j].y;\n          this.polygons.array[i].array[j].x = x1 + (y - y1);\n          this.polygons.array[i].array[j].y = y2 - (x - x1);\n          this.polygons.array[i].array[j].x = Math.floor(this.polygons.array[i].array[j].x * 10) / 10;\n          this.polygons.array[i].array[j].y = Math.floor(this.polygons.array[i].array[j].y * 10) / 10;\n        }\n      }\n    }\n  }\n\n  drawUpperLeftCorner(x1, y1, dir, kMinWidthT) {\n    var p = new PointMaker(x1, y1, dir, kMinWidthT);\n    var poly = new Polygon();\n    poly.push2(p.vec(0, 1));\n    poly.push2(p.vec(0, -1));\n    poly.push2(p.vec(-1, 1));\n    poly.reverse();\n    this.polygons.push(poly);\n  }\n\n  drawUpperRightCorner(x1, y1, kMinWidthT, kagekMinWidthY, kagekWidth) {\n    var p = new PointMaker(x1, y1);\n    var poly = new Polygon();\n    poly.push2(p.vec(-kMinWidthT,-kagekMinWidthY));\n    poly.push2(p.vec(0,-kagekMinWidthY - kagekWidth));\n    poly.push2(p.vec(kMinWidthT+kagekWidth,kagekMinWidthY));\n    poly.push2(p.vec(kMinWidthT,kMinWidthT*0.8), 2);\n    poly.push2(p.vec(0,kMinWidthT*1.2), 2);\n    poly.push2(p.vec(-kMinWidthT*0.9,kMinWidthT*1.2));\n    //poly.push2(p.vec(-kMinWidthT,kMinWidthT*1.3));\n    this.polygons.push(poly);\n  }\n\n  drawUpperRightCorner2(x1, y1, kMinWidthT, kagekMinWidthY, kagekWidth) {\n    var p = new PointMaker(x1, y1);\n    var poly = new Polygon();\n    poly.push2(p.vec(-kMinWidthT,-kagekMinWidthY));\n    poly.push2(p.vec(-kMinWidthT*1.1,-kagekMinWidthY));\n\n    poly.push2(p.vec(0,-kagekMinWidthY - kagekWidth));\n    //poly.push2(p.vec(-kMinWidthT*0.1,-kagekMinWidthY - kagekWidth*1.1));\n    \n    poly.push2(p.vec(kMinWidthT+kagekWidth,kagekMinWidthY));\n    poly.push2(p.vec(kMinWidthT,kMinWidthT*0.8), 2);\n    poly.push2(p.vec(0,kMinWidthT*1.2), 2);\n    poly.push2(p.vec(-kMinWidthT*0.9,kMinWidthT*1.2));\n    //poly.push2(p.vec(-kMinWidthT,kMinWidthT*1.3));\n    this.polygons.push(poly);\n  }\n  \n  drawUpperRightCorner_straight_v(x1, y1, kMinWidthT, kagekMinWidthY, kagekWidth) {//vertical straight line\n    var p = new PointMaker(x1, y1);\n    var poly = new Polygon();\n    poly.push2(p.vec(-kMinWidthT,-kagekMinWidthY));\n    poly.push2(p.vec(0,-kagekMinWidthY - kagekWidth));\n    poly.push2(p.vec(kMinWidthT+kagekWidth,kagekMinWidthY));\n    poly.push2(p.vec(kMinWidthT,kMinWidthT));\n    poly.push2(p.vec(-kMinWidthT,0));\n    this.polygons.push(poly);\n  }\n\n  drawOpenBegin_straight(x1, y1, kMinWidthT, kagekMinWidthY, dir) {\n    const rad_offset = Math.atan(kagekMinWidthY*0.5/kMinWidthT);\n    //const rad_offset = (0.1*Math.PI);\n    var poly = new Polygon();\n    let p1 = new PointMaker(x1, y1, dir);\n    let[x, y] = p1.vec(kagekMinWidthY*0.5, -kMinWidthT);\n    const offs_sin = Math.sin(rad_offset);\n    const offs_cos = Math.cos(rad_offset);\n    //let[x, y] = p1.vec(kMinWidthT*offs_sin/offs_cos, -kMinWidthT);\n    const new_dir = {sin: dir.sin*offs_cos+dir.cos*offs_sin, cos: dir.cos*offs_cos-dir.sin*offs_sin};\n    let p2 = new PointMaker(x, y, new_dir, kMinWidthT*0.876);\n    poly.push2(p2.vec(0, 0));\n    poly.push2(p2.vec(0, -1.4), 2);\n    poly.push2(p2.vec(0.6, -1.4), 2);\n    poly.push2(p2.vec(2.0, 1.0));\n    this.polygons.push(poly);\n  }\n\n  drawOpenBegin_curve_down2(x1, y1, dir, kMinWidthT, rad_offset){\n    var poly = new Polygon();\n    let p1 = new PointMaker(x1, y1, dir);\n    poly.push2(p1.vec(0, kMinWidthT));\n\n    let p2 = new PointMaker();\n    const offs_sin = Math.sin(rad_offset);\n    const offs_cos = Math.cos(rad_offset);\n    p2.setscale(kMinWidthT*0.876);\n    p2.setdir({sin: dir.sin*offs_cos+dir.cos*offs_sin, cos: dir.cos*offs_cos-dir.sin*offs_sin});\n    if(rad_offset>0){\n      poly.push2(p1.vec(-(offs_sin/offs_cos)*2*kMinWidthT, kMinWidthT));\n      let[x, y] = p1.vec(0, -kMinWidthT);\n      poly.push(x, y);\n      p2.setpos(x, y);\n      let[x2, y2] = p2.vec(0, -rad_offset);\n      p2.setpos(x2, y2);\n    }else{\n      let[x, y] = p1.vec(0+2*kMinWidthT*offs_sin, kMinWidthT-2*kMinWidthT*offs_cos);\n      p2.setpos(x, y);\n    }\n\n    poly.push2(p2.vec(0, 0));\n    poly.push2(p2.vec(0, -0.8), 2);\n    poly.push2(p2.vec(0.6, -0.8), 2);\n    poly.push2(p2.vec(1.8, 1.0));\n    this.polygons.push(poly);\n  }\n\n  drawOpenBegin_curve_down(x1, y1, dir, kMinWidthT, kagekMinWidthY){\n    const rad = Math.atan2(Math.abs(dir.sin), Math.abs(dir.cos));\n    var rad_offset;\n    if(rad > Math.PI * 0.2){//36 degrees\n      rad_offset = (0.1*Math.PI)*(rad-Math.PI * 0.2)/(Math.PI*0.3);\n    }else{\n      rad_offset = (-0.25*Math.PI)*(Math.PI*0.2-rad)/(Math.PI*0.2);\n    }\n    this.drawOpenBegin_curve_down2(x1, y1, dir, kMinWidthT, rad_offset);\n  }\n\n  drawOpenBegin_curve_up(x1, y1, dir, kMinWidthT, kagekMinWidthY) {\n    var poly = new Polygon();\n    let p1 = new PointMaker(x1, y1, dir);\n    const offs_sin = Math.sin(-0.1*Math.PI);\n    const offs_cos = Math.cos(-0.1*Math.PI);\n    poly.push2(p1.vec(0, -kMinWidthT));\n    poly.push2(p1.vec((offs_sin/offs_cos)*2*kMinWidthT, -kMinWidthT));\n\n    let p2 = new PointMaker();\n    p2.setscale(kMinWidthT*0.876);\n    p2.setdir({sin: dir.sin*offs_cos+dir.cos*offs_sin, cos: dir.cos*offs_cos-dir.sin*offs_sin});\n    let[x, y] = p1.vec(0, kMinWidthT);\n    p2.setpos(x, y);\n\n    poly.push2(p2.vec(0, 0));\n    poly.push2(p2.vec(0, 0.8), 2);\n    poly.push2(p2.vec(0.6, 0.8), 2);\n    poly.push2(p2.vec(1.8, -1.0));\n    poly.reverse();\n    this.polygons.push(poly);\n  }\n\n  drawLowerRightHT_v(x2, y2, kMinWidthT, kagekMinWidthY) {//for T design\n    var poly = new Polygon();\n    poly.push(x2, y2 + kagekMinWidthY);\n    poly.push(x2 + kMinWidthT, y2 - kagekMinWidthY * 3);\n    poly.push(x2 + kMinWidthT * 2, y2 - kagekMinWidthY);\n    poly.push(x2 + kMinWidthT * 2, y2 + kagekMinWidthY);\n    this.polygons.push(poly);\n  }\n\n  drawLowerRightHT(x2, y2, kMinWidthT, kagekMinWidthY) {//for T design\n    var poly = new Polygon();\n    poly.push(x2, y2 + kagekMinWidthY);\n    poly.push(x2 + kMinWidthT * 0.5, y2 - kagekMinWidthY * 4);\n    poly.push(x2 + kMinWidthT * 2, y2 - kagekMinWidthY);\n    poly.push(x2 + kMinWidthT * 2, y2 + kagekMinWidthY);\n    this.polygons.push(poly);\n  }\n\n  drawNewGTHbox(x2m, y2, kMinWidthT, kagekMinWidthY) {//for new GTH box's left bottom corner MUKI KANKEINASHI\n    var poly = new Polygon();\n    poly.push(x2m, y2 - kagekMinWidthY * 5);\n    poly.push(x2m - kMinWidthT * 2, y2);\n    poly.push(x2m - kagekMinWidthY, y2 + kagekMinWidthY * 5);\n    poly.push(x2m + kMinWidthT, y2 + kagekMinWidthY);\n    poly.push(x2m, y2);\n    poly.reverse();\n    this.polygons.push(poly);\n  }\n\n  drawNewGTHbox_v(x2, y2, kMinWidthT, kagekMinWidthY) {\n    var poly = new Polygon();\n    poly.push(x2 - kMinWidthT, y2 - kagekMinWidthY * 3);\n    poly.push(x2 - kMinWidthT * 2, y2);\n    poly.push(x2 - kagekMinWidthY, y2 + kagekMinWidthY * 5);\n    poly.push(x2 + kMinWidthT, y2 + kagekMinWidthY);\n    poly.reverse();\n    this.polygons.push(poly);\n  }\n  \n  drawTailCircle_tan(tailX, tailY, dir, r, tan1, tan2) {\n    //draw a (semi)circle on the tail of the line to (tailX, tailY)\n    var poly = new Polygon();\n    const vec1 = vector_to_len(tan1, r*bez_cir*0.74);\n    const vec2 = vector_to_len(tan2, r*bez_cir*0.78);\n    let p = new PointMaker(tailX, tailY, dir, r);\n    let [x1, y1] = p.vec(0, -1);\n    let [x2, y2] = p.vec(0, 1);\n    poly.push(x1, y1);\n    poly.push(x1 + vec1[0], y1 + vec1[1], 2);\n    poly.push2(p.vec(0.94,-bez_cir*1.09), 2);\n    poly.push2(p.vec(0.94,0));\n    poly.push2(p.vec(0.94,+bez_cir*1.09), 2);\n    poly.push(x2 + vec2[0], y2 + vec2[1], 2);\n    poly.push(x2, y2);\n    this.polygons.push(poly);\n  }\n\n  drawTailCircle(tailX, tailY, dir, r) {\n    //draw a (semi)circle on the tail of the line to (tailX, tailY)\n    var poly = new Polygon();\n    var p = new PointMaker(tailX, tailY, dir, r);\n    poly.push2(p.vec(0, -1));\n    poly.push2(p.vec(bez_cir, -1), 2);\n    poly.push2(p.vec(1, -bez_cir), 2);\n    poly.push2(p.vec(1, 0));\n    poly.push2(p.vec(1, bez_cir), 2);\n    poly.push2(p.vec(bez_cir, 1), 2);\n    poly.push2(p.vec(0, 1));\n    this.polygons.push(poly);\n  }\n\n  drawCircle_bend_pos(x2, y2, dir, kMinWidthT2) {\n    var poly = new Polygon();\n    var p = new PointMaker(x2, y2, dir, kMinWidthT2);\n    poly.push2(p.vec(0, -1));\n    poly.push2(p.vec(1.5, -1), 2);\n    poly.push2(p.vec(0.9,  1), 2);\n    poly.push2(p.vec(-1,  1));\n    this.polygons.push(poly);\n  }\n\n  drawCircle_bend_neg(x2, y2, dir, kMinWidthT2) {\n    var poly = new Polygon();\n    var p = new PointMaker(x2, y2, dir, kMinWidthT2);\n    poly.push2(p.vec(0, 1));\n    poly.push2(p.vec(1.5, 1), 2);\n    poly.push2(p.vec(0.9,  -1), 2);\n    poly.push2(p.vec(-1,  -1));\n    poly.reverse();\n    this.polygons.push(poly);\n  }\n\n  drawL2RSweepEnd(x2, y2, dir, kMinWidthT, kagekL2RDfatten) {\n    var type = (Math.atan2(Math.abs(dir.sin), Math.abs(dir.cos)) / Math.PI * 2 - 0.6);\n    if (type > 0) {\n      type = type * 8;\n    } else {\n      type = type * 3;\n    }\n    const pm = (type < 0) ? -1 : 1;\n    var p = new PointMaker(x2, y2, dir);\n    var poly = new Polygon();\n    poly.push2(p.vec(0, kMinWidthT * kagekL2RDfatten));\n    poly.push2(p.vec(0, -kMinWidthT * kagekL2RDfatten));\n    poly.push2(p.vec(kMinWidthT * kagekL2RDfatten * Math.abs(type), kMinWidthT * kagekL2RDfatten * pm));\n    this.polygons.push(poly);\n  }\n\n  drawTurnUpwards_pos(x2, y2, kMinWidthT, length_param, dir) {\n    var poly = new Polygon();\n    var p = new PointMaker(x2, y2, dir);\n    poly.push2(p.vec(kMinWidthT*0.7,  - kMinWidthT*0.7));\n    poly.push2(p.vec(0, - kMinWidthT),2);\n    poly.push2(p.vec(kMinWidthT*0.3, - kMinWidthT - length_param/2), 2);\n    poly.push2(p.vec(kMinWidthT*0.5, - kMinWidthT - length_param));\n    poly.push2(p.vec(0,  - kMinWidthT - length_param));\n    poly.push2(p.vec( - kMinWidthT*0.6, - kMinWidthT - length_param/4), 2);\n    poly.push2(p.vec( - kMinWidthT*1.8, - kMinWidthT), 2);\n    poly.push2(p.vec( - kMinWidthT*2.2, - kMinWidthT));\n    \n    poly.reverse(); // for fill-rule\n    this.polygons.push(poly);\n  }\n\n  drawTurnUpwards_neg(x2, y2, kMinWidthT, length_param, dir) {\n    var poly = new Polygon();\n    var p = new PointMaker(x2, y2, dir);\n    poly.push2(p.vec(kMinWidthT*0.7, kMinWidthT*0.7));\n    poly.push2(p.vec(0, kMinWidthT),2);\n    poly.push2(p.vec(kMinWidthT*0.3, kMinWidthT + length_param/2), 2);\n    poly.push2(p.vec(kMinWidthT*0.5, kMinWidthT + length_param));\n    poly.push2(p.vec(0, kMinWidthT + length_param));\n    poly.push2(p.vec( - kMinWidthT*0.6, kMinWidthT + length_param/4), 2);\n    poly.push2(p.vec( - kMinWidthT*1.8, kMinWidthT), 2);\n    poly.push2(p.vec( - kMinWidthT*2.2, kMinWidthT));\n    this.polygons.push(poly);\n  }\n  \n  drawTurnLeft(x2, y2, kMinWidthT, length_param) {\n    var poly = new Polygon();\n    poly.push(x2, y2 - kMinWidthT);\n    poly.push(x2 - length_param, y2 - kMinWidthT);\n    poly.push(x2 - length_param, y2 - kMinWidthT * 0.5);\n    poly.push(x2 - kMinWidthT*0.7, y2 - kMinWidthT * 0.3,2);\n    poly.push(x2, y2 + kMinWidthT * 0.3, 2);\n    poly.push(x2, y2 + kMinWidthT);\n    poly.reverse();\n    this.polygons.push(poly);\n  }\n\n  drawUroko_h(x2, y2, kagekMinWidthY, urokoX, urokoY) {\n    var poly = new Polygon();\n    poly.push(x2, y2 - kagekMinWidthY);\n    poly.push(x2 - urokoX, y2);\n    poly.push(x2 - urokoX / 2, y2 - urokoY);\n    this.polygons.push(poly);\n  }\n\n  drawUroko(x2, y2, dir, kagekMinWidthY, urokoX, urokoY) {\n    var poly = new Polygon();\n    poly.push(x2 + dir.sin * kagekMinWidthY, y2 - dir.cos * kagekMinWidthY);\n    poly.push(x2 - dir.cos * urokoX, y2 - dir.sin * urokoX);\n    poly.push(x2 - dir.cos * urokoX / 2 + dir.sin * urokoY, y2 - dir.sin * urokoX / 2 - dir.cos * urokoY);\n    this.polygons.push(poly);\n  }\n\n  drawLine(x1, y1, x2, y2, halfWidth) {\n    //draw a line(rectangle).\n    var poly = new Polygon;\n    const dir = get_dir(x2-x1, y2-y1);\n    let p = new PointMaker(x1, y1, dir);\n    poly.push2(p.vec(0, halfWidth));\n    poly.push2(p.vec(0, -halfWidth));\n    p.setpos(x2, y2);\n    poly.push2(p.vec(0, -halfWidth));\n    poly.push2(p.vec(0, halfWidth));\n    this.polygons.push(poly);\n  }\n\n  drawOffsetLine(x1, y1, x2, y2, halfWidth, off_left1, off_right1, off_left2, off_right2) {\n    //Draw a line(rectangle), and adjust the rectangle to trapezoid.\n    //off_left1 means how much the start point of the left side (seeing from (x1, y1)) of the rectangle is stretched.\n    //Note that the positive Y-axis goes in the downwards.\n    //off_left2 deals with the end point.  The right side is managed similarly.\n    //The generated polygon will be clockwise.\n    var poly = new Polygon;\n    const dir = get_dir(x2-x1, y2-y1);\n    let p = new PointMaker(x1, y1, dir);\n    poly.push2(p.vec(-off_right1, halfWidth));\n    poly.push2(p.vec(-off_left1, -halfWidth));\n    p.setpos(x2, y2);\n    poly.push2(p.vec(off_left2, -halfWidth));\n    poly.push2(p.vec(off_right2, halfWidth));\n    this.polygons.push(poly);\n  }\n\n  drawCBezier(x1, y1, sx1, sy1, sx2, sy2, x2, y2, width_func, width_func_d, curve_step) {\n    let [bez1, bez2] = Bezier.cBezier(x1, y1, sx1, sy1, sx2, sy2, x2, y2, width_func, width_func_d, curve_step);\n    var poly = Bezier.bez_to_poly(bez1);\n    poly.concat(Bezier.bez_to_poly(bez2));\n    this.polygons.push(poly);\n  }\n  drawQBezier(x1, y1, sx, sy, x2, y2, width_func, width_func_d, curve_step) {\n    let [bez1, bez2] = Bezier.qBezier(x1, y1, sx, sy, x2, y2, width_func, width_func_d, curve_step);\n    var poly = Bezier.bez_to_poly(bez1);\n    poly.concat(Bezier.bez_to_poly(bez2));\n    this.polygons.push(poly);\n  }\n  drawQBezier2(x1, y1, sx, sy, x2, y2, width_func, width_func_d, curve_step) {\n    let [bez1, bez2] = Bezier.qBezier2(x1, y1, sx, sy, x2, y2, width_func, width_func_d, curve_step);\n    var poly = Bezier.bez_to_poly(bez1);\n    poly.concat(Bezier.bez_to_poly(bez2));\n    this.polygons.push(poly);\n  }\n}","import { FontCanvas } from \"./fontcanvas\";\nimport {get_extended_dest, get_extended_dest_wrong} from \"./util\";\n\nexport class Gothic{\n  constructor(size) {\n    this.kRate = 50;\n    if (size == 1) {\n      this.kWidth = 3;\n      this.kKakato = 1.8;\n      this.kMage = 6;\n    } else {\n      this.kWidth = 5;\n      this.kKakato = 3;\n      this.kMage = 10;\n    }\n  }\n  getPolygons(glyphData) {\n    var cv = new FontCanvas();\n    for (let glyph of glyphData) {\n      this.drawStroke(cv, glyph);\n    }\n    return cv.getPolygons();\n  }\n  drawStroke(cv, s){ // gothic\n    const a1 = s[0];\n    const a2 = s[1];\n    const a3 = s[2];\n    const x1 = s[3];\n    const y1 = s[4];\n    const x2 = s[5];\n    const y2 = s[6];\n    const x3 = s[7];\n    const y3 = s[8];\n    const x4 = s[9];\n    const y4 = s[10];\n    const curve_step = 1000 / this.kRate;\n    switch(a1 % 100){\n    case 0:\n      break;\n    case 1:\n      if(a3 == 4){\n        let [tx1, ty1] = get_extended_dest(x2, y2, x1, y1, -this.kMage);\n        this.gothicDrawLine(x1, y1, tx1, ty1, a2, 1, cv);\n        this.gothicDrawCurve(tx1, ty1, x2, y2, x2 - this.kMage * 2, y2 - this.kMage * 0.5, a1, a2, cv);\n      }\n      else{\n        this.gothicDrawLine(x1, y1, x2, y2, a2, a3, cv);\n      }\n      break;\n    case 2:\n    case 12:{\n      if(a3 == 4){\n        let [tx1, ty1] = get_extended_dest_wrong(x3, y3, x2, y2, -this.kMage);\n        this.gothicDrawCurve(x1, y1, x2, y2, tx1, ty1, a1, a2, cv);\n        this.gothicDrawCurve(tx1, ty1, x3, y3, x3 - this.kMage * 2, y3 - this.kMage * 0.5, a1, a2, cv);\n      }\n      else if(a3 == 5){\n        const tx1 = x3 + this.kMage;\n        const ty1 = y3;\n        const tx2 = tx1 + this.kMage * 0.5;\n        const ty2 = y3 - this.kMage * 2;\n        this.gothicDrawCurve(x1, y1, x2, y2, x3, y3, a1, a2, cv);\n        this.gothicDrawCurve(x3, y3, tx1, ty1, tx2, ty2, a1, a2, cv);\n      }\n      else{\n        this.gothicDrawCurve(x1, y1, x2, y2, x3, y3, a1, a2, cv);\n      }\n      break;\n    }\n    case 3:{\n      let [tx1, ty1] = get_extended_dest(x2, y2, x1, y1, -this.kMage);\n        let [tx2, ty2] = get_extended_dest(x2, y2, x3, y3, -this.kMage);\n        \n      if(a3 == 5){\n        const tx3 = x3 - this.kMage;\n        const ty3 = y3;\n        const tx4 = x3 + this.kMage * 0.5;\n        const ty4 = y3 - this.kMage * 2;\n        this.gothicDrawLine(x1, y1, tx1, ty1, a2, 1, cv);\n        this.gothicDrawCurve(tx1, ty1, x2, y2, tx2, ty2, a1, a2, cv);\n        this.gothicDrawLine(tx2, ty2, tx3, ty3, 1, 1, cv);\n        this.gothicDrawCurve(tx3, ty3, x3, y3, tx4, ty4, a1, a2, cv);\n      }\n      else{\n        this.gothicDrawLine(x1, y1, tx1, ty1, a2, 1, cv);\n        this.gothicDrawCurve(tx1, ty1, x2, y2, tx2, ty2, a1, a2, cv);\n        this.gothicDrawLine(tx2, ty2, x3, y3, 1, a3, cv);\n      }\n      break;\n    }\n    case 6:\n      if(a3 == 5){\n        const tx1 = x4 - this.kMage;\n        const ty1 = y4;\n        const tx2 = x4 + this.kMage * 0.5;\n        const ty2 = y4 - this.kMage * 2;\n        cv.drawCBezier(x1, y1, x2, y2, x3, y3, tx1, ty1, (t) => { return this.kWidth; }, t => 0, 1000 / this.kRate);\n        this.gothicDrawCurve(tx1, ty1, x4, y4, tx2, ty2, a1, a2, cv);\n      }\n      else{\n        cv.drawCBezier(x1, y1, x2, y2, x3, y3, x4, y4,  (t) => { return this.kWidth; }, t => 0, 1000 / this.kRate);\n      }\n      break;\n    case 7:\n      this.gothicDrawLine(x1, y1, x2, y2, a2, 1, cv);\n      this.gothicDrawCurve(x2, y2, x3, y3, x4, y4, a1, a2, cv);\n      break;\n    case 9: // may not be exist\n      //kageCanvas[y1][x1] = 0;\n      //kageCanvas[y2][x2] = 0;\n      break;\n    default:\n      break;\n    }\n  }\n\n  gothicDrawCurve(x1, y1, x2, y2, x3, y3, ta1, ta2, cv) {\n    var a1, a2;\n    if (a1 % 10 == 2) {\n      let [x1ext, y1ext] = get_extended_dest_wrong(x1, y1, x2, y2, this.kWidth);\n      x1 = x1ext; y1 = y1ext;\n    } else if (a1 % 10 == 3) {\n      let [x1ext, y1ext] = get_extended_dest_wrong(x1, y1, x2, y2, this.kWidth * this.kKakato);\n      x1 = x1ext; y1 = y1ext;\n    }\n    if (a2 % 10 == 2) {\n      let [x2ext, y2ext] = get_extended_dest_wrong(x3, y3, x2, y2, this.kWidth);\n      x3 = x2ext; y3 = y2ext;\n    } else if (a2 % 10 == 3) {\n      let [x2ext, y2ext] = get_extended_dest_wrong(x3, y3, x2, y2, this.kWidth * this.kKakato);\n      x3 = x2ext; y3 = y2ext;\n    }\n    cv.drawQBezier(x1, y1, x2, y2, x3, y3, (t) => { return this.kWidth; }, t => 0, 1000 / this.kRate);\n  }\n\n  gothicDrawLine(tx1, ty1, tx2, ty2, ta1, ta2, cv) {\n    var x1 = tx1;\n    var y1 = ty1;\n    var x2 = tx2;\n    var y2 = ty2;\n    if (ta1 % 10 == 2) {\n      let [x1ext, y1ext] = get_extended_dest(tx1, ty1, tx2, ty2, this.kWidth);\n      x1 = x1ext; y1 = y1ext;\n    } else if (ta1 % 10 == 3) {\n      let [x1ext, y1ext] = get_extended_dest(tx1, ty1, tx2, ty2, this.kWidth * this.kKakato);\n      x1 = x1ext; y1 = y1ext;\n    }\n    if (ta2 % 10 == 2) {\n      let [x2ext, y2ext] = get_extended_dest(tx2, ty2, tx1, ty1, this.kWidth);\n      x2 = x2ext; y2 = y2ext;\n    } else if (ta2 % 10 == 3) {\n      let [x2ext, y2ext] = get_extended_dest(tx2, ty2, tx1, ty1, this.kWidth * this.kKakato);\n      x2 = x2ext; y2 = y2ext;\n    }\n    cv.drawLine(x1, y1, x2, y2, this.kWidth);\n  }\n}","export const STROKETYPE = {\n    STRAIGHT : 1,//\n    CURVE : 2,// quadratic bezier curve\n    BENDING : 3,// used in \"\" \"\"\n    BENDING_ROUND : 4,//used for \"\"\n    BEZIER : 6,// cubic bezier curve\n    VCURVE : 7,//vertical line and curve. used in the leftmost stroke of \"\".\n               //although the angle of line can be chosen arbitrarily, only vertical line is expected.\n    REFERENCE : 99,\n}\nexport const STARTTYPE = {\n    OPEN : 0,//simple lines like \"\" or \"\" (two strokes on the right side)\n             //also used in the left stroke of \"\"\n    CONNECTING_H : 2,//horizontal strokes connecting to other strokes.  used in the center strokes of \"\".\n    UPPER_LEFT_CORNER : 12,//the starting point is at the upper left corner.  usually used for vertical lines, like the leftmost stroke of \"\".\n    UPPER_RIGHT_CORNER : 22,//the starting point is at the upper right corner.  usually used for vertical lines, like the rightmost stroke of \"\".\n    CONNECTING_V : 32,//vertical strokes connecting to other strokes.  used in the center strokes of \"\".\n    THIN : 7//used in the right stroke of \"\"\n}\nexport const ENDTYPE = {\n    OPEN : 0,//simple lines like \"\" or \"\" (two strokes on the right side)\n             //also used in the right stroke of \"\"(L2R sweep)\n    CONNECTING_H : 2,\n    CONNECTING_V : 32,///vertical strokes connecting to other strokes.  used in the center strokes of \"\".\n    LOWER_LEFT_CORNER : 13,\n    LOWER_RIGHT_CORNER : 23,\n    LOWER_LEFT_ZH_OLD : 313,//for characters used in China.\n    LOWER_LEFT_ZH_NEW : 413,//for characters used in China.\n    \n    TURN_LEFT : 4,//adds a short line to the left.  used in the rightmost stroke of \"\".\n    LOWER_RIGHT_HT : 24,//for characters used in China.\n    TURN_UPWARDS : 5,//adds a short upward line.  used in the rightmost stroke of \"\" or \"\".\n    LEFT_SWEEP : 7, //used in the left stroke of \"\".\n    STOP : 8,//used in the rightmost stroke of \"\" or lower four dots of \"\".\n}\n","// Reference : http://www.cam.hi-ho.ne.jp/strong_warriors/teacher/chapter0{4,5}.html\n\nfunction point(x, y){\n  this.x = x;\n  this.y = y;\n}\n\nfunction getCrossPoint(x11, y11, x12, y12, x21, y21, x22, y22){ // point\n  var a1 = y12 - y11;\n  var b1 = x11 - x12;\n  var c1 = -1 * a1 * x11 - b1 * y11;\n  var a2 = y22 - y21;\n  var b2 = x21 - x22;\n  var c2 = -1 * a2 * x21 - b2 * y21;\n  \n  var temp = b1 * a2 - b2 * a1;\n  if(temp == 0){ // parallel\n    return false;\n  }\n  return new point((c1 * b2 - c2 * b1) / temp, (a1 * c2 - a2 * c1) / temp);\n}\n\nfunction isCross(x11, y11, x12, y12, x21, y21, x22, y22){ // boolean\n  var temp = getCrossPoint(x11, y11, x12, y12, x21, y21, x22, y22);\n  if(!temp){ return false; }\n  if(x11 < x12 && (temp.x < x11 || x12 < temp.x) ||\n     x11 > x12 && (temp.x < x12 || x11 < temp.x) ||\n     y11 < y12 && (temp.y < y11 || y12 < temp.y) ||\n     y11 > y12 && (temp.y < y12 || y11 < temp.y)\n     ){\n    return false;\n  }\n  if(x21 < x22 && (temp.x < x21 || x22 < temp.x) ||\n     x21 > x22 && (temp.x < x22 || x21 < temp.x) ||\n     y21 < y22 && (temp.y < y21 || y22 < temp.y) ||\n     y21 > y22 && (temp.y < y22 || y21 < temp.y)\n     ){\n    return false;\n  }\n  return true;\n}\n\nfunction isCrossBox(x1, y1, x2, y2, bx1, by1, bx2, by2){ // boolean\n  if(isCross(x1, y1, x2, y2, bx1, by1, bx2, by1)){ return true; }\n  if(isCross(x1, y1, x2, y2, bx2, by1, bx2, by2)){ return true; }\n  if(isCross(x1, y1, x2, y2, bx1, by2, bx2, by2)){ return true; }\n  if(isCross(x1, y1, x2, y2, bx1, by1, bx1, by2)){ return true; }\n  return false;\n}\n\nexport function isCrossBoxWithOthers(strokesArray, i, bx1, by1, bx2, by2){ // boolean\n  for(var j = 0; j < strokesArray.length; j++){\n    if(i == j){ continue; }\n    switch(strokesArray[j][0]){\n    case 0:\n    case 8:\n    case 9:\n      break;\n    case 6:\n    case 7:\n      if(isCrossBox(strokesArray[j][7],\n                    strokesArray[j][8],\n                    strokesArray[j][9],\n                    strokesArray[j][10],\n                    bx1, by1, bx2, by2)){\n        return true;\n      }\n    case 2:\n    case 12:\n    case 3:\n      if(isCrossBox(strokesArray[j][5],\n                    strokesArray[j][6],\n                    strokesArray[j][7],\n                    strokesArray[j][8],\n                    bx1, by1, bx2, by2)){\n        return true;\n      }\n    default:\n      if(isCrossBox(strokesArray[j][3],\n                    strokesArray[j][4],\n                    strokesArray[j][5],\n                    strokesArray[j][6],\n                    bx1, by1, bx2, by2)){\n        return true;\n      }\n    }\n  }\n  return false;\n}\n\nexport function isCrossWithOthers(strokesArray, i, bx1, by1, bx2, by2){ // boolean\n  for(var j = 0; j < strokesArray.length; j++){\n    if(i == j){ continue; }\n    switch(strokesArray[j][0]){\n    case 0:\n    case 8:\n    case 9:\n      break;\n    case 6:\n    case 7:\n      if(isCross(strokesArray[j][7],\n                 strokesArray[j][8],\n                 strokesArray[j][9],\n                 strokesArray[j][10],\n                 bx1, by1, bx2, by2)){\n        return true;\n      }\n    case 2:\n    case 12:\n    case 3:\n      if(isCross(strokesArray[j][5],\n                 strokesArray[j][6],\n                 strokesArray[j][7],\n                 strokesArray[j][8],\n                 bx1, by1, bx2, by2)){\n        return true;\n      }\n    default:\n      if(isCross(strokesArray[j][3],\n                 strokesArray[j][4],\n                 strokesArray[j][5],\n                 strokesArray[j][6],\n                 bx1, by1, bx2, by2)){\n        return true;\n      }\n    }\n  }\n  return false;\n}\n","import { FontCanvas } from \"./fontcanvas\";\nimport { get_dir, moved_point, get_extended_dest , widfun, widfun_d, widfun_stop, widfun_stop_d, widfun_fat, widfun_fat_d, DIR_POSX, DIR_NEGX, bezier_to_y} from \"./util\";\nimport { STROKETYPE, STARTTYPE, ENDTYPE} from \"./stroketype\";\nimport { Bezier} from \"./bezier\";\nimport { Polygon } from \"./polygon\";\nimport {isCrossBoxWithOthers,isCrossWithOthers} from \"./2d\";\nexport class Mincho {\n  constructor(size) {\n    this.kRate = 50;\n    if (size == 1) {\n      this.kMinWidthY = 1.2;\n      this.kMinWidthT = 3.6;\n      this.kWidth = 3;\n      this.kKakato = 1.8;\n      this.kL2RDfatten = 1.1;\n      this.kMage = 6;\n\n      this.kAdjustKakatoL = ([8, 5, 3, 1]); // for KAKATO adjustment 000,100,200,300,400\n      this.kAdjustKakatoR = ([4, 3, 2, 1]); // for KAKATO adjustment 000,100,200,300\n      this.kAdjustKakatoRangeX = 12; // check area width\n      this.kAdjustKakatoRangeY = ([1, 11, 14, 18]); // 3 steps of checking\n      this.kAdjustKakatoStep = 3; // number of steps\n\n      this.kAdjustUrokoX = ([14, 12, 9, 7]); // for UROKO adjustment 000,100,200,300\n      this.kAdjustUrokoY = ([7, 6, 5, 4]); // for UROKO adjustment 000,100,200,300\n      this.kAdjustUrokoLength = ([13, 21, 30]); // length for checking\n      this.kAdjustUrokoLengthStep = 3; // number of steps\n      this.kAdjustUrokoLine = ([13, 15, 18]); // check for crossing. corresponds to length\n\n      this.kAdjustUroko2Step = 3;\n      this.kAdjustUroko2Length = 25;\n\n      this.kAdjustTateStep = 4;\n      this.kAdjustMageStep = 5;\n    } else if (size == 3) {\n      this.kMinWidthY = 3;\n      this.kMinWidthT = 8;\n      this.kWidth = 6;\n      this.kKakato = 4;\n      this.kL2RDfatten = 1.1;\n      this.kMage = 14;\n\n      this.kAdjustKakatoL = ([20, 13, 7, 3]); // for KAKATO adjustment 000,100,200,300,400\n      this.kAdjustKakatoR = ([12, 9, 6, 3]); // for KAKATO adjustment 000,100,200,300\n      this.kAdjustKakatoRangeX = 26; // check area width\n      this.kAdjustKakatoRangeY = ([2, 26, 30, 40]); // 3 steps of checking\n      this.kAdjustKakatoStep = 3; // number of steps\n\n      this.kAdjustUrokoX = ([30, 25, 20, 15]); // for UROKO adjustment 000,100,200,300\n      this.kAdjustUrokoY = ([15, 14, 13, 12]); // for UROKO adjustment 000,100,200,300\n      this.kAdjustUrokoLength = ([29, 40, 62]); // length for checking\n      this.kAdjustUrokoLengthStep = 3; // number of steps\n      this.kAdjustUrokoLine = ([29, 34, 39]); // check for crossing. corresponds to length\n\n      this.kAdjustUroko2Step = 3;\n      this.kAdjustUroko2Length = 50;\n\n      this.kAdjustTateStep = 4;\n      this.kAdjustMageStep = 5;\n    } else if (size > 1) {\n      this.kMinWidthY = size;\n      this.kMinWidthT = size * 2.6;\n      this.kWidth = size * 2.2;\n      this.kKakato = size * 1.2 + 0.6;\n      this.kL2RDfatten = 1.2;\n      this.kMage = size * 4 + 2;\n\n      this.kAdjustKakatoL = ([size * 4 + 1, size * 3+0.75, size * 2 + 0.5, size * 1 + 0.25]); // for KAKATO adjustment 000,100,200,300,400\n      this.kAdjustKakatoR = ([size * 3.2, size * 2.4, size * 1.6, size * 0.8]); // for KAKATO adjustment 000,100,200,300\n      this.kAdjustKakatoRangeX = size * 4 + 8; // check area width\n      this.kAdjustKakatoRangeY = ([size, size * 5 + 3, size * 9 + 5, size * 12 + 6]); // 3 steps of checking\n      this.kAdjustKakatoStep = 3; // number of steps\n\n      this.kAdjustUrokoX = ([size * 8 + 4, size * 7 + 3.5, size * 6 + 3, size * 5 + 2.5]); // for UROKO adjustment 000,100,200,300\n      this.kAdjustUrokoY = ([size * 5 + 2, size * 4.8 + 1.5, size * 4.6 + 1, size * 4.4 + 0.5]); // for UROKO adjustment 000,100,200,300\n      this.kAdjustUrokoLength = ([size * 7 + 7, size * 11 + 11, size * 15 + 15]); // length for checking\n      this.kAdjustUrokoLengthStep = 3; // number of steps\n      this.kAdjustUrokoLine = ([size * 7 + 7, size * 9 + 8, size * 11 + 9]); // check for crossing. corresponds to length\n\n      this.kAdjustUroko2Step = 3;\n      this.kAdjustUroko2Length = size * 20;\n\n      this.kAdjustTateStep = 4;\n      this.kAdjustMageStep = 5;\n    } else {\n      this.kMinWidthY = 2;\n      this.kMinWidthT = 6;\n      this.kWidth = 5;\n      this.kKakato = 3;\n      this.kL2RDfatten = 1.1;\n      this.kMage = 10;\n\n      this.kAdjustKakatoL = ([14, 9, 5, 2]); // for KAKATO adjustment 000,100,200,300,400\n      this.kAdjustKakatoR = ([8, 6, 4, 2]); // for KAKATO adjustment 000,100,200,300\n      this.kAdjustKakatoRangeX = 20; // check area width\n      this.kAdjustKakatoRangeY = ([1, 19, 24, 30]); // 3 steps of checking\n      this.kAdjustKakatoStep = 3; // number of steps\n\n      this.kAdjustUrokoX = ([24, 20, 16, 12]); // for UROKO adjustment 000,100,200,300\n      this.kAdjustUrokoY = ([12, 11, 9, 8]); // for UROKO adjustment 000,100,200,300\n      this.kAdjustUrokoLength = ([22, 36, 50]); // length for checking\n      this.kAdjustUrokoLengthStep = 3; // number of steps\n      this.kAdjustUrokoLine = ([22, 26, 30]); // check for crossing. corresponds to length\n\n      this.kAdjustUroko2Step = 3;\n      this.kAdjustUroko2Length = 40;\n\n      this.kAdjustTateStep = 4;\n      this.kAdjustMageStep = 5;\n    }\n  }\n\n  getPolygons(glyphData) {\n    var cv = new FontCanvas();\n    for (var i = 0; i < glyphData.length; i++) {\n      var tempdata = glyphData.slice();\n      tempdata.splice(i, 1);\n      this.drawAdjustedStroke(cv, glyphData[i], tempdata);\n    }\n    return cv.getPolygons();\n  }\n  getPolygonsSeparated(strokesArrays) {\n    return strokesArrays.map((glyphData, index) => {\n      const cp = strokesArrays.slice();\n      cp.splice(index,1)\n      const other_groups = cp.flat();\n     \n      var cv = new FontCanvas();\n      for (var i = 0; i < glyphData.length; i++) {\n        var tempdata = glyphData.slice();\n        tempdata.splice(i, 1);\n        this.drawAdjustedStroke(cv, glyphData[i], other_groups.concat(tempdata));\n      }\n      return cv.getPolygons();\n    });\n  }\n  drawAdjustedStroke(cv, s, others) {//draw stroke on the canvas\n    const a1 = s[0];\n    const a2 = s[1];\n    const a3 = s[2];\n    const x1 = s[3];\n    const y1 = s[4];\n    const x2 = s[5];\n    const y2 = s[6];\n    const x3 = s[7];\n    const y3 = s[8];\n    const x4 = s[9];\n    const y4 = s[10];\n    if(a2>100){\n      console.log(\"error: start type\"+a2)\n    }\n    if(a3>100){\n      console.log(\"error: end type\"+a3)\n    }\n    \n    const dir12 = get_dir(x2-x1, y2-y1);\n    const dir23 = get_dir(x3-x2, y3-y2);\n    const dir34 = get_dir(x4-x3, y4-y3);\n    \n    switch (a1) {\n      case 0: {//rotate and flip\n        if (a2 == 98) {\n          cv.flip_left_right(x1, y1, x2, y2);\n        } else if (a2 == 97) {\n          cv.flip_up_down(x1, y1, x2, y2);\n        } else if (a2 == 99 && a3 == 1) {\n          cv.rotate90(x1, y1, x2, y2);\n        } else if (a2 == 99 && a3 == 2) {\n          cv.rotate180(x1, y1, x2, y2);\n        } else if (a2 == 99 && a3 == 3) {\n          cv.rotate270(x1, y1, x2, y2);\n        }\n        break;\n      }\n      case STROKETYPE.STRAIGHT: {\n        const dir = get_dir(x2-x1, y2-y1);\n        if (a3 == ENDTYPE.CONNECTING_H) {//usually horizontal\n          cv.drawLine(x1, y1, x2, y2, this.kMinWidthY);\n        } else if (a3 == ENDTYPE.OPEN && Math.abs(y2 - y1) < x2 - x1) { //horizontal or gentle slope\n          const param_uroko = this.adjustUrokoParam(s, others);\n          const param_uroko2 = this.adjustUroko2Param(s, others);\n          cv.drawLine(x1, y1, x2, y2, this.kMinWidthY);\n          if (y1 == y2) {//horizontal\n            const uroko_max = Math.max(param_uroko, param_uroko2);\n            cv.drawUroko_h(x2, y2, this.kMinWidthY, this.kAdjustUrokoX[uroko_max], this.kAdjustUrokoY[uroko_max]);\n          } else {\n            cv.drawUroko(x2, y2, dir, this.kMinWidthY, this.kAdjustUrokoX[param_uroko], this.kAdjustUrokoY[param_uroko]);\n          }\n        } else {//vertical or steep slope\n          let poly_end = new Polygon(2);\n          const param_tate = this.adjustTateParam(s, others);\n          const kMinWidthT_m = this.kMinWidthT - param_tate / 2;\n          //head\n          let poly_start = this.getStartOfVLine(x1, y1, x2, y2, a2, kMinWidthT_m, cv);\n          //tail\n          switch (a3) {\n            case ENDTYPE.OPEN: {\n              const right2 = kMinWidthT_m / 2;\n              const left2 = -kMinWidthT_m / 2;\n              poly_end = this.getEndOfOffsetLine(x1, y1, x2, y2, kMinWidthT_m, right2, left2);\n              break;\n            }\n            case ENDTYPE.TURN_LEFT: {\n              let [tx1, ty1] = moved_point(x2, y2, dir12, -this.kMage);\n              const width_func = (t) => { return kMinWidthT_m; }\n              const new_x2 = x2 - this.kMage * (((this.kAdjustTateStep + 4) - param_tate) / (this.kAdjustTateStep + 4));\n              cv.drawQBezier(tx1, ty1, x2, y2,\n                new_x2, y2, width_func, t => 0);\n              const param_hane = this.adjustHaneParam(x2, y2, others);\n              cv.drawTurnLeft(new_x2, y2, kMinWidthT_m, this.kWidth * 4 * Math.min(1 - param_hane / 10, Math.pow(kMinWidthT_m / this.kMinWidthT, 3)));\n              poly_end = this.getEndOfLine(x1, y1, tx1, ty1, kMinWidthT_m);\n              break;\n            }\n            case ENDTYPE.LOWER_LEFT_CORNER: {\n              const param_kakato = this.adjustKakatoParam(s, others);\n              const right2 = this.kAdjustKakatoL[param_kakato] + kMinWidthT_m;\n              const left2 = this.kAdjustKakatoL[param_kakato];\n              poly_end = this.getEndOfOffsetLine(x1, y1, x2, y2, kMinWidthT_m, right2, left2);\n              break;\n            }\n            case ENDTYPE.LOWER_RIGHT_CORNER: {\n              const param_kakato = this.adjustKakatoParam(s, others);\n              const right2 = this.kAdjustKakatoR[param_kakato] + kMinWidthT_m;\n              const left2 = this.kAdjustKakatoR[param_kakato];\n              poly_end = this.getEndOfOffsetLine(x1, y1, x2, y2, kMinWidthT_m, right2, left2);\n              break;\n            }\n            case ENDTYPE.LOWER_LEFT_ZH_NEW: {\n              if (x1 == x2) {//vertical\n                cv.drawNewGTHbox_v(x2, y2, kMinWidthT_m, this.kMinWidthY);\n              } else {\n                var m = 0;\n                if (x1 > x2 && y1 != y2) {\n                  m = Math.floor((x1 - x2) / (y2 - y1) * 3);\n                }\n                cv.drawNewGTHbox(x2 + m, y2, kMinWidthT_m, this.kMinWidthY);\n              }\n              const right2 = kMinWidthT_m;\n              const left2 = 0;\n              poly_end = this.getEndOfOffsetLine(x1, y1, x2, y2, kMinWidthT_m, right2, left2);\n              break;\n            }\n            case ENDTYPE.LOWER_LEFT_ZH_OLD: {\n              const right2 = this.kAdjustKakatoL[3] + kMinWidthT_m;\n              const left2 = this.kAdjustKakatoL[3];\n              poly_end = this.getEndOfOffsetLine(x1, y1, x2, y2, kMinWidthT_m, right2, left2);\n              break;\n            }\n            case ENDTYPE.CONNECTING_V: {\n              if (y1 == y2) {//horizontal (error)\n                console.log(\"error: connecting_v at the end of the horizontal line\")\n                cv.drawLine(x1, y1, x2, y2, kMinWidthT_m);\n              } else if (x1 == x2) {//vertical\n                poly_end.set(0, x2 + kMinWidthT_m, y2 + this.kMinWidthY - 0.001);\n                poly_end.set(1, x2 - kMinWidthT_m, y2 + this.kMinWidthY - 0.001);\n              } else {\n                const rad = Math.atan((y2 - y1) / (x2 - x1));\n                const v = (x1 > x2) ? -1 : 1;\n                poly_end.set(0, x2 + (kMinWidthT_m * v) / Math.sin(rad), y2);\n                poly_end.set(1, x2 - (kMinWidthT_m * v) / Math.sin(rad), y2);\n              }\n              break;\n            }\n            case ENDTYPE.LOWER_RIGHT_HT: {\n              if (x1 == x2) {//vertical\n                cv.drawLowerRightHT_v(x2, y2, kMinWidthT_m, this.kMinWidthY);\n              } else {\n                cv.drawLowerRightHT(x2, y2, kMinWidthT_m, this.kMinWidthY);\n              }\n              if (y1 == y2) {//horizontal (error)\n                console.log(\"error: connecting_v at the end of the horizontal line\")\n                cv.drawLine(x1, y1, x2, y2, kMinWidthT_m);\n              } else if (x1 == x2) {//vertical\n                poly_end.set(0, x2 + kMinWidthT_m, y2 + this.kMinWidthY);\n                poly_end.set(1, x2 - kMinWidthT_m, y2 + this.kMinWidthY);\n              } else {\n                const rad = Math.atan((y2 - y1) / (x2 - x1));\n                const v = (x1 > x2) ? -1 : 1;\n                poly_end.set(0, x2 + (kMinWidthT_m * v) / Math.sin(rad), y2);\n                poly_end.set(1, x2 - (kMinWidthT_m * v) / Math.sin(rad), y2);\n              }\n              break;\n            }\n            default:\n              throw (\"error: unknown end type at the straight line: \"+a1);\n              break;\n          }\n          //body\n          poly_start.concat(poly_end);\n          cv.addPolygon(poly_start);\n        }\n        break;\n      }\n\n\n\n      case STROKETYPE.CURVE: {\n        //head\n        if (a2 == STARTTYPE.OPEN) {\n          let [x1ext, y1ext] = moved_point(x1, y1, dir12, 1 * this.kMinWidthY * 0.5);\n          if (y1ext <= y3) { //from up to bottom\n            cv.drawOpenBegin_curve_down(x1ext, y1ext, dir12, this.kMinWidthT, this.kMinWidthY);\n          }\n          else { //from bottom to up\n            cv.drawOpenBegin_curve_up(x1ext, y1ext, dir12, this.kMinWidthT, this.kMinWidthY);\n          }\n        } else if (a2 == STARTTYPE.UPPER_RIGHT_CORNER) {\n          cv.drawUpperRightCorner2(x1, y1, this.kMinWidthT, this.kMinWidthY, this.kWidth);\n        } else if (a2 == STARTTYPE.UPPER_LEFT_CORNER) {\n          let [x1ext, y1ext] = moved_point(x1, y1, dir12, -this.kMinWidthY);\n          cv.drawUpperLeftCorner(x1ext, y1ext, dir12, this.kMinWidthT);\n        }\n        //body\n        const a2temp = (a2 == STARTTYPE.CONNECTING_V && this.adjustKirikuchiParam(s, others)) ? 100 + a2 : a2;\n        this.minchoDrawCurve(x1, y1, x2, y2, x3, y3, a2temp, a3, cv);\n        //tail\n        switch (a3) {\n          case ENDTYPE.TURN_LEFT: {\n            let [tx1, ty1] = moved_point(x3, y3, dir23, -this.kMage);\n            const param_hane = this.adjustHaneParam(x3, y3, others);\n            const width_func = (t) => { return this.kMinWidthT; }\n            cv.drawQBezier(tx1, ty1, x3, y3, x3 - this.kMage, y3, width_func, t => 0);\n            cv.drawTurnLeft(x3 - this.kMage, y3, this.kMinWidthT, this.kWidth * 4 * Math.min(1 - param_hane / 10, 1));\n            break;\n          }\n          case ENDTYPE.TURN_UPWARDS: {\n            cv.drawTailCircle(x3, y3, dir23, this.kMinWidthT);\n            cv.drawTurnUpwards_pos(x3, y3, this.kMinWidthT, this.kWidth*5, (y1<y3)?DIR_POSX:DIR_NEGX);\n            break;\n          }\n          case ENDTYPE.STOP: {\n            //let [x3ex, y3ex] = moved_point(x3, y3, dir23, -1 * this.kMinWidthT * 0.52);\n            //cv.drawTailCircle_tan(x3ex, y3ex, dir23, this.kMinWidthT*1.1, tan1, tan2);\n            break;\n          }\n          default: {\n            if (a2 == STARTTYPE.THIN && a3 == ENDTYPE.OPEN) {\n              cv.drawL2RSweepEnd(x3, y3, dir23, this.kMinWidthT, this.kL2RDfatten);\n            }\n            break;\n          }\n        }\n        break;\n      }\n\n\n\n      case STROKETYPE.BENDING: {\n        //first line\n        const param_tate = this.adjustTateParam(s, others);\n        const param_mage = this.adjustMageParam(s, others);\n        const kMinWidthT_m = this.kMinWidthT - param_tate / 2;\n        const kMinWidthT_mage = this.kMinWidthT - param_mage / 2;\n        let [tx1, ty1] = moved_point(x2, y2, dir12, -this.kMage);\n        let [tx2, ty2] = moved_point(x2, y2, dir23, this.kMage);\n        {\n          let poly_start = this.getStartOfVLine(x1, y1, x2, y2, a2, kMinWidthT_m, cv);\n          let poly_end = this.getEndOfLine(x1, y1, tx1, ty1, kMinWidthT_m);\n          poly_start.concat(poly_end);\n          cv.addPolygon(poly_start);\n        }\n        //curve\n        const width_func = function (t) {\n          return kMinWidthT_mage * t + kMinWidthT_m * (1 - t);\n        }\n        cv.drawQBezier(tx1, ty1, x2, y2, tx2, ty2, width_func, t => 0);\n\n\n\n        //last line\n        if (tx2 < x3) {\n          cv.drawOffsetLine(tx2, ty2, x3, y3, kMinWidthT_mage, 0, 0, 0, -kMinWidthT_mage);\n        } else {\n          cv.drawOffsetLine(tx2, ty2, x3, y3, kMinWidthT_mage, 0, 0, -kMinWidthT_mage, 0);\n        }\n        if (y2 == y3) {\n          if (tx2 < x3) {\n            cv.drawCircle_bend_pos(x3, y3, DIR_POSX, kMinWidthT_mage);\n          } else {\n            cv.drawCircle_bend_neg(x3, y3, DIR_NEGX, kMinWidthT_mage);\n          }\n          if (a3 == ENDTYPE.TURN_UPWARDS) {\n            if (tx2 < x3) {\n              cv.drawTurnUpwards_pos(x3, y3, kMinWidthT_mage, this.kWidth * (4 * (1 - param_mage / this.kAdjustMageStep) + 1), DIR_POSX);\n            } else {\n              cv.drawTurnUpwards_neg(x3, y3, kMinWidthT_mage, this.kWidth * (4 * (1 - param_mage / this.kAdjustMageStep) + 1), DIR_NEGX);\n            }\n          }\n        } else {\n          const dir = get_dir(x3-x2, y3-y2);\n          if (tx2 < x3) {\n            cv.drawCircle_bend_pos(x3, y3, dir, kMinWidthT_mage);\n          } else {\n            cv.drawCircle_bend_neg(x3, y3, dir, kMinWidthT_mage);\n          }\n          if (a3 == ENDTYPE.TURN_UPWARDS) {\n            if (tx2 < x3) {\n              cv.drawTurnUpwards_pos(x3, y3, kMinWidthT_mage, this.kWidth*5, dir);\n            } else {\n              cv.drawTurnUpwards_neg(x3, y3, kMinWidthT_mage, this.kWidth*5, dir);\n            }\n          }\n        }\n        break;\n      }\n      case 12: {\n        throw \"error: unknown stroketype 12\";\n        break;\n      }\n      case STROKETYPE.BENDING_ROUND: {\n        var rate = 6;\n        if ((x3 - x2) * (x3 - x2) + (y3 - y2) * (y3 - y2) < 14400) { // smaller than 120 x 120\n          rate = Math.sqrt((x3 - x2) * (x3 - x2) + (y3 - y2) * (y3 - y2)) / 120 * 6;\n        }\n        let [tx1, ty1] = moved_point(x2, y2, dir12, -this.kMage * rate);\n        let [tx2, ty2] = moved_point(x2, y2, dir23,  this.kMage * rate);\n        //first line\n        let poly_start = this.getStartOfVLine(x1, y1, x2, y2, a2, this.kMinWidthT, cv);\n        let poly_end = this.getEndOfLine(x1, y1, tx1, ty1, this.kMinWidthT);\n        poly_start.concat(poly_end);\n        cv.addPolygon(poly_start);\n        //curve\n        const width_func = (t) => { return this.kMinWidthT; }\n        cv.drawQBezier(tx1, ty1, x2, y2, tx2, ty2, width_func, t => 0);\n\n\n        //last line\n        if (tx2 < x3) {\n          cv.drawOffsetLine(tx2, ty2, x3, y3, this.kMinWidthT, 0, 0, 0, -this.kMinWidthT);\n        } else {\n          cv.drawOffsetLine(tx2, ty2, x3, y3, this.kMinWidthT, 0, 0, -this.kMinWidthT, 0);\n        }\n        if (y2 == y3) {\n          if (tx2 < x3) {\n            cv.drawCircle_bend_pos(x3, y3, DIR_POSX, this.kMinWidthT);\n          } else {\n            cv.drawCircle_bend_neg(x3, y3, DIR_NEGX, this.kMinWidthT);\n          }\n          if (a3 == ENDTYPE.TURN_UPWARDS) {\n            if (tx2 < x3) {\n              cv.drawTurnUpwards_pos(x3, y3, this.kMinWidthT, this.kWidth * 5, DIR_POSX);\n            } else {\n              cv.drawTurnUpwards_neg(x3, y3, this.kMinWidthT, this.kWidth * 5, DIR_NEGX);\n            }\n          }\n        } else {\n          const dir = get_dir(x3-x2, y3-y2);\n          if (tx2 < x3) {\n            cv.drawCircle_bend_pos(x3, y3, dir, this.kMinWidthT);\n          } else {\n            cv.drawCircle_bend_neg(x3, y3, dir, this.kMinWidthT);\n          }\n          if (a3 == ENDTYPE.TURN_UPWARDS) {\n            if (tx2 < x3) {\n              cv.drawTurnUpwards_pos(x3, y3, this.kMinWidthT, this.kWidth*5, dir);\n            } else {\n              cv.drawTurnUpwards_neg(x3, y3, this.kMinWidthT, this.kWidth*5, dir);\n            }\n          }\n        }\n        break;\n      }\n\n\n\n      case STROKETYPE.BEZIER: {\n        //head\n        if (a2 == STARTTYPE.OPEN) {\n          let [x1ext, y1ext] = moved_point(x1, y1, dir12, 1 * this.kMinWidthY * 0.5);\n\n          if (y1ext <= y4) { //from up to bottom\n            cv.drawOpenBegin_curve_down(x1ext, y1ext, dir12, this.kMinWidthT, this.kMinWidthY);\n          }\n          else { //from bottom to up\n            cv.drawOpenBegin_curve_up(x1ext, y1ext, dir12, this.kMinWidthT, this.kMinWidthY);\n          }\n        } else if (a2 == STARTTYPE.UPPER_RIGHT_CORNER) {\n          cv.drawUpperRightCorner(x1, y1, this.kMinWidthT, this.kMinWidthY, this.kWidth);\n        } else if (a2 == STARTTYPE.UPPER_LEFT_CORNER) {\n          let [x1ext, y1ext] = moved_point(x1, y1, dir12, -this.kMinWidthY);\n          cv.drawUpperLeftCorner(x1ext, y1ext, dir12, this.kMinWidthT);\n        }\n        //body\n        let [tan1, tan2] = this.minchoDrawBezier(x1, y1, x2, y2, x3, y3, x4, y4, a2, a3, cv);\n        //tail\n        switch (a3) {\n          case ENDTYPE.TURN_LEFT:\n            let [tx1, ty1] = moved_point(x4, y4, dir34, -this.kMage);\n            const width_func = (t) => { return this.kMinWidthT; }\n            cv.drawQBezier(tx1, ty1, x4, y4, x4 - this.kMage, y4, width_func, t => 0);\n            const param_hane = this.adjustHaneParam(x4, y4, others);\n            cv.drawTurnLeft(x4 - this.kMage, y4, this.kMinWidthT, this.kWidth * 4 * Math.min(1 - param_hane / 10, 1));\n            break;\n          case ENDTYPE.TURN_UPWARDS:\n            cv.drawTailCircle(x4, y4, dir34, this.kMinWidthT);\n            cv.drawTurnUpwards_pos(x4, y4, this.kMinWidthT, this.kWidth*5, (y1<y4)?DIR_POSX:DIR_NEGX);\n            break;\n          case ENDTYPE.STOP:\n            let [x4ex, y4ex] = moved_point(x4, y4, dir34, -this.kMinWidthT * 0.52);\n            cv.drawTailCircle_tan(x4ex, y4ex, dir34, this.kMinWidthT*1.1, tan1, tan2);\n            break;\n          default:\n            if (a2 == STARTTYPE.THIN && a3 == ENDTYPE.OPEN) {\n              cv.drawL2RSweepEnd(x4, y4, dir34, this.kMinWidthT, this.kL2RDfatten);\n            }\n            break;\n        }\n        break;\n      }\n\n\n\n      case STROKETYPE.VCURVE: {\n        const param_tate = this.adjustTateParam(s, others);\n        const kMinWidthT_m = this.kMinWidthT - param_tate / 2;\n        //straight\n        let poly_start = this.getStartOfVLine(x1, y1, x2, y2, a2, kMinWidthT_m, cv);\n        let poly_end = this.getEndOfLine(x1, y1, x2, y2, kMinWidthT_m);\n        poly_start.concat(poly_end);\n        cv.addPolygon(poly_start);\n        //curve\n        const width_func = function (t) {\n          //const deltad = Math.pow(1.0-t,0.7)*0.8+0.2;\n          const deltad = (1 - Math.pow(t, 1.8)) * 0.85 + 0.15;\n          return deltad * kMinWidthT_m;\n        }\n        cv.drawQBezier(x2, y2, x3, y3, x4, y4, width_func, t => -1.8 * Math.pow(t, 0.8) * 0.85 * kMinWidthT_m);\n        break;\n      }\n      case 9: // may not be exist ... no need\n        //kageCanvas[y1][x1] = 0;\n        //kageCanvas[y2][x2] = 0;\n        break;\n      default:\n        throw \"error: unknown stroke: \"+s;\n        break;\n    }\n  }\n\n  minchoDrawCurve(x1pre, y1pre, sx, sy, x2pre, y2pre, a1, a2, cv) {\n    var delta;\n    switch (a1) {\n      case STARTTYPE.OPEN:\n      case STARTTYPE.THIN:\n        delta = -1 * this.kMinWidthY * 0.5;\n        break;\n      case STARTTYPE.UPPER_LEFT_CORNER:\n        //case 32:\n        delta = this.kMinWidthY;\n        break;\n      default:\n        delta = 0;\n        break;\n    }\n    let [x1, y1] = get_extended_dest(x1pre, y1pre, sx, sy, delta);\n\n    switch (a2) {\n      case ENDTYPE.STOP: // get shorten for tail's circle\n        delta = -1 * this.kMinWidthT * 0.52;\n        break;\n      case ENDTYPE.TURN_LEFT:\n        delta = -this.kMage;\n        break;\n      default:\n        delta = 0;\n        break;\n    }\n    let [x2, y2] = get_extended_dest(x2pre, y2pre, sx, sy, delta);\n\n    var width_func;\n    var width_func_d;\n    let bez1, bez2;\n    let thin_stop_param;\n    if (a1 == STARTTYPE.THIN && a2 == ENDTYPE.STOP) { //stop\n      //const slant_cos = \n      const len=Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));\n      thin_stop_param = (1 + (len-45)*0.002);\n      \n      width_func = t => widfun_stop(t, x1, y1, x2, y2, this.kMinWidthT)*thin_stop_param;\n      width_func_d = t => widfun_stop_d(t, x1, y1, x2, y2, this.kMinWidthT)*thin_stop_param;\n      [bez1, bez2] = Bezier.qBezier2(x1, y1, sx, sy, x2, y2, width_func, width_func_d);\n    }\n    else {\n      if (a1 == STARTTYPE.THIN && a2 == ENDTYPE.OPEN) { // L2RD: fatten\n        width_func = t => widfun(t, x1, y1, x2, y2, this.kMinWidthT) * this.kL2RDfatten;\n        width_func_d = t => widfun_d(t, x1, y1, x2, y2, this.kMinWidthT) * this.kL2RDfatten;\n      }\n      else if (a1 == STARTTYPE.CONNECTING_V && a2 == ENDTYPE.OPEN) { // ()\n        width_func = t => {return ((1-t)*0.628+Math.pow((1-t),30)*0.600+0.222)*this.kMinWidthT};\n        width_func_d = t => {return (-0.628-30*Math.pow((1-t),29)*0.600)*this.kMinWidthT};\n      }\n      else if (a1 == STARTTYPE.THIN) {\n        width_func = t => widfun(t, x1, y1, x2, y2, this.kMinWidthT);\n        width_func_d = t => widfun_d(t, x1, y1, x2, y2, this.kMinWidthT);\n      }\n      else if (a2 == ENDTYPE.LEFT_SWEEP) {\n        width_func = t => widfun(1 - t, x1, y1, x2, y2, this.kMinWidthT);\n        width_func_d = t => -widfun_d(1 - t, x1, y1, x2, y2, this.kMinWidthT);\n      }\n      else {\n        width_func = t => this.kMinWidthT;\n        width_func_d = t => 0;\n      }\n      [bez1, bez2] = Bezier.qBezier(x1, y1, sx, sy, x2, y2, width_func, width_func_d);\n    }\n    if (a1 == 132 && x1 != sx) {\n      let b1 = bezier_to_y(bez2[bez2.length - 1], y1);\n      if (b1) { bez2[bez2.length - 1] = b1; }\n      var temp = bez1[0].concat();//deep copy\n      let b2 = bezier_to_y(temp.reverse(), y1);\n      if (b2) { bez1[0] = b2.reverse(); }\n    } else if (a1 == 22 && x1 != sx) {\n      let b1 = bezier_to_y(bez2[bez2.length - 1], y1);\n      if (b1) { bez2[bez2.length - 1] = b1; }\n    \n    /*} else if (a1 == 22 && x1 != sx && y1 > y2) {\n      let b1 = bezier_to_y(bez2[bez2.length - 1], y1);\n      if (b1) { bez2[bez2.length - 1] = b1; }\n      var temp = bez1[0].concat();//deep copy\n      let b2 = bezier_to_y(temp.reverse(), y1 + 1);//??\n      if (b2) { bez1[0] = b2.reverse(); }\n      */\n    }\n    var poly = Bezier.bez_to_poly(bez1);\n    poly.concat(Bezier.bez_to_poly(bez2));\n    if(a1==22){\n      poly.push(x1, y1);\n    }\n    cv.addPolygon(poly);\n\n    if(a2 == ENDTYPE.STOP){\n      const enddir = get_dir(x2-sx, y2-sy);\n      if(a1 == STARTTYPE.THIN){\n        const bez1e = bez1[bez1.length - 1][3];\n      const bez1c2 = bez1[bez1.length - 1][2];\n      const bez2s = bez2[0][0];\n      const bez2c1 = bez2[0][1];\n      const tan1 = [bez1e[0] - bez1c2[0], bez1e[1] - bez1c2[1]];\n      const tan2 = [bez2s[0] - bez2c1[0], bez2s[1] - bez2c1[1]];\n       cv.drawTailCircle_tan(x2, y2, enddir, this.kMinWidthT*1.1*thin_stop_param, tan1, tan2);\n      }else{\n        cv.drawTailCircle(x2, y2, enddir, this.kMinWidthT);\n      }\n    }\n  }\n\n  minchoDrawBezier(x1pre, y1pre, sx1, sy1, sx2, sy2, x2pre, y2pre, a1, a2, cv) {\n    var delta;\n    switch (a1) {\n      case STARTTYPE.OPEN:\n      case STARTTYPE.THIN:\n        delta = -1 * this.kMinWidthY * 0.5;\n        break;\n      case STARTTYPE.UPPER_LEFT_CORNER:\n        //case 32:\n        delta = this.kMinWidthY;\n        break;\n      default:\n        delta = 0;\n        break;\n    }\n    let [x1, y1] = get_extended_dest(x1pre, y1pre, sx1, sy1, delta);\n\n    switch (a2) {\n      case ENDTYPE.STOP: // get shorten for tail's circle\n        delta = -1 * this.kMinWidthT * 0.52;\n        break;\n      case ENDTYPE.TURN_LEFT:\n        delta = -this.kMage;\n        break;\n      default:\n        delta = 0;\n        break;\n    }\n    let [x2, y2] = get_extended_dest(x2pre, y2pre, sx2, sy2, delta);\n\n    var width_func;\n    var width_func_d;\n    let bez1, bez2;\n    \n    if (a1 == STARTTYPE.THIN && a2 == ENDTYPE.STOP) { //stop\n      width_func = t => widfun_stop(t, x1, y1, x2, y2, this.kMinWidthT);\n      width_func_d = t => widfun_stop_d(t, x1, y1, x2, y2, this.kMinWidthT);\n\n      [bez1, bez2] = Bezier.cBezier(x1, y1, sx1, sy1, sx2, sy2, x2, y2, width_func, width_func_d);\n\n      //width_func = t => widfun_fat(t, x1, y1, x2, y2, this.kMinWidthT);\n      //width_func_d = t => widfun_fat_d(t, x1, y1, x2, y2, this.kMinWidthT);\n      //[bez1, bez2] = Bezier.cBezier_slant(x1, y1, sx1, sy1, sx2, sy2, x2, y2, width_func, width_func_d);\n    }\n    else {\n      if (a1 == STARTTYPE.THIN && a2 == ENDTYPE.OPEN) { // L2RD: fatten\n        width_func = t => widfun(t, x1, y1, x2, y2, this.kMinWidthT) * this.kL2RDfatten;\n        width_func_d = t => widfun_d(t, x1, y1, x2, y2, this.kMinWidthT) * this.kL2RDfatten;\n      }\n      else if (a1 == STARTTYPE.THIN) {\n        width_func = t => widfun_fat(t, x1, y1, x2, y2, this.kMinWidthT);\n        width_func_d = t => widfun_fat_d(t, x1, y1, x2, y2, this.kMinWidthT);\n      }\n      else if (a2 == ENDTYPE.LEFT_SWEEP) {\n        width_func = t => widfun(1 - t, x1, y1, x2, y2, this.kMinWidthT);\n        width_func_d = t => -widfun_d(1 - t, x1, y1, x2, y2, this.kMinWidthT);\n      }\n      else {\n        width_func = t => this.kMinWidthT;\n        width_func_d = t => 0;\n      }\n      [bez1, bez2] = Bezier.cBezier(x1, y1, sx1, sy1, sx2, sy2, x2, y2, width_func, width_func_d);\n    }\n    if (a1 == 132 && x1 != sx1) {\n      let b1 = bezier_to_y(bez2[bez2.length - 1], y1);\n      if (b1) { bez2[bez2.length - 1] = b1; }\n      var temp = bez1[0];\n      let b2 = bezier_to_y(temp.reverse(), y1);\n      if (b2) { bez1[0] = b2.reverse(); }\n    } else if (a1 == 22 && x1 > sx1) {\n      let b1 = bezier_to_y(bez2[bez2.length - 1], y1);\n      if (b1) { bez2[bez2.length - 1] = b1; }\n      var temp = bez1[0];\n      let b2 = bezier_to_y(temp.reverse(), y1 + 1);//\" + 1\" ??\n      if (b2) { bez1[0] = b2.reverse(); }\n    }\n    var poly = Bezier.bez_to_poly(bez1);\n    poly.concat(Bezier.bez_to_poly(bez2));\n    cv.addPolygon(poly);\n\n    const bez1e = bez1[bez1.length - 1][3];\n    const bez1c2 = bez1[bez1.length - 1][2];\n\n    const bez2s = bez2[0][0];\n    const bez2c1 = bez2[0][1];\n    const tan1 = [bez1e[0] - bez1c2[0], bez1e[1] - bez1c2[1]];\n    const tan2 = [bez2s[0] - bez2c1[0], bez2s[1] - bez2c1[1]];\n    return [tan1, tan2];\n  }\n\n  getStartOfVLine(x1, y1, x2, y2, a1, kMinWidthT, cv) {\n    const dir = get_dir(x2 - x1, y2 - y1);\n    var poly_start = new Polygon(2);\n    if (dir.cos==0) {//vertical\n      var left1, right1;\n      switch (a1) {\n        case 0:\n          right1 = this.kMinWidthY / 2;\n          left1 = -this.kMinWidthY / 2;\n          break;\n        case 12:\n          right1 = this.kMinWidthY + kMinWidthT;\n          left1 = this.kMinWidthY;\n          break;\n        case 32:\n          right1 = this.kMinWidthY - 0.001;\n          left1 = this.kMinWidthY - 0.001;\n          break;\n        case 1:\n        case 6: //... no need\n        case 22:\n        default:\n          right1 = 0;\n          left1 = 0;\n          break;\n      }\n      poly_start = this.getStartOfOffsetLine(x1, y1, dir, kMinWidthT, right1, left1);\n      if (a1 == 22) { //box's right top corner\n        cv.drawUpperRightCorner_straight_v(x1, y1, kMinWidthT, this.kMinWidthY, this.kWidth);\n      }\n      if (a1 == 0) { //beginning of the stroke\n        cv.drawOpenBegin_straight(x1, y1, kMinWidthT, this.kMinWidthY, dir);\n      }\n    } else {\n      const rad = Math.atan((y2 - y1) / (x2 - x1));\n      const v = (x1 > x2) ? -1 : 1;\n      if (a1 == 22) {\n        if (dir.sin==0) {//error\n          console.log(\"error: connecting_v at the end of the horizontal line\")\n          poly_start = this.getStartOfLine(x1, y1, dir, kMinWidthT);\n        } else {\n          //poly_start.set(1, x1 + (kMinWidthT * v + 1) / Math.sin(rad), y1 + 1);//\" + 1\" ??\n          poly_start.set(1, x1 + (kMinWidthT * v) / Math.sin(rad), y1);\n          poly_start.set(0, x1 - (kMinWidthT * v) / Math.sin(rad), y1);\n        }\n      } else if (a1 == 32) {\n        if (dir.sin==0) {//error\n          console.log(\"error: connecting_v at the end of the horizontal line\")\n          poly_start = this.getStartOfLine(x1, y1, dir, kMinWidthT);\n        } else {\n          poly_start.set(1, x1 + (kMinWidthT * v) / Math.sin(rad), y1);\n          poly_start.set(0, x1 - (kMinWidthT * v) / Math.sin(rad), y1);\n        }\n      } else {\n        var left1, right1;\n        switch (a1) {\n          case 0:\n            right1 = this.kMinWidthY * 0.5;\n            left1 = this.kMinWidthY * -0.5;\n            break;\n          case 12:\n            right1 = this.kMinWidthY + kMinWidthT;\n            left1 = this.kMinWidthY;\n            break;\n          case 1:\n          case 6:\n          default:\n            right1 = 0;\n            left1 = 0;\n            break;\n        }\n        poly_start = this.getStartOfOffsetLine(x1, y1, dir, kMinWidthT, right1, left1);\n      }\n      if (a1 == 22) { //SHIKAKU MIGIUE UROKO NANAME DEMO MASSUGU MUKI\n        cv.drawUpperRightCorner(x1, y1, kMinWidthT, this.kMinWidthY, this.kWidth);\n      }\n      if (a1 == 0) { //beginning of the stroke\n        cv.drawOpenBegin_straight(x1, y1, kMinWidthT, this.kMinWidthY, dir);\n      }\n    }\n    return poly_start;\n  }\n\n  getStartOfLine(x1, y1, dir, halfWidth) {\n    //get polygon data for the start of line\n    var poly = new Polygon(2);\n    poly.set(1, x1 + dir.sin * halfWidth,\n      y1 - dir.cos * halfWidth);\n    poly.set(0, x1 - dir.sin * halfWidth,\n      y1 + dir.sin * halfWidth);\n    return poly;\n  }\n\n  getStartOfOffsetLine(x1, y1, dir, halfWidth, off_right1, off_left1) {\n    //get polygon data for the start of line (with offset)\n    var poly = new Polygon(2);\n    poly.set(1, x1 + dir.sin * halfWidth - dir.cos * off_left1,\n      y1 - dir.cos * halfWidth - dir.sin * off_left1);\n    poly.set(0, x1 - dir.sin * halfWidth - dir.cos * off_right1,\n      y1 + dir.cos * halfWidth - dir.sin * off_right1);\n    return poly;\n  }\n\n  getEndOfLine(x1, y1, x2, y2, halfWidth) {\n    //get polygon data for the end of line\n    const dir = get_dir(x2 - x1, y2 - y1);\n    var poly = new Polygon(2);\n    poly.set(0, x2 + dir.sin * halfWidth,\n      y2 - dir.cos * halfWidth);\n    poly.set(1, x2 - dir.sin * halfWidth,\n      y2 + dir.cos * halfWidth);\n    return poly;\n  }\n\n  getEndOfOffsetLine(x1, y1, x2, y2, halfWidth, off_right2, off_left2) {\n    //get polygon data for the end of line (with offset)\n    const dir = get_dir(x2 - x1, y2 - y1);\n    var poly = new Polygon(2);\n    poly.set(0, x2 + dir.sin * halfWidth + off_left2 * dir.cos,\n      y2 - dir.cos * halfWidth + off_left2 * dir.sin);\n    poly.set(1, x2 - dir.sin * halfWidth + off_right2 * dir.cos,\n      y2 + dir.cos * halfWidth + off_right2 * dir.sin);\n    return poly;\n  }\n\n  //functions for adjustment\n\n  adjustTateParam(stroke, others) { // strokes\n    //(STROKETYPE.STRAIGHT || STROKETYPE.BENDING || STROKETYPE.VCURVE)\n    if (stroke[3] != stroke[5]) return 0;\n    var res = 0;\n    for (let other of others) {\n      if ((other[0] == 1 || other[0] == 3 || other[0] == 7) && other[3] == other[5] &&\n        !(stroke[4] + 1 > other[6] || stroke[6] - 1 < other[4]) &&\n        Math.abs(stroke[3] - other[3]) < this.kMinWidthT * this.kAdjustTateStep) {\n        res += (this.kAdjustTateStep - Math.floor(Math.abs(stroke[3] - other[3]) / this.kMinWidthT));\n      }\n    }\n    res = Math.min(res, this.kAdjustTateStep);\n    return res;//a2 += res * 1000\n  }\n\n  adjustUrokoParam(stroke, others) { // strokes\n    //STROKETYPE.STRAIGHT && ENDTYPE.OPEN\n    for (var k = 0; k < this.kAdjustUrokoLengthStep; k++) {\n      var tx, ty, tlen;\n      if (stroke[4] == stroke[6]) { // YOKO\n        tx = stroke[5] - this.kAdjustUrokoLine[k];\n        ty = stroke[6] - 0.5;\n        tlen = stroke[5] - stroke[3];\n      } else {\n        var rad = Math.atan((stroke[6] - stroke[4]) / (stroke[5] - stroke[3]));\n        tx = stroke[5] - this.kAdjustUrokoLine[k] * Math.cos(rad) - 0.5 * Math.sin(rad);\n        ty = stroke[6] - this.kAdjustUrokoLine[k] * Math.sin(rad) - 0.5 * Math.cos(rad);\n        tlen = Math.sqrt((stroke[6] - stroke[4]) * (stroke[6] - stroke[4]) +\n          (stroke[5] - stroke[3]) * (stroke[5] - stroke[3]));\n      }\n      if (tlen < this.kAdjustUrokoLength[k] ||\n        isCrossWithOthers(others, -1, tx, ty, stroke[5], stroke[6])\n      ) {\n        return (this.kAdjustUrokoLengthStep - k);\n      }\n    }\n    return 0;//a3 += res * 100;\n  }\n\n  adjustUroko2Param(stroke, others) { // strokes\n    //STROKETYPE.STRAIGHT && ENDTYPE.OPEN && y1==y2\n    var pressure = 0;\n    for (let other of others) {\n      if (\n        (other[0] == 1 && other[4] == other[6] &&\n          !(stroke[3] + 1 > other[5] || stroke[5] - 1 < other[3]) &&\n          Math.abs(stroke[4] - other[4]) < this.kAdjustUroko2Length) ||\n        (other[0] == 3 && other[6] == other[8] &&\n          !(stroke[3] + 1 > other[7] || stroke[5] - 1 < other[5]) &&\n          Math.abs(stroke[4] - other[6]) < this.kAdjustUroko2Length)\n      ) {\n        pressure += Math.pow(this.kAdjustUroko2Length - Math.abs(stroke[4] - other[6]), 1.1);\n      }\n    }\n    var result = Math.min(Math.floor(pressure / this.kAdjustUroko2Length), this.kAdjustUroko2Step);\n    return result;//a3 += res * 100;\n  }\n\n  adjustHaneParam(epx, epy, others) { // adjust \"Hane\" (short line turning to the left)\n    //endPointX, endPointY\n    //(STROKETYPE.STRAIGHT || STROKETYPE.CURVE || STROKETYPE.BEZIER) && ENDTYPE.TURN_LEFT\n    var res = 0;\n    var nearest = Infinity; // the nearest point to the short line\n    if (epx + 18 < 100) {\n      nearest = epx + 18;\n    }\n    for (let other of others) {\n      if (other[0] == STROKETYPE.STRAIGHT && other[3] == other[5] && other[3] < epx && other[4] <= epy && other[6] >= epy) {\n        if (epx - other[3] < 100) {\n          nearest = Math.min(nearest, epx - other[3]);\n        }\n      }\n    }\n    if (nearest != Infinity) {\n      res = 7 - Math.floor(nearest / 15);\n    }\n    return res;//a3 += res * 100;\n  }\n\n  adjustMageParam(stroke, others) {\n    //STROKETYPE.BENDING\n    //applied only if y2=y3\n    if (stroke[6] != stroke[8]) return 0;\n    var res = 0;\n    for (let other of others) {\n      if (\n        (other[0] == 1 && other[4] == other[6] &&\n          !(stroke[5] + 1 > other[5] || stroke[7] - 1 < other[3]) &&\n          Math.abs(stroke[6] - other[4]) < this.kMinWidthT * this.kAdjustMageStep) ||\n        (other[0] == 3 && other[6] == other[8] &&\n          !(stroke[5] + 1 > other[7] || stroke[7] - 1 < other[5]) &&\n          Math.abs(stroke[6] - other[6]) < this.kMinWidthT * this.kAdjustMageStep)\n      ) {\n        res += this.kAdjustMageStep - Math.floor(Math.abs(stroke[6] - other[6]) / this.kMinWidthT);\n      }\n    }\n    res = Math.min(res, this.kAdjustMageStep);\n    return res;//a3 += res * 1000;\n  }\n\n  adjustKirikuchiParam(stroke, others) { // connecting to other strokes.\n    //STROKETYPE.CURVE, STARTTYPE.CONNECTING_V\n    if (stroke[3] > stroke[5] &&\n      stroke[4] < stroke[6]) {\n      for (let other of others) {\n        if (other[0] == 1 &&\n          other[3] < stroke[3] && other[5] > stroke[3] &&\n          other[4] == stroke[4] && other[4] == other[6]) {\n          return true;\n        }\n      }\n    }\n    return false;\n    //if (res) a2 += 100;\n  }\n  \n  adjustKakatoParam(stroke, others) {\n    //if (STROKETYPE.STRAIGHT && (LOWER_LEFT_CORNER || LOWER_RIGHT_CORNER))\n    for (var k = 0; k < this.kAdjustKakatoStep; k++) {\n      if (isCrossBoxWithOthers(others, -1,\n        stroke[5] - this.kAdjustKakatoRangeX / 2,\n        stroke[6] + this.kAdjustKakatoRangeY[k],\n        stroke[5] + this.kAdjustKakatoRangeX / 2,\n        stroke[6] + this.kAdjustKakatoRangeY[k + 1])\n        | stroke[6] + this.kAdjustKakatoRangeY[k + 1] > 200 // adjust for baseline\n        | stroke[6] - stroke[4] < this.kAdjustKakatoRangeY[k + 1] // for thin box\n      ) {\n        return (3 - k);\n      }\n    }\n    return 0;\n    //a3 += res * 100;\n  }\n}","export enum ReflectRotateType {\n  reflectX,\n  reflectY,\n  rotate90,\n  rotate180,\n  rotate270,\n}\n\nexport const reflectRotateTypes = [\n  ReflectRotateType.reflectX,\n  ReflectRotateType.reflectY,\n  ReflectRotateType.rotate90,\n  ReflectRotateType.rotate180,\n  ReflectRotateType.rotate270,\n];\n\nexport const reflectRotateTypeParamsMap: Record<ReflectRotateType, [number, number]> = {\n  [ReflectRotateType.reflectX]: [98, 0],\n  [ReflectRotateType.reflectY]: [97, 0],\n  [ReflectRotateType.rotate90]: [99, 1],\n  [ReflectRotateType.rotate180]: [99, 2],\n  [ReflectRotateType.rotate270]: [99, 3],\n};\n","import { Buhin } from \"./buhin\";\nimport { Gothic } from \"./gothic\";\nimport { Mincho } from \"./mincho\";\nimport { STROKETYPE } from \"./stroketype\";\nimport {getBoundingBox, stretch} from \"./util\";\nexport const FONTTYPE = {\n  MINCHO: 0,\n  GOTHIC: 1,\n}\n\nexport class Kage {\n  constructor(type, size){\n    this.kBuhin = new Buhin();\n    this.setFont(type,size);\n    this.kRate = 100;\n  }\n  setFont(type, size){\n    switch(type){\n     case FONTTYPE.GOTHIC:{\n        this.kFont = new Gothic(size);\n        break;\n      }\n      case FONTTYPE.MINCHO:{\n        this.kFont = new Mincho(size);\n        break;\n      }\n      default:{\n        this.kFont = new Mincho(size);\n        break;\n      }\n    }\n  }\n  makeGlyph(polygons, buhin) { // The word \"buhin\" means \"component\".  This method converts buhin (KAGE data format) to polygons (path data).  The variable buhin may represent a component of kanji or a kanji itself.\n    var glyphData = this.kBuhin.search(buhin);\n    this.makeGlyph2(polygons, glyphData);\n  }\n  makeGlyph2(polygons, data) {\n      var kageStrokes = this.getStrokes(data);\n      polygons.concat(this.kFont.getPolygons(kageStrokes));\n  }\n  makeGlyph3(data) { // void\n    var kageStrokes = this.getStrokes(data);\n    return this.kFont.getPolygons(kageStrokes);\n  }\n\n  makeGlyphSeparated2(data) {\n\t\tconst strokesArrays = data.map((subdata) => this.getStrokes(subdata));\n\t\treturn strokesArrays.map((strokesArray) => {\n\t\t\tconst result = this.kFont.getPolygons(strokesArray)\n\t\t\treturn result;\n\t\t});\n  }\n  makeGlyphSeparated(data) {\n    const strokesArrays = data.map((subdata) => this.getStrokes(subdata));\n    return this.kFont.getPolygonsSeparated(strokesArrays);\n\t}\n  getStrokes(glyphData) { // strokes array\n    var strokes = new Array();\n    var textData = glyphData.split(\"$\");\n    for (var i = 0; i < textData.length; i++) {\n      var columns = textData[i].split(\":\");\n      if (Math.floor(columns[0]) != STROKETYPE.REFERENCE) {\n        strokes.push([\n          Math.floor(columns[0]),\n          Math.floor(columns[1]),\n          Math.floor(columns[2]),\n          Math.floor(columns[3]),\n          Math.floor(columns[4]),\n          Math.floor(columns[5]),\n          Math.floor(columns[6]),\n          Math.floor(columns[7]),\n          Math.floor(columns[8]),\n          Math.floor(columns[9]),\n          Math.floor(columns[10])\n        ]);\n\n      } else {\n        var buhin = this.kBuhin.search(columns[7]);\n        if (buhin != \"\") {\n          strokes = strokes.concat(this.getStrokesOfBuhin(buhin,\n            Math.floor(columns[3]),\n            Math.floor(columns[4]),\n            Math.floor(columns[5]),\n            Math.floor(columns[6]),\n            Math.floor(columns[1]),\n            Math.floor(columns[2]),\n            Math.floor(columns[9]),\n            Math.floor(columns[10]))\n          );\n        }\n      }\n    }\n    return strokes;\n  }\n\n  getStrokesOfBuhin(buhin, x1, y1, x2, y2, sx, sy, sx2, sy2) {\n    var temp = this.getStrokes(buhin);\n    var result = new Array();\n    var box = getBoundingBox(temp);\n    if (sx != 0 || sy != 0) {\n      if (sx > 100) {\n        sx -= 200;\n      } else {\n        sx2 = 0;\n        sy2 = 0;\n      }\n    }\n    for (var i = 0; i < temp.length; i++) {\n      if (sx != 0 || sy != 0) {\n        temp[i][3] = stretch(sx, sx2, temp[i][3], box.minX, box.maxX);\n        temp[i][4] = stretch(sy, sy2, temp[i][4], box.minY, box.maxY);\n        temp[i][5] = stretch(sx, sx2, temp[i][5], box.minX, box.maxX);\n        temp[i][6] = stretch(sy, sy2, temp[i][6], box.minY, box.maxY);\n        if (temp[i][0] != STROKETYPE.REFERENCE) {\n          temp[i][7] = stretch(sx, sx2, temp[i][7], box.minX, box.maxX);\n          temp[i][8] = stretch(sy, sy2, temp[i][8], box.minY, box.maxY);\n          temp[i][9] = stretch(sx, sx2, temp[i][9], box.minX, box.maxX);\n          temp[i][10] = stretch(sy, sy2, temp[i][10], box.minY, box.maxY);\n        }\n      }\n      result.push([temp[i][0],\n      temp[i][1],\n      temp[i][2],\n      x1 + temp[i][3] * (x2 - x1) / 200,\n      y1 + temp[i][4] * (y2 - y1) / 200,\n      x1 + temp[i][5] * (x2 - x1) / 200,\n      y1 + temp[i][6] * (y2 - y1) / 200,\n      x1 + temp[i][7] * (x2 - x1) / 200,\n      y1 + temp[i][8] * (y2 - y1) / 200,\n      x1 + temp[i][9] * (x2 - x1) / 200,\n      y1 + temp[i][10] * (y2 - y1) / 200]);\n      \n    }\n    return result;\n  }\n\n  //for compatibility\n  getEachStrokes(glyphData) {\n    return this.getStrokes(glyphData);\n  }\n  getBox(strokes){\n    return getBoundingBox(strokes);\n  }\n  stretch(dp, sp, p, min, max){\n    return stretch(dp, sp, p, min, max);\n  }\n}\n","import actionCreatorFactory from 'typescript-fsa';\n\nimport { StretchParam } from '../kageUtils/stretchparam';\nimport { ReflectRotateType } from '../kageUtils/reflectrotate';\n\nconst actionCreator = actionCreatorFactory('EDITOR');\n\nexport const editorActions = {\n  loadedBuhin: actionCreator<[string, string]>('LOAD_BUHIN_DATA'),\n  loadedStretchParam: actionCreator<[string, StretchParam]>('LOAD_STRETCH_PARAM'),\n\n  changeStrokeType: actionCreator<number>('CHANGE_STROKE_TYPE'),\n  changeHeadShapeType: actionCreator<number>('CHANGE_HEAD_SHAPE_TYPE'),\n  changeTailShapeType: actionCreator<number>('CHANGE_TAIL_SHAPE_TYPE'),\n  changeStretchCoeff: actionCreator<number>('CHANGE_STRETCH_COEFF'),\n  changeReflectRotateOpType: actionCreator<ReflectRotateType>('CHANGE_REFLECT_ROTATE_OPTYPE'),\n\n  swapWithPrev: actionCreator('SWAP_WITH_PREV'),\n  swapWithNext: actionCreator('SWAP_WITH_NEXT'),\n\n  insertPart: actionCreator<string>('ADD_PART'),\n\n  paste: actionCreator('PASTE'),\n  copy: actionCreator('COPY_SELECTION'),\n  cut: actionCreator('CUT_SELECTION'),\n  delete: actionCreator('DELETE_SELECTION'),\n  decomposeSelected: actionCreator('DECOMPOSE_SELECTION'),\n  moveSelected: actionCreator<[number, number]>('MOVE_SELECTED'),\n\n  toggleFreehand: actionCreator('TOGGLE_FREEHAND_MODE'),\n\n  escape: actionCreator('PRESS_ESC_KEY'),\n\n  finishEdit: actionCreator<Event>('FINISH_EDIT'),\n};\n","// The temporary reverse proxy which adds 'Access-Control-Allow-Origin: *' header.\n// This header is required for cross-origin requests.\nconst apiUrlPrefix = 'https://asia-northeast1-ku6goma.cloudfunctions.net/gwproxy';\n\nconst callApi = async (path: string) => {\n  const response = await fetch(apiUrlPrefix + path);\n  if (!response.ok) {\n    throw new Error('API error occurred');\n  }\n  return new URLSearchParams(await response.text());\n};\n\nexport const getSource = async (name: string) => {\n  const result = await callApi(`/get_source.cgi?name=${encodeURIComponent(name)}`);\n  return result.get('data');\n};\n\nexport const search = async (query: string) => {\n  const result = await callApi(`/search4ge.cgi?query=${encodeURIComponent(query)}`);\n  return result.get('data')!;\n};\n\nexport const getCandidate = async (name: string) => {\n  const result = await callApi(`/get_candidate.cgi?name=${encodeURIComponent(name)}`);\n  return result.get('data')!;\n};\n","import memoizeOne from 'memoize-one';\n\nimport { Kage, Polygons } from '@ge9/kage-engine-2';\nimport { Glyph, unparseGlyphLine } from './kageUtils/glyph';\nimport { StretchParam } from './kageUtils/stretchparam';\n\nimport store from './store';\nimport { editorActions } from './actions/editor';\n\nimport { getSource } from './callapi';\n\nexport type KShotai = Kage[\"kShotai\"];\n\nconst kage_ = new Kage();\n\nexport const getKage = (buhinMap: Map<string, string>, fallback?: (name: string) => string | undefined | void, shotai?: KShotai): Kage => {\n  kage_.kBuhin.search = (name) => {\n    let result = buhinMap.get(name);\n    if (typeof result === 'undefined') {\n      result = fallback?.(name) || '';\n    }\n    return result;\n  };\n  if (typeof shotai !== 'undefined') {\n    kage_.kShotai = shotai;\n  }\n  return kage_;\n};\n\nlet waiting = new Set<string>();\nconst loadAbsentBuhin = (name: string) => {\n  if (waiting.has(name)) {\n    return;\n  }\n  waiting.add(name);\n  getSource(name)\n    .then((source) => {\n      if (typeof source !== 'string') {\n        throw new Error(`failed to get buhin source of ${name}`);\n      }\n      const stretchMatch = /^0:1:0:(-?\\d+):(-?\\d+):(-?\\d+):(-?\\d+)(?=$|\\$)/.exec(source);\n      if (stretchMatch) {\n        const params: StretchParam = [\n          +stretchMatch[1] || 0,\n          +stretchMatch[2] || 0,\n          +stretchMatch[3] || 0,\n          +stretchMatch[4] || 0,\n        ];\n        store.dispatch(editorActions.loadedStretchParam([name, params]));\n      }\n      store.dispatch(editorActions.loadedBuhin([name, source]));\n      waiting.delete(name);\n    })\n    .catch((err) => console.error(err));\n};\n\nconst filteredGlyphIsEqual = (glyph1: Glyph, glyph2: Glyph) => (\n  glyph1.length === glyph2.length &&\n  glyph1.every((gLine1, index) => (\n    gLine1 === glyph2[index]\n  ))\n);\n\nconst makeGlyphSeparated_ = memoizeOne((glyph: Glyph, map: Map<string, string>, shotai: KShotai): Polygons[] => {\n  const data = glyph.map(unparseGlyphLine);\n  const result = getKage(map, loadAbsentBuhin, shotai).makeGlyphSeparated(data);\n  return result;\n}, ([glyph1, map1, shotai1], [glyph2, map2, shotai2]) => (\n  map1 === map2 &&\n  shotai1 === shotai2 &&\n  filteredGlyphIsEqual(glyph1, glyph2)\n));\n\nconst makeGlyphSeparatedFactory = (\n  isEqual?: (newArgs: Parameters<typeof makeGlyphSeparated_>, lastArgs: Parameters<typeof makeGlyphSeparated_>) => boolean\n) => memoizeOne((glyph: Glyph, map: Map<string, string>, shotai: KShotai): Polygons[] => {\n  return makeGlyphSeparated_(glyph, map, shotai);\n}, isEqual);\n\nexport const makeGlyphSeparated = makeGlyphSeparatedFactory();\nexport const makeGlyphSeparatedForSubmit = makeGlyphSeparatedFactory(\n  ([glyph1, map1, shotai1], [glyph2, map2, shotai2]) => (\n    map1 === map2 &&\n    shotai1 === shotai2 &&\n    filteredGlyphIsEqual(glyph1, glyph2)\n  )\n);\n","import memoizeOne from 'memoize-one';\n\nimport { GlyphLine } from './glyph';\n\nexport type BBX = [number, number, number, number];\n\nexport const bbxOfPoints = (points: [number, number][]): BBX => {\n  const xs = points.map(([x]) => x);\n  const ys = points.map(([, y]) => y);\n  return [\n    Math.min(...xs),\n    Math.min(...ys),\n    Math.max(...xs),\n    Math.max(...ys),\n  ];\n};\n\nexport const getGlyphLineBBX = (glyphLine: GlyphLine): BBX => {\n  switch (glyphLine.value[0]) {\n    case 99:\n      return bbxOfPoints([\n        [glyphLine.value[3], glyphLine.value[4]],\n        [glyphLine.value[5], glyphLine.value[6]],\n      ]);\n    case 0:\n    case 1:\n    case 2:\n    case 3:\n    case 4:\n    case 6:\n    case 7:\n    case 9: {\n      const points: [number, number][] = [];\n      for (let i = 3; i + 2 <= glyphLine.value.length; i += 2) {\n        points.push([glyphLine.value[i], glyphLine.value[i + 1]]);\n      }\n      return bbxOfPoints(points);\n    }\n    default:\n      return bbxOfPoints([]);\n  }\n}\n\nexport const mergeBBX = ([x11, y11, x12, y12]: BBX, [x21, y21, x22, y22]: BBX): BBX => [\n  Math.min(x11, x21),\n  Math.min(y11, y21),\n  Math.max(x12, x22),\n  Math.max(y12, y22),\n];\n\nexport const getGlyphLinesBBX = memoizeOne((glyphLines: GlyphLine[]): BBX => {\n  return glyphLines.map(getGlyphLineBBX).reduce(mergeBBX, bbxOfPoints([]));\n}, ([gLines1], [gLines2]) => (\n  gLines1.length === gLines2.length &&\n  gLines1.every((gLine1, index) => gLine1 === gLines2[index])\n));\n","import { createSelector } from 'reselect';\n\nimport { RectPointPosition } from '../actions/drag';\n\nimport { AppState } from '../reducers';\n\nimport { Glyph, GlyphLine } from '../kageUtils/glyph';\nimport { getGlyphLinesBBX } from '../kageUtils/bbx';\nimport { moveSelectedGlyphLines, moveSelectedPoint, resizeSelectedGlyphLines } from '../kageUtils/transform';\nimport { drawFreehand } from '../kageUtils/freehand';\n\nexport const resizeSelected = (glyph: Glyph, selection: number[], position: RectPointPosition, dx: number, dy: number): Glyph => {\n  if (selection.length === 1) {\n    const selectedGlyphLine = glyph[selection[0]];\n    switch (selectedGlyphLine.value[0]) {\n      case 0:\n      case 9:\n      case 99: {\n        const newValue = selectedGlyphLine.value.slice();\n        switch (position) {\n          case RectPointPosition.north:\n            newValue[4] = Math.round(newValue[4] + dy);\n            break;\n          case RectPointPosition.west:\n            newValue[3] = Math.round(newValue[3] + dx);\n            break;\n          case RectPointPosition.south:\n            newValue[6] = Math.round(newValue[6] + dy);\n            break;\n          case RectPointPosition.east:\n            newValue[5] = Math.round(newValue[5] + dx);\n            break;\n          case RectPointPosition.southeast:\n            newValue[5] = Math.round(newValue[5] + dx);\n            newValue[6] = Math.round(newValue[6] + dy);\n            break;\n          default:\n            // exhaustive?\n            ((_x: never) => { })(position);\n        }\n        const newGlyphLine: GlyphLine = selectedGlyphLine.value[0] === 99\n          ? { value: newValue, partName: selectedGlyphLine.partName }\n          : { value: newValue };\n        return glyph.map((glyphLine, index) => index === selection[0] ? newGlyphLine : glyphLine);\n      }\n    }\n  }\n  const minSize = 20;\n  const oldBBX = getGlyphLinesBBX(selection.map((index) => glyph[index]));\n  const newBBX = oldBBX.slice() as typeof oldBBX;\n  switch (position) {\n    case RectPointPosition.north:\n      newBBX[1] = Math.min(newBBX[1] + dy, newBBX[3] - minSize);\n      break;\n    case RectPointPosition.west:\n      newBBX[0] = Math.min(newBBX[0] + dx, newBBX[2] - minSize);\n      break;\n    case RectPointPosition.south:\n      newBBX[3] = Math.max(newBBX[3] + dy, newBBX[1] + minSize);\n      break;\n    case RectPointPosition.east:\n      newBBX[2] = Math.max(newBBX[2] + dx, newBBX[0] + minSize);\n      break;\n    case RectPointPosition.southeast:\n      newBBX[2] = Math.max(newBBX[2] + dx, newBBX[0] + minSize);\n      newBBX[3] = Math.max(newBBX[3] + dy, newBBX[1] + minSize);\n      break;\n    default:\n      // exhaustive?\n      ((_x: never) => { })(position);\n  }\n  return resizeSelectedGlyphLines(glyph, selection, oldBBX, newBBX);\n};\n\nexport const draggedGlyphSelector = createSelector([\n  (state: AppState) => state.glyph,\n  (state: AppState) => state.selection,\n  (state: AppState) => state.dragSelection,\n  (state: AppState) => state.dragPoint,\n  (state: AppState) => state.resizeSelection,\n  (state: AppState) => state.freehandStroke,\n], (glyph, selection, dragSelection, dragPoint, resizeSelection, freehandStroke) => {\n  if (dragSelection) {\n    const [x1, y1, x2, y2] = dragSelection;\n    const dx = x2 - x1;\n    const dy = y2 - y1;\n    glyph = moveSelectedGlyphLines(glyph, selection, dx, dy);\n  } else if (dragPoint) {\n    const [pointIndex, [x1, y1, x2, y2]] = dragPoint;\n    const dx = x2 - x1;\n    const dy = y2 - y1;\n    glyph = moveSelectedPoint(glyph, selection, pointIndex, dx, dy);\n  } else if (resizeSelection) {\n    const [position, [x1, y1, x2, y2]] = resizeSelection;\n    const dx = x2 - x1;\n    const dy = y2 - y1;\n    glyph = resizeSelected(glyph, selection, position, dx, dy);\n  } else if (freehandStroke) {\n    glyph = drawFreehand(glyph, freehandStroke);\n  }\n  return glyph;\n});\n","import { ReducerBuilder } from 'typescript-fsa-reducers';\n\n// @ts-ignore\nimport { polygonInPolygon, polygonIntersectsPolygon } from 'geometric';\n\nimport { dragActions } from '../actions/drag';\n\nimport { Glyph } from '../kageUtils/glyph';\nimport { moveSelectedGlyphLines, moveSelectedPoint } from '../kageUtils/transform';\nimport { drawFreehand } from '../kageUtils/freehand';\nimport { makeGlyphSeparated, KShotai } from '../kage';\n\nimport { AppState } from '.';\nimport { resizeSelected } from '../selectors/draggedGlyph';\n\nconst performAreaSelect = (glyph: Glyph, buhinMap: Map<string, string>, shotai: KShotai, x1: number, y1: number, x2: number, y2: number): number[] => {\n  const polygonsSep = makeGlyphSeparated(glyph, buhinMap, shotai);\n  const result = [];\n\n  const gAreaPolygon: [number, number][] = [\n    [x1, y1],\n    [x1, y2],\n    [x2, y2],\n    [x2, y1],\n    [x1, y1],\n  ];\n\n  for (let index = 0; index < polygonsSep.length; index++) {\n    const polygons = polygonsSep[index];\n    if (polygons.array.some((polygon) => {\n      const gPolygon = polygon.array.map(({ x, y }) => [x, y]);\n      gPolygon.push(gPolygon[0]); // close polygon\n\n      return (\n        polygonInPolygon(gAreaPolygon, gPolygon) ||\n        polygonInPolygon(gPolygon, gAreaPolygon) ||\n        polygonIntersectsPolygon(gAreaPolygon, gPolygon)\n      ) as boolean;\n    })) {\n      result.push(index);\n    }\n  }\n  return result;\n};\n\nconst updateBuilder = (builder: ReducerBuilder<AppState>) => builder\n  .case(dragActions.startBackgroundDrag, (state, evt) => {\n    if (!state.ctmInv) {\n      return state;\n    }\n    const [x1, y1] = state.ctmInv(evt.clientX, evt.clientY);\n    if (state.freehandMode) {\n      return {\n        ...state,\n        freehandStroke: [[x1, y1]],\n      };\n    }\n    return {\n      ...state,\n      areaSelectRect: [x1, y1, x1, y1],\n    };\n  })\n  .case(dragActions.startSelectionDrag, (state, evt) => {\n    if (!state.ctmInv) {\n      return state;\n    }\n    const [x1, y1] = state.ctmInv(evt.clientX, evt.clientY);\n    return {\n      ...state,\n      dragSelection: [x1, y1, x1, y1],\n    };\n  })\n  .case(dragActions.startPointDrag, (state, [evt, pointIndex]) => {\n    if (!state.ctmInv) {\n      return state;\n    }\n    const [x1, y1] = state.ctmInv(evt.clientX, evt.clientY);\n    return {\n      ...state,\n      dragPoint: [pointIndex, [x1, y1, x1, y1]],\n    };\n  })\n  .case(dragActions.startResize, (state, [evt, position]) => {\n    if (!state.ctmInv) {\n      return state;\n    }\n    const [x1, y1] = state.ctmInv(evt.clientX, evt.clientY);\n    return {\n      ...state,\n      resizeSelection: [position, [x1, y1, x1, y1]],\n    };\n  })\n\n  .case(dragActions.mouseMove, (state, evt) => {\n    if (!state.ctmInv) {\n      return state;\n    }\n    if (state.areaSelectRect) {\n      const [x1, y1] = state.areaSelectRect;\n      const [x2, y2] = state.ctmInv(evt.clientX, evt.clientY);\n      return {\n        ...state,\n        areaSelectRect: [x1, y1, x2, y2],\n      };\n    }\n    if (state.dragSelection) {\n      const [x1, y1] = state.dragSelection;\n      const [x2, y2] = state.ctmInv(evt.clientX, evt.clientY);\n      return {\n        ...state,\n        dragSelection: [x1, y1, x2, y2],\n      };\n    }\n    if (state.dragPoint) {\n      const [pointIndex, [x1, y1]] = state.dragPoint;\n      const [x2, y2] = state.ctmInv(evt.clientX, evt.clientY);\n      return {\n        ...state,\n        dragPoint: [pointIndex, [x1, y1, x2, y2]],\n      };\n    }\n    if (state.resizeSelection) {\n      const [position, [x1, y1]] = state.resizeSelection;\n      const [x2, y2] = state.ctmInv(evt.clientX, evt.clientY);\n      return {\n        ...state,\n        resizeSelection: [position, [x1, y1, x2, y2]],\n      };\n    }\n    if (state.freehandStroke) {\n      const [x2, y2] = state.ctmInv(evt.clientX, evt.clientY);\n      let freehandStroke = state.freehandStroke.concat([[x2, y2]]);\n      if (freehandStroke.length >= 3) {\n        const [lastX, lastY] = freehandStroke[freehandStroke.length - 2];\n        if (Math.abs(x2 - lastX) < 2 && Math.abs(y2 - lastY) < 2) {\n          freehandStroke.splice(freehandStroke.length - 2, 1);\n        }\n      }\n      return {\n        ...state,\n        freehandStroke,\n      };\n    }\n    return state;\n  })\n  .case(dragActions.mouseUp, (state, evt) => {\n    if (!state.ctmInv) {\n      return state;\n    }\n    if (state.areaSelectRect) {\n      const [x1, y1] = state.areaSelectRect;\n      const [x2, y2] = state.ctmInv(evt.clientX, evt.clientY);\n      const intersections = performAreaSelect(state.glyph, state.buhinMap, state.shotai, x1, y1, x2, y2);\n\n      const newSelection = Array.from(new Set(state.selection.concat(intersections)));\n      return {\n        ...state,\n        selection: newSelection,\n        areaSelectRect: null,\n      };\n    }\n    if (state.dragSelection) {\n      const [x1, y1] = state.dragSelection;\n      const [x2, y2] = state.ctmInv(evt.clientX, evt.clientY);\n\n      const newGlyph = moveSelectedGlyphLines(state.glyph, state.selection, x2 - x1, y2 - y1);\n      return {\n        ...state,\n        glyph: newGlyph,\n        dragSelection: null,\n      };\n    }\n    if (state.dragPoint) {\n      const [pointIndex, [x1, y1]] = state.dragPoint;\n      const [x2, y2] = state.ctmInv(evt.clientX, evt.clientY);\n\n      const newGlyph = moveSelectedPoint(state.glyph, state.selection, pointIndex, x2 - x1, y2 - y1);\n      return {\n        ...state,\n        glyph: newGlyph,\n        dragPoint: null,\n      };\n    }\n    if (state.resizeSelection) {\n      const [position, [x1, y1]] = state.resizeSelection;\n      const [x2, y2] = state.ctmInv(evt.clientX, evt.clientY);\n\n      const newGlyph = resizeSelected(state.glyph, state.selection, position, x2 - x1, y2 - y1);\n      return {\n        ...state,\n        glyph: newGlyph,\n        resizeSelection: null,\n      };\n    }\n    if (state.freehandStroke) {\n      const [x2, y2] = state.ctmInv(evt.clientX, evt.clientY);\n      const freehandStroke = state.freehandStroke.concat([[x2, y2]]);\n\n      const newGlyph = drawFreehand(state.glyph, freehandStroke);\n      return {\n        ...state,\n        glyph: newGlyph,\n        freehandStroke: null,\n      };\n    }\n    return state;\n  })\n\n  .case(dragActions.updateCTMInv, (state, ctmInv) => ({\n    ...state,\n    ctmInv,\n  }));\n\n\nexport default updateBuilder;\n","import { GlyphLine } from './glyph';\n\nexport type StretchParam = [number, number, number, number];\nexport type StretchPositions = [number, number, number, number];\n\nexport const getStretchPositions = (glyphLine: GlyphLine): StretchPositions | null => {\n  if (glyphLine.value[0] !== 99) {\n    return null;\n  }\n  const sx = glyphLine.value[9];\n  const sy = glyphLine.value[10];\n  const tx = glyphLine.value[1];\n  const ty = glyphLine.value[2];\n  return [sx, sy, tx, ty];\n};\n\nexport const setStretchPositions = (glyphLine: GlyphLine, positions: StretchPositions): GlyphLine => {\n  if (glyphLine.value[0] !== 99) {\n    return glyphLine;\n  }\n  const [sx, sy, tx, ty] = positions;\n\n  const newValue = glyphLine.value.slice();\n  newValue[9] = Math.round(sx);\n  newValue[10] = Math.round(sy);\n  newValue[1] = Math.round(tx);\n  newValue[2] = Math.round(ty);\n  return { value: newValue, partName: glyphLine.partName };\n};\n\nexport const normalizeStretchPositions = (positions: StretchPositions): StretchPositions => {\n  let [sx, sy, tx, ty] = positions;\n  if (tx <= 100) {\n    tx += 200;\n    sx = sy = 0;\n  }\n  return [sx, sy, tx, ty];\n};\n\nexport const calcStretchPositions = (param: StretchParam, k: number): StretchPositions => {\n  const [x0, y0, x1, y1] = param;\n  return [\n    x0 - 100,\n    y0 - 100,\n    x0 + (x1 - x0) * k / 20 + 100,\n    y0 + (y1 - y0) * k / 20 - 100,\n  ];\n};\n\nconst clampStretchScalar = (k: number): number => Math.max(-10, Math.min(10, k));\n\nexport const calcStretchScalar = (param: StretchParam, positions: StretchPositions): number => {\n  const [x0, y0, x1, y1] = param;\n  if (x0 === x1 && y0 === y1) {\n    return 0;\n  }\n  const [sx, sy, tx, ty] = normalizeStretchPositions(positions);\n  if (sx === tx - 200 && sy === ty) {\n    return 0;\n  }\n  return clampStretchScalar(Math.round(\n    Math.abs(x0 - x1) > Math.abs(y0 - y1)\n      ? (tx - 100 - x0) / (x1 - x0) * 20\n      : (ty + 100 - y0) / (y1 - y0) * 20\n  )) || 0;\n}\n","import { getKage } from '../kage';\n\nimport { GlyphLine, parseGlyph, unparseGlyph, unparseGlyphLine, getNumColumns, Glyph } from './glyph';\nimport { getStretchPositions, normalizeStretchPositions, setStretchPositions } from './stretchparam';\nimport { applyGlyphLineOperation } from './transform';\n\nexport const decompose = (glyphLine: GlyphLine, buhinMap: Map<string, string>): GlyphLine[] => {\n  if (glyphLine.value[0] !== 99) {\n    return [glyphLine];\n  }\n  const buhinSource = buhinMap.get(glyphLine.partName!);\n  if (!buhinSource) {\n    return [glyphLine];\n  }\n\n  let failedBuhin = false;\n  const kage = getKage(buhinMap, () => {\n    failedBuhin = true;\n  });\n\n  const glyph = parseGlyph(buhinSource);\n\n  const strokesArray =\n    // @ts-ignore 2445\n    kage.getEachStrokes(\n      unparseGlyph(glyph)\n    );\n  const box =\n    // @ts-ignore 2445\n    kage.getBox(\n      strokesArray\n    );\n\n  const x1 = glyphLine.value[3];\n  const y1 = glyphLine.value[4];\n  const x2 = glyphLine.value[5];\n  const y2 = glyphLine.value[6];\n  const [sx, sy, tx, ty] = normalizeStretchPositions(getStretchPositions(glyphLine)!);\n  const isStretchEnabled = !(sx === tx - 200 && sy === ty);\n\n  if (isStretchEnabled && failedBuhin) {\n    // box may be incorrect\n    return [glyphLine];\n  }\n\n  return glyph.map((oldGlyphLine) => {\n    const tX = (x: number) => {\n      const stretchedX = isStretchEnabled\n        ? kage.stretch(tx - 200, sx, x, box.minX, box.maxX)\n        : x;\n      return Math.round(stretchedX / 200 * (x2 - x1) + x1);\n    };\n    const tY = (y: number) => {\n      const stretchedY = isStretchEnabled\n        ? kage.stretch(ty, sy, y, box.minY, box.maxY)\n        : y;\n      return Math.round(stretchedY / 200 * (y2 - y1) + y1);\n    };\n    const newGlyphLine = applyGlyphLineOperation(oldGlyphLine, tX, tY);\n\n    if (!(isStretchEnabled && newGlyphLine.value[0] === 99)) {\n      return newGlyphLine;\n    }\n\n    const [sx2, sy2, tx2, ty2] = normalizeStretchPositions(getStretchPositions(newGlyphLine)!);\n    if (!(sx2 === tx2 - 200 && sy2 === ty2)) {\n      // Cannot compose two stretches...\n      return newGlyphLine;\n    }\n\n    const px1 = newGlyphLine.value[3];\n    const py1 = newGlyphLine.value[4];\n    const px2 = newGlyphLine.value[5];\n    const py2 = newGlyphLine.value[6];\n\n    if (px1 === px2 || py1 === py2) {\n      return newGlyphLine;\n    }\n\n    const revX = (x: number) => (x - px1) / (px2 - px1) * 200;\n    const revY = (y: number) => (y - py1) / (py2 - py1) * 200;\n    return setStretchPositions(newGlyphLine, [\n      revX(sx + 100) - 100,\n      revY(sy + 100) - 100,\n      revX(tx - 100) + 100,\n      revY(ty + 100) - 100,\n    ]);\n  });\n};\n\nexport const decomposeDeep = (glyphLine: GlyphLine, buhinMap: Map<string, string>): GlyphLine[] => {\n  const kage = getKage(buhinMap);\n  const strokesArray =\n    // @ts-ignore 2445\n    kage.getEachStrokes(\n      unparseGlyphLine(glyphLine)\n    );\n  return strokesArray.map((stroke): GlyphLine => {\n    const columns = getNumColumns(stroke.a1);\n    return {\n      value: [\n        stroke.a1,\n        stroke.a2_100 + stroke.kirikuchiAdjustment * 100 + stroke.tateAdjustment * 1000,\n        stroke.a3_100 + stroke.opt3 * 100 + stroke.mageAdjustment * 1000,\n        Math.round(stroke.x1) || 0,\n        Math.round(stroke.y1) || 0,\n        Math.round(stroke.x2) || 0,\n        Math.round(stroke.y2) || 0,\n        Math.round(stroke.x3) || 0,\n        Math.round(stroke.y3) || 0,\n        Math.round(stroke.x4) || 0,\n        Math.round(stroke.y4) || 0,\n      ].slice(0, columns),\n    };\n  });\n};\n\nexport const decomposeDeepGlyph = (glyph: Glyph, buhinMap: Map<string, string>): GlyphLine[] => {\n  return glyph.map((glyphLine) => decomposeDeep(glyphLine, buhinMap)).reduce((a, b) => a.concat(b), []);\n};\n","import memoizeOne from 'memoize-one';\n\nimport { GlyphLine, getNumColumns } from './glyph';\n\nexport const strokeTypes = [1, 2, 3, 4, 6, 7];\n\nexport const headShapeTypes: Record<number, number[]> = {\n  1: [0, 2, 32, 12, 22],\n  2: [0, 32, 12, 22, 7, 27],\n  3: [0, 32, 12, 22],\n  4: [0, 22],\n  6: [0, 32, 12, 22, 7, 27],\n  7: [0, 32, 12, 22],\n};\n\nexport const tailShapeTypes: Record<number, number[]> = {\n  1: [0, 2, 32, 13, 23, 4, 313, 413, 24],\n  2: [7, 0, 8, 4, 5],\n  3: [0, 5],\n  4: [0, 5],\n  6: [7, 0, 8, 4, 5],\n  7: [7],\n};\n\nexport const changeStrokeType = (glyphLine: GlyphLine, newType: number): GlyphLine => {\n  const oldType = glyphLine.value[0];\n  if (!strokeTypes.includes(oldType) || !strokeTypes.includes(newType)) {\n    return glyphLine;\n  }\n  const newGlyphLine: GlyphLine = {\n    value: glyphLine.value.slice(),\n  };\n\n  newGlyphLine.value[0] = newType;\n\n  if (!headShapeTypes[newType].includes(newGlyphLine.value[1])) {\n    newGlyphLine.value[1] = headShapeTypes[newType][0];\n  }\n  if (!tailShapeTypes[newType].includes(newGlyphLine.value[2])) {\n    newGlyphLine.value[2] = tailShapeTypes[newType][0];\n  }\n\n  const oldNumPoints = (getNumColumns(oldType) - 3) / 2;\n  const newNumPoints = (getNumColumns(newType) - 3) / 2;\n  if (oldNumPoints === newNumPoints) {\n    return newGlyphLine;\n  }\n  if (oldNumPoints === 2 && newNumPoints === 3) {\n    const x1 = newGlyphLine.value[3];\n    const y1 = newGlyphLine.value[4];\n    const x3 = newGlyphLine.value[5];\n    const y3 = newGlyphLine.value[6];\n\n    const x2 = Math.round((x1 + x3) / 2);\n    const y2 = Math.round((y1 + y3) / 2);\n    newGlyphLine.value = newGlyphLine.value.slice(0, 3).concat(\n      [x1, y1, x2, y2, x3, y3]\n    );\n    return newGlyphLine;\n  }\n  if (oldNumPoints === 2 && newNumPoints === 4) {\n    const x1 = newGlyphLine.value[3];\n    const y1 = newGlyphLine.value[4];\n    const x4 = newGlyphLine.value[5];\n    const y4 = newGlyphLine.value[6];\n\n    const x2 = Math.round((2 * x1 + x4) / 3);\n    const y2 = Math.round((2 * y1 + y4) / 3);\n    const x3 = Math.round((x1 + 2 * x4) / 3);\n    const y3 = Math.round((y1 + 2 * y4) / 3);\n    newGlyphLine.value = newGlyphLine.value.slice(0, 3).concat(\n      [x1, y1, x2, y2, x3, y3, x4, y4]\n    );\n    return newGlyphLine;\n  }\n  if (oldNumPoints === 3 && newNumPoints === 2) {\n    const x1 = newGlyphLine.value[3];\n    const y1 = newGlyphLine.value[4];\n    const x2 = newGlyphLine.value[7];\n    const y2 = newGlyphLine.value[8];\n    newGlyphLine.value = newGlyphLine.value.slice(0, 3).concat(\n      [x1, y1, x2, y2]\n    );\n    return newGlyphLine;\n  }\n  if (oldNumPoints === 3 && newNumPoints === 4) {\n    const x1 = newGlyphLine.value[3];\n    const y1 = newGlyphLine.value[4];\n    const xm = newGlyphLine.value[5];\n    const ym = newGlyphLine.value[6];\n    const x4 = newGlyphLine.value[7];\n    const y4 = newGlyphLine.value[8];\n\n    const x2 = Math.round((x1 + 2 * xm) / 3);\n    const y2 = Math.round((y1 + 2 * ym) / 3);\n    const x3 = Math.round((x4 + 2 * xm) / 3);\n    const y3 = Math.round((y4 + 2 * ym) / 3);\n    newGlyphLine.value = newGlyphLine.value.slice(0, 3).concat(\n      [x1, y1, x2, y2, x3, y3, x4, y4]\n    );\n    return newGlyphLine;\n  }\n  if (oldNumPoints === 4 && newNumPoints === 2) {\n    const x1 = newGlyphLine.value[3];\n    const y1 = newGlyphLine.value[4];\n    const x2 = newGlyphLine.value[9];\n    const y2 = newGlyphLine.value[10];\n    newGlyphLine.value = newGlyphLine.value.slice(0, 3).concat(\n      [x1, y1, x2, y2]\n    );\n    return newGlyphLine;\n  }\n  if (oldNumPoints === 4 && newNumPoints === 3) {\n    const x1 = newGlyphLine.value[3];\n    const y1 = newGlyphLine.value[4];\n    const xm1 = newGlyphLine.value[5];\n    const ym1 = newGlyphLine.value[6];\n    const xm2 = newGlyphLine.value[7];\n    const ym2 = newGlyphLine.value[8];\n    const x3 = newGlyphLine.value[9];\n    const y3 = newGlyphLine.value[10];\n\n    const x2 = Math.round((xm1 + xm2) / 2);\n    const y2 = Math.round((ym1 + ym2) / 2);\n    newGlyphLine.value = newGlyphLine.value.slice(0, 3).concat(\n      [x1, y1, x2, y2, x3, y3]\n    );\n    return newGlyphLine;\n  }\n  return newGlyphLine;\n};\n\nconst validStrokeShapeTypes: [number, number, number][] = [\n  [1, 0, 0],\n  [1, 0, 2],\n  [1, 0, 32],\n  [1, 0, 13],\n  [1, 0, 23],\n  [1, 0, 4],\n  [1, 0, 313],\n  [1, 0, 413],\n  [1, 0, 24],\n  [1, 2, 0],\n  [1, 2, 2],\n  [1, 32, 0],\n  [1, 32, 32],\n  [1, 32, 13],\n  [1, 32, 23],\n  [1, 32, 4],\n  [1, 32, 313],\n  [1, 32, 413],\n  [1, 32, 24],\n  [1, 12, 0],\n  [1, 12, 32],\n  [1, 12, 13],\n  [1, 12, 23],\n  [1, 12, 313],\n  [1, 12, 413],\n  [1, 12, 24],\n  [1, 22, 0],\n  [1, 22, 32],\n  [1, 22, 13],\n  [1, 22, 23],\n  [1, 22, 4],\n  [1, 22, 313],\n  [1, 22, 413],\n  [1, 22, 24],\n  [2, 0, 7],\n  [2, 0, 5],\n  [2, 32, 7],\n  [2, 32, 4],\n  [2, 32, 5],\n  [2, 12, 7],\n  [2, 22, 7],\n  [2, 22, 4],\n  [2, 22, 5],\n  [2, 7, 0],\n  [2, 7, 8],\n  [2, 7, 4],\n  [2, 27, 0],\n  [3, 0, 0],\n  [3, 0, 5],\n  [3, 32, 0],\n  [3, 32, 5],\n  [3, 12, 0],\n  [3, 12, 5],\n  [3, 22, 0],\n  [3, 22, 5],\n  [4, 0, 0],\n  [4, 0, 5],\n  [4, 22, 0],\n  [4, 22, 5],\n  [6, 0, 7],\n  [6, 0, 5],\n  [6, 32, 7],\n  [6, 32, 4],\n  [6, 32, 5],\n  [6, 12, 7],\n  [6, 22, 7],\n  [6, 22, 4],\n  [6, 22, 5],\n  [6, 7, 0],\n  [6, 7, 8],\n  [6, 7, 4],\n  [6, 27, 0],\n  [7, 0, 7],\n  [7, 32, 7],\n  [7, 12, 7],\n  [7, 22, 7],\n];\n\nexport const isValidStrokeShapeTypes = memoizeOne((stroke: GlyphLine) => {\n  if (!strokeTypes.includes(stroke.value[0])) {\n    return true;\n  }\n\n  if (!validStrokeShapeTypes.some(([s0, s1, s2]) => (\n    s0 === stroke.value[0] &&\n    s1 === stroke.value[1] &&\n    s2 === stroke.value[2]\n  ))) {\n    return false;\n  }\n\n  if (stroke.value[0] === 1) {\n    const [, s1, s2, x1, y1, x2, y2] = stroke.value;\n    const isVertical = y1 === y2 ? x1 === x2 : x2 - x1 <= Math.abs(y1 - y2);\n\n    if (isVertical\n      ? (s1 === 2 || s2 === 2)\n      : !([0, 2].includes(s1) && [0, 2].includes(s2))\n    ) {\n      return false;\n    }\n  }\n\n  return true;\n});\n","import { Glyph, PointDescriptor, getNumColumns } from './glyph';\n\nexport enum MatchType {\n  none,\n  online,\n  match,\n}\n\nexport const getMatchType = (glyph: Glyph, point: PointDescriptor): MatchType => {\n  const glyphLine = glyph[point.lineIndex];\n\n  const endPointIndex = (getNumColumns(glyphLine.value[0]) - 3) / 2 - 1;\n  if (point.pointIndex !== 0 && point.pointIndex !== endPointIndex) {\n    return MatchType.none;\n  }\n\n  const x = glyphLine.value[3 + point.pointIndex * 2];\n  const y = glyphLine.value[3 + point.pointIndex * 2 + 1];\n  const isOnline = (x1: number, y1: number, x2: number, y2: number): boolean => (\n    (\n      x1 === x2 && // \n      x1 === x && y1 <= y && y <= y2\n    ) || (\n      y1 === y2 && // \n      y1 === y && x1 <= x && x <= x2\n    )\n  );\n\n  let result = MatchType.none;\n  for (let lineIndex = 0; lineIndex < glyph.length; lineIndex++) {\n    if (point.lineIndex === lineIndex) {\n      continue;\n    }\n    const glyphLine = glyph[lineIndex];\n    if ([0, 9, 99].includes(glyphLine.value[0])) {\n      continue;\n    }\n\n    if (glyphLine.value[3] === x && glyphLine.value[4] === y) {\n      return MatchType.match;\n    }\n    const endPointIndex = (getNumColumns(glyphLine.value[0]) - 3) / 2 - 1;\n    if (\n      glyphLine.value[3 + endPointIndex * 2] === x &&\n      glyphLine.value[3 + endPointIndex * 2 + 1] === y\n    ) {\n      return MatchType.match;\n    }\n\n    switch (glyphLine.value[0]) {\n      case 3:\n      case 4:\n        if (\n          isOnline(glyphLine.value[3], glyphLine.value[4], glyphLine.value[5], glyphLine.value[6]) ||\n          isOnline(glyphLine.value[5], glyphLine.value[6], glyphLine.value[7], glyphLine.value[8])\n        ) {\n          result = MatchType.online;\n        }\n        break;\n      case 1:\n      case 7:\n        if (isOnline(glyphLine.value[3], glyphLine.value[4], glyphLine.value[5], glyphLine.value[6])) {\n          result = MatchType.online;\n        }\n        break;\n    }\n  }\n  return result;\n};\n","import { ReducerBuilder } from 'typescript-fsa-reducers';\n\nimport { editorActions } from '../actions/editor';\n\nimport { Glyph, GlyphLine } from '../kageUtils/glyph';\nimport { getGlyphLinesBBX } from '../kageUtils/bbx';\nimport { decompose } from '../kageUtils/decompose';\nimport { calcStretchPositions, setStretchPositions } from '../kageUtils/stretchparam';\nimport { changeStrokeType } from '../kageUtils/stroketype';\nimport { reflectRotateTypeParamsMap } from '../kageUtils/reflectrotate';\nimport { applyGlyphLineOperation, moveSelectedGlyphLines } from '../kageUtils/transform';\n\nimport { AppState } from '.';\n\nconst setGlyphLine = (glyph: Glyph, index: number, glyphLine: GlyphLine): Glyph => {\n  const newGlyph = glyph.slice();\n  newGlyph[index] = glyphLine;\n  return newGlyph;\n};\n\nconst updateBuilder = (builder: ReducerBuilder<AppState>) => builder\n  .case(editorActions.loadedBuhin, (state, [name, data]) => {\n    const newMap = new Map(state.buhinMap);\n    newMap.set(name, data);\n    return {\n      ...state,\n      buhinMap: newMap,\n    };\n  })\n  .case(editorActions.loadedStretchParam, (state, [name, param]) => {\n    const newMap = new Map(state.stretchParamMap);\n    newMap.set(name, param);\n    return {\n      ...state,\n      stretchParamMap: newMap,\n    };\n  })\n\n  .case(editorActions.changeStrokeType, (state, newType) => {\n    if (state.selection.length !== 1) {\n      return state;\n    }\n    const lineIndex = state.selection[0];\n    const newGLine = changeStrokeType(state.glyph[lineIndex], newType);\n    return {\n      ...state,\n      glyph: setGlyphLine(state.glyph, lineIndex, newGLine),\n    };\n  })\n  .case(editorActions.changeHeadShapeType, (state, newType) => {\n    if (state.selection.length !== 1) {\n      return state;\n    }\n    const lineIndex = state.selection[0];\n    const newGLine: GlyphLine = {\n      ...state.glyph[lineIndex],\n      value: state.glyph[lineIndex].value.slice(),\n    };\n    newGLine.value[1] = newType;\n    return {\n      ...state,\n      glyph: setGlyphLine(state.glyph, lineIndex, newGLine),\n    };\n  })\n  .case(editorActions.changeTailShapeType, (state, newType) => {\n    if (state.selection.length !== 1) {\n      return state;\n    }\n    const lineIndex = state.selection[0];\n    const newGLine: GlyphLine = {\n      ...state.glyph[lineIndex],\n      value: state.glyph[lineIndex].value.slice(),\n    };\n    newGLine.value[2] = newType;\n    return {\n      ...state,\n      glyph: setGlyphLine(state.glyph, lineIndex, newGLine),\n    };\n  })\n  .case(editorActions.changeStretchCoeff, (state, value) => {\n    if (state.selection.length !== 1) {\n      return state;\n    }\n    const lineIndex = state.selection[0];\n    const selectedLine = state.glyph[lineIndex];\n    if (!selectedLine.partName) {\n      return state;\n    }\n    const stretchParam = state.stretchParamMap.get(selectedLine.partName);\n    if (!stretchParam) {\n      return state;\n    }\n    const newGLine = setStretchPositions(\n      state.glyph[lineIndex],\n      calcStretchPositions(stretchParam, value)\n    );\n    return {\n      ...state,\n      glyph: setGlyphLine(state.glyph, lineIndex, newGLine),\n    };\n  })\n  .case(editorActions.changeReflectRotateOpType, (state, opType) => {\n    if (state.selection.length !== 1) {\n      return state;\n    }\n    const lineIndex = state.selection[0];\n    const newGLine: GlyphLine = {\n      ...state.glyph[lineIndex],\n      value: state.glyph[lineIndex].value.slice(),\n    };\n    const params = reflectRotateTypeParamsMap[opType]\n    if (!params) {\n      return state;\n    }\n    newGLine.value[1] = params[0];\n    newGLine.value[2] = params[1];\n    return {\n      ...state,\n      glyph: setGlyphLine(state.glyph, lineIndex, newGLine),\n    };\n  })\n\n  .case(editorActions.swapWithPrev, (state) => {\n    if (state.selection.length !== 1) {\n      return state;\n    }\n    const lineIndex = state.selection[0];\n    if (lineIndex === 0) {\n      return state;\n    }\n    const newGlyph = state.glyph.slice();\n    newGlyph[lineIndex - 1] = state.glyph[lineIndex];\n    newGlyph[lineIndex] = state.glyph[lineIndex - 1];\n    return {\n      ...state,\n      glyph: newGlyph,\n      selection: [lineIndex - 1],\n    };\n  })\n  .case(editorActions.swapWithNext, (state) => {\n    if (state.selection.length !== 1) {\n      return state;\n    }\n    const lineIndex = state.selection[0];\n    if (lineIndex === state.glyph.length - 1) {\n      return state;\n    }\n    const newGlyph = state.glyph.slice();\n    newGlyph[lineIndex + 1] = state.glyph[lineIndex];\n    newGlyph[lineIndex] = state.glyph[lineIndex + 1];\n    return {\n      ...state,\n      glyph: newGlyph,\n      selection: [lineIndex + 1],\n    };\n  })\n\n  .case(editorActions.insertPart, (state, partName) => ({\n    ...state,\n    glyph: state.glyph.concat([{\n      value: [99, 0, 0, 0, 0, 200, 200, 0, 0, 0, 0],\n      partName,\n    }]),\n    selection: [state.glyph.length],\n  }))\n\n  .case(editorActions.paste, (state) => ({\n    ...state,\n    glyph: state.glyph.concat(state.clipboard),\n    selection: state.clipboard.map((_gLine, index) => state.glyph.length + index),\n  }))\n  .case(editorActions.copy, (state) => {\n    const targetLines = state.selection.map((index) => state.glyph[index]);\n    const [x1, y1] = getGlyphLinesBBX(targetLines);\n    const tX = (x: number) => 230 + x - x1;\n    const tY = (y: number) => 20 + y - y1;\n    return {\n      ...state,\n      clipboard: state.selection.map((index) => (\n        applyGlyphLineOperation(state.glyph[index], tX, tY)\n      )),\n    };\n  })\n  .case(editorActions.cut, (state) => ({\n    ...state,\n    glyph: state.glyph.filter((_gLine, index) => !state.selection.includes(index)),\n    clipboard: state.selection.map((index) => state.glyph[index]),\n    selection: [],\n  }))\n  .case(editorActions.delete, (state) => ({\n    ...state,\n    glyph: state.glyph.filter((_gLine, index) => !state.selection.includes(index)),\n    selection: [],\n  }))\n\n  .case(editorActions.decomposeSelected, (state) => {\n    let newGlyph: Glyph = [];\n    let newSelection: number[] = [];\n    state.glyph.forEach((gLine, index) => {\n      if (!state.selection.includes(index)) {\n        newGlyph.push(gLine);\n        return;\n      }\n      const newLines = decompose(gLine, state.buhinMap);\n      newSelection = newSelection.concat(\n        newLines.map((_gLine, subindex) => newGlyph.length + subindex)\n      );\n      newGlyph = newGlyph.concat(newLines);\n    });\n    return {\n      ...state,\n      glyph: newGlyph,\n      selection: newSelection,\n    };\n  })\n  .case(editorActions.moveSelected, (state, [dx, dy]) => ({\n    ...state,\n    glyph: moveSelectedGlyphLines(state.glyph, state.selection, dx, dy),\n  }))\n\n  .case(editorActions.toggleFreehand, (state) => ({\n    ...state,\n    selection: state.freehandMode ? state.selection : [],\n    freehandMode: !state.freehandMode,\n  }))\n\n  .case(editorActions.escape, (state) => {\n    if (state.showOptionModal) {\n      return {\n        ...state,\n        showOptionModal: false,\n      }\n    }\n    if (state.freehandMode) {\n      return {\n        ...state,\n        freehandMode: false,\n      };\n    }\n    if (state.selection.length) {\n      return {\n        ...state,\n        selection: [],\n      };\n    }\n    return state;\n  })\n\n  .case(editorActions.finishEdit, (state, evt) => ({\n    ...state,\n    exitEvent: evt,\n  }));\n\n\nexport default updateBuilder;\n","import actionCreatorFactory from 'typescript-fsa';\n\nimport { KShotai } from '../kage';\nimport { XorMaskType } from '../xorMask';\n\nconst actionCreator = actionCreatorFactory('DISPLAY');\n\nexport const displayActions = {\n  openOptionModal: actionCreator('OPEN_OPTION_MODAL'),\n  closeOptionModal: actionCreator('CLOSE_OPTION_MODAL'),\n\n  setGridDisplay: actionCreator<boolean>('SET_GRID_DISPLAY'),\n  setGridOriginX: actionCreator<number>('SET_GRID_ORIGIN_X'),\n  setGridOriginY: actionCreator<number>('SET_GRID_ORIGIN_Y'),\n  setGridSpacingX: actionCreator<number>('SET_GRID_SPACING_X'),\n  setGridSpacingY: actionCreator<number>('SET_GRID_SPACING_Y'),\n\n  setShotai: actionCreator<KShotai>('SET_SHOTAI'),\n  setStrokeCenterLineDisplay: actionCreator<boolean>('SET_STROKE_CENTER_LINE_DISPLAY'),\n\n  setXorMaskType: actionCreator<XorMaskType>('SET_XOR_MASK_TYPE'),\n};\n","import { ReducerBuilder } from 'typescript-fsa-reducers';\n\nimport { displayActions } from '../actions/display';\n\nimport { AppState } from '.';\n\nexport interface GridState {\n  display: boolean;\n  originX: number;\n  originY: number;\n  spacingX: number;\n  spacingY: number;\n}\n\nconst updateBuilder = (builder: ReducerBuilder<AppState>) => builder\n  .case(displayActions.openOptionModal, (state) => ({\n    ...state,\n    showOptionModal: true,\n  }))\n  .case(displayActions.closeOptionModal, (state) => ({\n    ...state,\n    showOptionModal: false,\n  }))\n\n  .case(displayActions.setGridDisplay, (state, value) => ({\n    ...state,\n    grid: {\n      ...state.grid,\n      display: value,\n    },\n  }))\n  .case(displayActions.setGridOriginX, (state, value) => ({\n    ...state,\n    grid: {\n      ...state.grid,\n      originX: value,\n    },\n  }))\n  .case(displayActions.setGridOriginY, (state, value) => ({\n    ...state,\n    grid: {\n      ...state.grid,\n      originY: value,\n    },\n  }))\n  .case(displayActions.setGridSpacingX, (state, value) => ({\n    ...state,\n    grid: {\n      ...state.grid,\n      spacingX: Math.max(2, value),\n    },\n  }))\n  .case(displayActions.setGridSpacingY, (state, value) => ({\n    ...state,\n    grid: {\n      ...state.grid,\n      spacingY: Math.max(2, value),\n    },\n  }))\n\n  .case(displayActions.setStrokeCenterLineDisplay, (state, value) => ({\n    ...state,\n    showStrokeCenterLine: value,\n  }))\n  .case(displayActions.setShotai, (state, shotai) => ({\n    ...state,\n    shotai,\n  }))\n  \n  .case(displayActions.setXorMaskType, (state, xorMaskType) => ({\n    ...state,\n    xorMaskType,\n  }));\n\n\nexport default updateBuilder;\n","import actionCreatorFactory from 'typescript-fsa';\n\nconst actionCreator = actionCreatorFactory('UNDO');\n\nexport const undoActions = {\n  undo: actionCreator('UNDO'),\n  redo: actionCreator('REDO'),\n};\n","import { reducerWithInitialState } from 'typescript-fsa-reducers';\n\nimport { RectPointPosition, CTMInv } from '../actions/drag';\n\nimport { GlyphLine, Glyph, parseGlyph } from '../kageUtils/glyph';\nimport { StretchParam } from '../kageUtils/stretchparam';\nimport args from '../args';\nimport { KShotai } from '../kage';\n\nimport select from './select';\nimport drag from './drag';\nimport editor from './editor';\nimport display, { GridState } from './display';\n\nimport { undoable } from './undo';\nimport { XorMaskType } from '../xorMask';\n\nexport interface AppState {\n  glyph: Glyph;\n  selection: number[];\n\n  areaSelectRect: [number, number, number, number] | null;\n  dragSelection: [number, number, number, number] | null;\n  dragPoint: [number, [number, number, number, number]] | null;\n  resizeSelection: [RectPointPosition, [number, number, number, number]] | null;\n  freehandStroke: [number, number][] | null;\n  ctmInv: CTMInv | null;\n  freehandMode: boolean;\n\n  buhinMap: Map<string, string>;\n  stretchParamMap: Map<string, StretchParam>;\n  clipboard: GlyphLine[];\n  undoStacks: {\n    undo: Glyph[];\n    redo: Glyph[];\n  };\n  exitEvent: Event | null;\n\n  showOptionModal: boolean;\n  grid: GridState;\n  showStrokeCenterLine: boolean;\n  shotai: KShotai;\n  xorMaskType: XorMaskType;\n}\n\nconst initialState: AppState = {\n  glyph: parseGlyph(args.data),\n  selection: [],\n\n  areaSelectRect: null,\n  dragSelection: null,\n  dragPoint: null,\n  resizeSelection: null,\n  freehandStroke: null,\n  ctmInv: null,\n  freehandMode: false,\n\n  buhinMap: new Map<string, string>(),\n  stretchParamMap: new Map<string, StretchParam>(),\n  clipboard: [],\n  undoStacks: { undo: [], redo: [] },\n  exitEvent: null,\n\n  showOptionModal: false,\n  grid: {\n    display: true,\n    originX: 0,\n    originY: 0,\n    spacingX: 20,\n    spacingY: 20,\n  },\n  showStrokeCenterLine: false,\n  shotai: 0, // kMincho\n  xorMaskType: \"none\",\n};\n\nconst reducer = undoable(\n  reducerWithInitialState(initialState)\n    .withHandling(select)\n    .withHandling(drag)\n    .withHandling(editor)\n    .withHandling(display)\n);\n\nexport default reducer;\n","import { Reducer } from 'redux';\nimport { reducerWithInitialState } from 'typescript-fsa-reducers';\n\nimport { isGlyphDeepEqual } from '../kageUtils/glyph';\n\nimport { undoActions } from '../actions/undo';\n\nimport { AppState } from '.';\n\nconst UNDO_MAX_TIMES = 30;\n\nconst pushUndo = (oldState: AppState, newState: AppState): AppState => {\n  if (isGlyphDeepEqual(oldState.glyph, newState.glyph)) {\n    return newState;\n  }\n  return {\n    ...newState,\n    undoStacks: {\n      undo: oldState.undoStacks.undo.concat([oldState.glyph]).slice(-UNDO_MAX_TIMES),\n      redo: [],\n    },\n  };\n};\n\nexport const undoable = (reducer: Reducer<AppState>): Reducer<AppState> => {\n  const initialState = reducer(undefined, { type: '_INIT' });\n  return reducerWithInitialState(initialState)\n    .case(undoActions.undo, (state) => {\n      if (state.undoStacks.undo.length === 0) {\n        return state;\n      }\n      return {\n        ...state,\n        glyph: state.undoStacks.undo[state.undoStacks.undo.length - 1],\n        selection: [], // TODO: select changed lines?\n        undoStacks: {\n          undo: state.undoStacks.undo.slice(0, -1),\n          redo: state.undoStacks.redo.concat([state.glyph]),\n        },\n      };\n    })\n    .case(undoActions.redo, (state) => {\n      if (state.undoStacks.redo.length === 0) {\n        return state;\n      }\n      return {\n        ...state,\n        glyph: state.undoStacks.redo[state.undoStacks.redo.length - 1],\n        selection: [], // TODO: select changed lines?\n        undoStacks: {\n          undo: state.undoStacks.undo.concat([state.glyph]),\n          redo: state.undoStacks.redo.slice(0, -1),\n        },\n      };\n    })\n    .default((oldState, action) => {\n      const newState = reducer(oldState, action);\n      if (!oldState) {\n        return newState;\n      }\n      return pushUndo(oldState, newState);\n    });\n};\n","import { createStore } from 'redux';\n\nimport reducer from './reducers';\n\nconst store = createStore(reducer);\n\nexport default store;\n","export const xorMaskShapeMap = {\n  none: \"\",\n  circle: \"M 123.2 13.4 137.9 18.8 151.5 26.6 163.5 36.7 173.5 48.7 181.3 62.2 186.7 76.9 189.4 92.4 189.4 108 186.7 123.4 181.3 138.1 173.5 151.7 163.5 163.7 151.5 173.7 137.9 181.6 123.2 186.9 107.8 189.6 92.1 189.6 76.7 186.9 62 181.6 48.4 173.7 36.4 163.7 26.4 151.7 18.6 138.1 13.2 123.4 10.5 108 10.5 92.4 13.2 76.9 18.6 62.2 26.4 48.7 36.4 36.7 48.4 26.6 62 18.8 76.7 13.4 92.1 10.7 107.8 10.7 Z\",\n  squareWithRoundedCorners: \"M 176.9 15.1 178.8 15.7 180.5 16.6 182 17.9 183.3 19.4 184.2 21.1 184.8 23 185 25 185 175 184.8 176.9 184.2 178.8 183.3 180.5 182 182 180.5 183.3 178.8 184.2 176.9 184.8 175 185 25 185 23 184.8 21.1 184.2 19.4 183.3 17.9 182 16.6 180.5 15.7 178.8 15.1 176.9 15 175 15 25 15.1 23 15.7 21.1 16.6 19.4 17.9 17.9 19.4 16.6 21.1 15.7 23 15.1 25 15 175 15 Z\",\n  square: \"M 185 185 15 185 15 15 185 15 Z\",\n  diamond: \"M 190 100 100 190 10 100 100 10 Z\"\n}\n\nexport type XorMaskType = keyof typeof xorMaskShapeMap;\nexport const xorMaskTypes = Object.keys(xorMaskShapeMap) as XorMaskType[];\n","import * as React from \"react\";\nimport { xorMaskTypes, xorMaskShapeMap } from \"../xorMask\";\n\nconst XorMasks = () => <>\n  {xorMaskTypes.map((maskType) => (\n    <path key={maskType} id={`xormask_${maskType}`} d={xorMaskShapeMap[maskType]} />\n  ))}\n</>\n\nexport default XorMasks;\n","import React from 'react';\nimport { useSelector } from 'react-redux';\n\nimport { AppState } from '../reducers';\n\nimport './Grid.css';\n\nconst Grid = () => {\n  const grid = useSelector((state: AppState) => state.grid);\n  if (!grid.display) {\n    return <></>;\n  }\n  const xs = [];\n  for (let x = grid.originX; x < 200; x += grid.spacingX) {\n    xs.push(x);\n  }\n  const ys = [];\n  for (let y = grid.originY; y < 200; y += grid.spacingY) {\n    ys.push(y);\n  }\n  return (\n    <g className=\"grid-lines\">\n      {xs.map((x) => (\n        <path\n          key={x}\n          d={`M ${x} 0 V 200`}\n        />\n      ))}\n      {ys.map((y) => (\n        <path\n          key={y}\n          d={`M 0 ${y} H 200`}\n        />\n      ))}\n    </g>\n  );\n};\n\nexport default Grid;","import React from 'react';\n\nimport { Polygons } from '@ge9/kage-engine-2';\n\nexport interface StrokeComponentProps {\n  polygons: Polygons;\n}\n\nconst StrokeComponent = (props: StrokeComponentProps) => (\n  <>\n    {props.polygons.array.map((polygon, i) => (\n      <path key={i} d={polygon.get_sub_path_svg()} />\n    ))}\n  </>\n);\n\nexport default StrokeComponent;\n","import React from 'react';\n\nimport { Glyph } from '../kageUtils/glyph';\nimport { makeGlyphSeparated, KShotai } from '../kage';\nimport { XorMaskType } from '../xorMask';\n\nimport Stroke from './Stroke';\n\nimport './Glyph.css'\n\nexport interface GlyphComponentProps {\n  glyph: Glyph;\n  buhinMap: Map<string, string>;\n  selection: number[];\n  shotai: KShotai;\n  xorMaskType: XorMaskType;\n  handleMouseDownDeselectedStroke?: (evt: React.MouseEvent, index: number) => void;\n  handleMouseDownSelectedStroke?: (evt: React.MouseEvent, index: number) => void;\n  makeGlyphSeparated?: typeof makeGlyphSeparated;\n}\n\nconst GlyphComponent = (props: GlyphComponentProps) => {\n  const polygonsSep = (props.makeGlyphSeparated || makeGlyphSeparated)(props.glyph, props.buhinMap, props.shotai);\n\n  const { selection } = props;\n  const nonSelection = polygonsSep.map((_polygons, index) => index)\n    .filter((index) => !selection.includes(index));\n\n  return (\n    <>\n      <g className=\"strokes-deselected\">\n        {nonSelection.map((index) => (\n          <g key={index} onMouseDown={(evt) => props.handleMouseDownDeselectedStroke?.(evt, index)}>\n            <Stroke polygons={polygonsSep[index]} />\n          </g>\n        ))}\n      </g>\n      {props.xorMaskType !== \"none\" && <>\n        <use xlinkHref={`#xormask_${props.xorMaskType}`} className=\"xormask-fill\" />\n        <clipPath id=\"xorMaskClip\">\n          <use xlinkHref={`#xormask_${props.xorMaskType}`} />\n        </clipPath>\n        <g clipPath=\"url(#xorMaskClip)\" className=\"strokes-invert\">\n          {nonSelection.map((index) => (\n            <g key={index}>\n              <Stroke polygons={polygonsSep[index]} />\n            </g>\n          ))}\n        </g>\n      </>}\n      <g className=\"strokes-selected\">\n        {selection.map((index) => (\n          <g key={index} onMouseDown={(evt) => props.handleMouseDownSelectedStroke?.(evt, index)}>\n            <Stroke polygons={polygonsSep[index]} />\n          </g>\n        ))}\n      </g>\n    </>\n  );\n};\n\nexport default GlyphComponent;\n","import React from 'react';\n\nimport { decomposeDeepGlyph } from '../kageUtils/decompose';\nimport { Glyph } from '../kageUtils/glyph';\n\nimport './StrokeCenterLine.css';\n\nexport interface StrokeCenterLineProps {\n  glyph: Glyph;\n  buhinMap: Map<string, string>;\n}\n\nconst StrokeCenterLine = (props: StrokeCenterLineProps) => {\n  const strokes = decomposeDeepGlyph(props.glyph, props.buhinMap);\n  return (\n    <g className=\"stroke-center-line\">\n      {strokes.map((stroke, index) => {\n        const v = stroke.value;\n        switch (v[0]) {\n          case 1:\n            return <path key={index} d={`M ${v[3]} ${v[4]} ${v[5]} ${v[6]}`} />\n          case 2:\n            return <path key={index} d={`M ${v[3]} ${v[4]} Q ${v[5]} ${v[6]} ${v[7]} ${v[8]}`} />\n          case 3:\n          case 4:\n            return <path key={index} d={`M ${v[3]} ${v[4]} ${v[5]} ${v[6]} ${v[7]} ${v[8]}`} />\n          case 6:\n            return <path key={index} d={`M ${v[3]} ${v[4]} C ${v[5]} ${v[6]} ${v[7]} ${v[8]} ${v[9]} ${v[10]}`} />\n          case 7:\n            return <path key={index} d={`M ${v[3]} ${v[4]} ${v[5]} ${v[6]} Q ${v[7]} ${v[8]} ${v[9]} ${v[10]}`} />\n          default:\n            return null;\n        }\n      })}\n    </g>\n  )\n}\n\nexport default StrokeCenterLine;\n","import React from 'react';\n\nimport './ControlPoint.css';\n\ninterface ControlPointProps {\n  x: number;\n  y: number;\n  className?: string;\n  handleMouseDown: (evt: React.MouseEvent) => void;\n}\n\nconst ControlPoint = (props: ControlPointProps) => (\n  <rect\n    x={props.x - 4}\n    y={props.y - 4}\n    width={8} height={8}\n    className={`controlpoint-rect ${props.className || ''}`}\n    onMouseDown={props.handleMouseDown}\n  />\n);\n\nexport default ControlPoint;\n","import React, { useCallback, useMemo } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\n\nimport { createSelector } from 'reselect';\n\nimport { dragActions, RectPointPosition } from '../actions/drag';\nimport { AppState } from '../reducers';\nimport { draggedGlyphSelector } from '../selectors/draggedGlyph';\nimport { getGlyphLinesBBX } from '../kageUtils/bbx';\nimport { getMatchType, MatchType } from '../kageUtils/match';\n\nimport ControlPoint from './ControlPoint';\n\nimport './SelectionControl.css';\n\ninterface RectControl {\n  multiSelect: boolean;\n  coords: [number, number, number, number];\n}\ninterface ControlPointSpec {\n  x: number;\n  y: number;\n  className: string;\n}\n\ninterface SelectionControlSpec {\n  rectControl: RectControl | null;\n  pointControl: ControlPointSpec[];\n}\n\nconst selectionControlSelector = createSelector(\n  [\n    draggedGlyphSelector,\n    (state: AppState) => state.selection,\n  ],\n  (glyph, selection): SelectionControlSpec => {\n    if (selection.length === 0) {\n      return { rectControl: null, pointControl: [] };\n    }\n    if (selection.length > 1) {\n      const selectedStrokes = selection.map((index) => glyph[index]);\n      const bbx = getGlyphLinesBBX(selectedStrokes);\n      return {\n        rectControl: {\n          multiSelect: true,\n          coords: bbx,\n        },\n        pointControl: [],\n      };\n    }\n    const selectedStroke = glyph[selection[0]];\n    switch (selectedStroke.value[0]) {\n      case 0:\n      case 9:\n      case 99:\n        return {\n          rectControl: {\n            multiSelect: false,\n            coords: [\n              selectedStroke.value[3],\n              selectedStroke.value[4],\n              selectedStroke.value[5],\n              selectedStroke.value[6],\n            ],\n          },\n          pointControl: [],\n        };\n      case 1:\n      case 2:\n      case 3:\n      case 4:\n      case 6:\n      case 7: {\n        const pointControl: ControlPointSpec[] = [];\n        for (let i = 3; i + 2 <= selectedStroke.value.length; i += 2) {\n          const matchType = getMatchType(glyph, {\n            lineIndex: selection[0],\n            pointIndex: (i - 3) / 2,\n          });\n          let className = '';\n          if (matchType === MatchType.match) {\n              className = 'match';\n          } else if (matchType === MatchType.online) {\n              className = 'online';\n          }\n\n          pointControl.push({\n            x: selectedStroke.value[i],\n            y: selectedStroke.value[i + 1],\n            className,\n          });\n        }\n        return { rectControl: null, pointControl };\n      }\n      default:\n        return { rectControl: null, pointControl: [] };\n    }\n  }\n);\n\nconst SelectionControl = () => {\n  const { rectControl, pointControl } = useSelector(selectionControlSelector);\n\n  const dispatch = useDispatch();\n  const handleMouseDownRectControl = useCallback((evt: React.MouseEvent, position: RectPointPosition) => {\n    dispatch(dragActions.startResize([evt, position]));\n    evt.stopPropagation();\n  }, [dispatch]);\n\n  const handleMouseDownNorthPoint = useCallback(\n    (evt: React.MouseEvent) => handleMouseDownRectControl(evt, RectPointPosition.north),\n    [handleMouseDownRectControl]\n  );\n  const handleMouseDownWestPoint = useCallback(\n    (evt: React.MouseEvent) => handleMouseDownRectControl(evt, RectPointPosition.west),\n    [handleMouseDownRectControl]\n  );\n  const handleMouseDownSouthPoint = useCallback(\n    (evt: React.MouseEvent) => handleMouseDownRectControl(evt, RectPointPosition.south),\n    [handleMouseDownRectControl]\n  );\n  const handleMouseDownEastPoint = useCallback(\n    (evt: React.MouseEvent) => handleMouseDownRectControl(evt, RectPointPosition.east),\n    [handleMouseDownRectControl]\n  );\n  const handleMouseDownSoutheastPoint = useCallback(\n    (evt: React.MouseEvent) => handleMouseDownRectControl(evt, RectPointPosition.southeast),\n    [handleMouseDownRectControl]\n  );\n\n  const handleMouseDownPointControls = useMemo(() => {\n    return pointControl.map((_control, pointIndex) => (evt: React.MouseEvent) => {\n      dispatch(dragActions.startPointDrag([evt, pointIndex]));\n      evt.stopPropagation();\n    });\n  }, [dispatch, pointControl]);\n\n  return <>\n    {rectControl && <>\n      <rect\n        className='selection-rect'\n        x={Math.min(rectControl.coords[0], rectControl.coords[2])}\n        y={Math.min(rectControl.coords[1], rectControl.coords[3])}\n        width={Math.abs(rectControl.coords[2] - rectControl.coords[0])}\n        height={Math.abs(rectControl.coords[3] - rectControl.coords[1])}\n      />\n      <ControlPoint\n        x={(rectControl.coords[0] + rectControl.coords[2]) / 2}\n        y={rectControl.coords[1]}\n        className='north'\n        handleMouseDown={handleMouseDownNorthPoint}\n      />\n      <ControlPoint\n        x={rectControl.coords[0]}\n        y={(rectControl.coords[1] + rectControl.coords[3]) / 2}\n        className='west'\n        handleMouseDown={handleMouseDownWestPoint}\n      />\n      <ControlPoint\n        x={(rectControl.coords[0] + rectControl.coords[2]) / 2}\n        y={rectControl.coords[3]}\n        className='south'\n        handleMouseDown={handleMouseDownSouthPoint}\n      />\n      <ControlPoint\n        x={rectControl.coords[2]}\n        y={(rectControl.coords[1] + rectControl.coords[3]) / 2}\n        className='east'\n        handleMouseDown={handleMouseDownEastPoint}\n      />\n      <ControlPoint\n        x={rectControl.coords[2]}\n        y={rectControl.coords[3]}\n        className='southeast'\n        handleMouseDown={handleMouseDownSoutheastPoint}\n      />\n    </>}\n    {pointControl.map(({ x, y, className }, index) => (\n      <ControlPoint\n        key={index}\n        x={x} y={y}\n        className={className}\n        handleMouseDown={handleMouseDownPointControls[index]}\n      />\n    ))}\n  </>;\n};\n\nexport default SelectionControl;","import React from 'react';\n\nimport './AreaSelectRect.css';\n\ninterface AreaSelectRectProps {\n  rect: [number, number, number, number] | null;\n}\n\nconst AreaSelectRect = (props: AreaSelectRectProps) => {\n  if (!props.rect) {\n    return null;\n  }\n  let [x1, y1, x2, y2] = props.rect;\n  if (x1 > x2) {\n    // swap\n    const temp = x1;\n    x1 = x2;\n    x2 = temp;\n  }\n  if (y1 > y2) {\n    // swap\n    const temp = y1;\n    y1 = y2;\n    y2 = temp;\n  }\n\n  return <rect className='areaselect-rect' x={x1} y={y1} width={x2 - x1} height={y2 - y1} />;\n};\n\nexport default AreaSelectRect;\n","import React, { useEffect, useCallback } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\n\nimport { AppState } from '../reducers';\n\nimport { selectActions } from '../actions/select';\nimport { dragActions, CTMInv } from '../actions/drag';\nimport { draggedGlyphSelector } from '../selectors/draggedGlyph';\n\nimport XorMasks from './XorMasks';\nimport Grid from './Grid';\nimport Glyph from './Glyph';\nimport StrokeCenterLine from './StrokeCenterLine';\nimport SelectionControl from './SelectionControl';\nimport AreaSelectRect from './AreaSelectRect';\n\nimport './GlyphArea.css';\n\nconst GlyphArea = () => {\n  const glyph = useSelector(draggedGlyphSelector);\n  const buhinMap = useSelector((state: AppState) => state.buhinMap);\n  const shotai = useSelector((state: AppState) => state.shotai);\n  const xorMaskType = useSelector((state: AppState) => state.xorMaskType);\n  const selection = useSelector((state: AppState) => state.selection);\n  const areaSelectRect = useSelector((state: AppState) => state.areaSelectRect);\n  const freehandMode = useSelector((state: AppState) => state.freehandMode);\n  const showStrokeCenterLine = useSelector((state: AppState) => state.showStrokeCenterLine);\n\n  const svgClassName = freehandMode ? 'freehand' : '';\n\n  const dispatch = useDispatch();\n  const handleMouseDownCapture = useCallback((evt: React.MouseEvent<SVGSVGElement>) => {\n    const ctm = evt.currentTarget.getScreenCTM();\n    if (!ctm) {\n      return;\n    }\n    const pt = evt.currentTarget.createSVGPoint();\n    const ictm = ctm.inverse();\n    const ctmInv: CTMInv = (evtx, evty) => {\n      pt.x = evtx;\n      pt.y = evty;\n      const { x, y } = pt.matrixTransform(ictm);\n      return [x, y];\n    };\n    dispatch(dragActions.updateCTMInv(ctmInv));\n  }, [dispatch]);\n\n  const handleMouseDownBackground = useCallback((evt: React.MouseEvent) => {\n    if (!(evt.shiftKey || evt.ctrlKey)) {\n      dispatch(selectActions.selectNone());\n    }\n    dispatch(dragActions.startBackgroundDrag(evt));\n    evt.preventDefault();\n  }, [dispatch]);\n  const handleMouseDownDeselectedStroke = useCallback((evt: React.MouseEvent, index: number) => {\n    if (evt.shiftKey || evt.ctrlKey) {\n      dispatch(selectActions.selectAddSingle(index));\n    } else {\n      dispatch(selectActions.selectSingle(index));\n    }\n    dispatch(dragActions.startSelectionDrag(evt));\n    evt.preventDefault();\n    evt.stopPropagation();\n  }, [dispatch]);\n  const handleMouseDownSelectedStroke = useCallback((evt: React.MouseEvent, index: number) => {\n    if (evt.shiftKey || evt.ctrlKey) {\n      dispatch(selectActions.selectRemoveSingle(index));\n    }\n    dispatch(dragActions.startSelectionDrag(evt));\n    evt.preventDefault();\n    evt.stopPropagation();\n  }, [dispatch]);\n\n  useEffect(() => {\n    const handleMouseMove = (evt: MouseEvent) => {\n      dispatch(dragActions.mouseMove(evt));\n    };\n    const handleMouseUp = (evt: MouseEvent) => {\n      dispatch(dragActions.mouseUp(evt));\n    };\n    document.addEventListener('mousemove', handleMouseMove)\n    document.addEventListener('mouseup', handleMouseUp);\n    return () => {\n      document.removeEventListener('mousemove', handleMouseMove);\n      document.removeEventListener('mouseup', handleMouseUp);\n    };\n  }, [dispatch]);\n\n  return (\n    <div className=\"glyph-area\">\n      <svg\n        width=\"100%\" height=\"100%\" viewBox=\"-20 -20 500 240\"\n        className={svgClassName}\n        onMouseDownCapture={handleMouseDownCapture}\n        onMouseDown={handleMouseDownBackground}\n      >\n        <defs>\n          <XorMasks />\n        </defs>\n        <Grid />\n        <rect x=\"0\" y=\"0\" width=\"200\" height=\"200\" className=\"glyph-boundary\" />\n        <rect x=\"12\" y=\"12\" width=\"176\" height=\"176\" className=\"glyph-guide\" />\n        <Glyph\n          glyph={glyph}\n          buhinMap={buhinMap}\n          shotai={shotai}\n          xorMaskType={xorMaskType}\n          selection={selection}\n          handleMouseDownDeselectedStroke={handleMouseDownDeselectedStroke}\n          handleMouseDownSelectedStroke={handleMouseDownSelectedStroke}\n        />\n        {showStrokeCenterLine && <StrokeCenterLine glyph={glyph} buhinMap={buhinMap} />}\n        <SelectionControl />\n        <AreaSelectRect rect={areaSelectRect} />\n      </svg>\n    </div>\n  );\n};\n\nexport default GlyphArea;\n","import React, { useCallback } from 'react';\n\nimport { useDispatch, useSelector, shallowEqual } from 'react-redux';\nimport { createSelector } from 'reselect';\nimport { useTranslation } from 'react-i18next';\n\nimport { editorActions } from '../actions/editor';\nimport { selectActions } from '../actions/select';\nimport { AppState } from '../reducers';\nimport { GlyphLine } from '../kageUtils/glyph';\nimport { calcStretchScalar, getStretchPositions } from '../kageUtils/stretchparam';\nimport { strokeTypes, headShapeTypes, tailShapeTypes, isValidStrokeShapeTypes } from '../kageUtils/stroketype';\nimport { ReflectRotateType, reflectRotateTypeParamsMap, reflectRotateTypes } from '../kageUtils/reflectrotate';\nimport { draggedGlyphSelector } from '../selectors/draggedGlyph';\n\nimport './SelectionInfo.css'\n\n\nconst selectedGlyphLineSelector = createSelector([\n  (state: AppState) => state.selection,\n  draggedGlyphSelector,\n], (selection, draggedGlyph): GlyphLine | null => {\n  if (selection.length !== 1) {\n    return null;\n  }\n  return draggedGlyph[selection[0]];\n});\n\ninterface StrokeInfo {\n  strokeType: number;\n  headShapeType: number;\n  tailShapeType: number;\n  validTypes: boolean;\n  coordString: string;\n}\nconst strokeInfoSelector = createSelector([\n  selectedGlyphLineSelector\n], (selectedStroke): StrokeInfo | null => {\n  if (!selectedStroke) {\n    return null;\n  }\n  if (!strokeTypes.includes(selectedStroke.value[0])) {\n    return null;\n  }\n\n  const points = [];\n  for (let i = 3; i + 2 <= selectedStroke.value.length; i += 2) {\n    points.push(`(${selectedStroke.value[i]},${selectedStroke.value[i + 1]})`);\n  }\n  return {\n    strokeType: selectedStroke.value[0],\n    headShapeType: selectedStroke.value[1],\n    tailShapeType: selectedStroke.value[2],\n    validTypes: isValidStrokeShapeTypes(selectedStroke),\n    coordString: points.join('  '),\n  };\n});\n\ninterface PartInfo {\n  partName: string;\n  entityName: string | null;\n  coordString: string;\n  stretchCoeff: number | null;\n}\nconst partInfoSelector = createSelector([\n  selectedGlyphLineSelector,\n  (state: AppState) => state.buhinMap,\n  (state: AppState) => state.stretchParamMap,\n], (selectedStroke, buhinMap, stretchParamMap): PartInfo | null => {\n  if (!selectedStroke) {\n    return null;\n  }\n  if (selectedStroke.value[0] !== 99) {\n    return null;\n  }\n  const partName = selectedStroke.partName!;\n  const buhinSource = buhinMap.get(partName);\n  let entityName: string | null = null;\n  if (buhinSource) {\n    const aliasMatch = /^(?:0:1:0:[^$]+\\$)?99:0:0:0:0:200:200:([^$]+)$/.exec(buhinSource);\n    if (aliasMatch) {\n      entityName = aliasMatch[1];\n    }\n  }\n  const stretchParam = stretchParamMap.get(partName);\n  const stretchCoeff = stretchParam\n    ? calcStretchScalar(stretchParam, getStretchPositions(selectedStroke)!)\n    : null;\n\n  return {\n    partName,\n    entityName,\n    coordString: `(${selectedStroke.value[3]},${selectedStroke.value[4]})  (${selectedStroke.value[5]},${selectedStroke.value[6]})`,\n    stretchCoeff,\n  };\n});\n\ninterface ReflectRotateInfo {\n  opType: ReflectRotateType | -1;\n  coordString: string;\n}\nconst reflectRotateInfoSelector = createSelector([\n  selectedGlyphLineSelector,\n], (selectedStroke): ReflectRotateInfo | null => {\n  if (!selectedStroke) {\n    return null;\n  }\n  if (selectedStroke.value[0] !== 0) {\n    return null;\n  }\n  const opType = reflectRotateTypes.find((type) => {\n    const [param1, param2] = reflectRotateTypeParamsMap[type];\n    return param1 === selectedStroke.value[1] && param2 === selectedStroke.value[2];\n  }) ?? -1;\n\n  return {\n    opType,\n    coordString: `(${selectedStroke.value[3]},${selectedStroke.value[4]})  (${selectedStroke.value[5]},${selectedStroke.value[6]})`,\n  };\n});\n\ninterface OtherInfo {\n  isMultiple: boolean;\n  coordString?: string;\n}\nconst otherInfoSelector = createSelector([\n  (state: AppState) => state.selection,\n  selectedGlyphLineSelector,\n], (selection, selectedStroke_): OtherInfo | null => {\n  if (selection.length > 1) {\n    return { isMultiple: true };\n  }\n  if (selection.length === 0) {\n    return { isMultiple: false };\n  }\n  const selectedStroke = selectedStroke_!;\n  const strokeType = selectedStroke.value[0];\n  if (strokeTypes.includes(strokeType) || strokeType === 99 || strokeType === 0) {\n    return null;\n  }\n\n  const points = [];\n  for (let i = 3; i + 2 <= selectedStroke.value.length; i += 2) {\n    points.push(`(${selectedStroke.value[i]},${selectedStroke.value[i + 1]})`);\n  }\n  return { isMultiple: false, coordString: points.join('  ') };\n});\n\nconst selectIndexStringSelector = createSelector([\n  (state: AppState) => state.glyph.length,\n  (state: AppState) => state.selection,\n], (glyphLength, selection) => {\n  const selectedIndexString = selection\n    .map((index) => index + 1)\n    .sort((a, b) => a - b).join(',');\n  return `${selectedIndexString || '-'} / ${glyphLength || '-'}`;\n});\n\nconst buttonsDisabledSelector = createSelector([\n  (state: AppState) => state.glyph.length,\n  (state: AppState) => state.selection,\n], (glyphLength, selection) => ({\n  swapPrevDisabled: selection.length !== 1 || selection[0] === 0,\n  swapNextDisabled: selection.length !== 1 || selection[0] === glyphLength - 1,\n  selectPrevDisabled: glyphLength === 0,\n  selectNextDisabled: glyphLength === 0,\n}));\n\nconst SelectionInfo = () => {\n\n  const strokeInfo = useSelector(strokeInfoSelector);\n  const partInfo = useSelector(partInfoSelector);\n  const reflectRotateInfo = useSelector(reflectRotateInfoSelector);\n  const otherInfo = useSelector(otherInfoSelector);\n\n  const selectIndexString = useSelector(selectIndexStringSelector);\n\n  const {\n    swapPrevDisabled, swapNextDisabled,\n    selectPrevDisabled, selectNextDisabled,\n  } = useSelector(buttonsDisabledSelector, shallowEqual);\n\n  const dispatch = useDispatch();\n  const changeStrokeType = useCallback((evt: React.ChangeEvent<HTMLSelectElement>) => {\n    dispatch(editorActions.changeStrokeType(+evt.currentTarget.value));\n  }, [dispatch]);\n  const changeHeadShapeType = useCallback((evt: React.ChangeEvent<HTMLSelectElement>) => {\n    dispatch(editorActions.changeHeadShapeType(+evt.currentTarget.value));\n  }, [dispatch]);\n  const changeTailShapeType = useCallback((evt: React.ChangeEvent<HTMLSelectElement>) => {\n    dispatch(editorActions.changeTailShapeType(+evt.currentTarget.value));\n  }, [dispatch]);\n  const changeStretchCoeff = useCallback((evt: React.ChangeEvent<HTMLInputElement>) => {\n    dispatch(editorActions.changeStretchCoeff(+evt.currentTarget.value));\n  }, [dispatch]);\n  const changeReflectRotateOpType = useCallback((evt: React.ChangeEvent<HTMLSelectElement>) => {\n    dispatch(editorActions.changeReflectRotateOpType(+evt.currentTarget.value))\n  }, [dispatch]);\n  const selectPrev = useCallback(() => {\n    dispatch(selectActions.selectPrev());\n  }, [dispatch]);\n  const selectNext = useCallback(() => {\n    dispatch(selectActions.selectNext());\n  }, [dispatch]);\n  const swapWithPrev = useCallback(() => {\n    dispatch(editorActions.swapWithPrev());\n  }, [dispatch]);\n  const swapWithNext = useCallback(() => {\n    dispatch(editorActions.swapWithNext());\n  }, [dispatch]);\n\n  const { t } = useTranslation();\n  return (\n    <div className=\"select-control\">\n      <div className=\"selected-info\">\n        {strokeInfo && <>\n          <div>\n            {t('stroke type')}\n            <select value={strokeInfo.strokeType} onChange={changeStrokeType}>\n              {strokeTypes.map((strokeType) => (\n                <option key={strokeType} value={strokeType}>\n                  {t(`stroke type ${strokeType}`)}\n                </option>\n              ))}\n              {!strokeTypes.includes(strokeInfo.strokeType) && (\n                <option value={strokeInfo.strokeType} />\n              )}\n            </select>\n            {' '}\n            {t('head type')}\n            <select value={strokeInfo.headShapeType} onChange={changeHeadShapeType}>\n              {headShapeTypes[strokeInfo.strokeType].map((headShapeType) => (\n                <option key={headShapeType} value={headShapeType}>\n                  {t(`head type ${strokeInfo.strokeType}-${headShapeType}`)}\n                </option>\n              ))}\n              {!headShapeTypes[strokeInfo.strokeType].includes(strokeInfo.headShapeType) && (\n                <option value={strokeInfo.headShapeType} />\n              )}\n            </select>\n            {' '}\n            {t('tail type')}\n            <select value={strokeInfo.tailShapeType} onChange={changeTailShapeType}>\n              {tailShapeTypes[strokeInfo.strokeType].map((tailShapeType) => (\n                <option key={tailShapeType} value={tailShapeType}>\n                  {t(`tail type ${strokeInfo.strokeType}-${tailShapeType}`)}\n                </option>\n              ))}\n              {!tailShapeTypes[strokeInfo.strokeType].includes(strokeInfo.tailShapeType) && (\n                <option value={strokeInfo.tailShapeType} />\n              )}\n            </select>\n            {' '}\n            {!strokeInfo.validTypes && (\n              <span className=\"alert\">\n                {t('invalid stroke shape types')}\n              </span>\n            )}\n          </div>\n          <div>{strokeInfo.coordString}</div>\n        </>}\n        {partInfo && <>\n          <div>\n            {t('part')}\n            {' '}\n            <strong>{partInfo.partName}</strong>\n            {' '}\n            {partInfo.entityName && t('alias of', { entity: partInfo.entityName })}\n          </div>\n          <div>{partInfo.coordString}</div>\n          {partInfo.stretchCoeff !== null && (\n            <div>\n              {t('stretch')}\n              {' '}\n              <input\n                type=\"range\" min={-10} max={10}\n                value={partInfo.stretchCoeff}\n                onChange={changeStretchCoeff}\n              />\n              {' '}\n              {partInfo.stretchCoeff}\n            </div>\n          )}\n        </>}\n        {reflectRotateInfo && <>\n          <div>\n            <select value={reflectRotateInfo.opType} onChange={changeReflectRotateOpType}>\n              {reflectRotateTypes.map((opType) => (\n                <option key={opType} value={opType}>\n                  {t(`operation type ${ReflectRotateType[opType]}`)}\n                </option>\n              ))}\n              {!reflectRotateTypes.includes(reflectRotateInfo.opType) && (\n                <option value={reflectRotateInfo.opType} />\n              )}\n            </select>\n          </div>\n          <div>{reflectRotateInfo.coordString}</div>\n        </>}\n        {otherInfo && <>\n          {otherInfo.isMultiple && <div>{t('selecting multiple strokes')}</div>}\n          {otherInfo.coordString && <div>{otherInfo.coordString}</div>}\n        </>}\n      </div>\n      <div className=\"selection-control\">\n        <button\n          disabled={swapPrevDisabled}\n          onClick={swapWithPrev}\n        >\n          {t('swap with prev')}\n        </button>\n        <button\n          className=\"select-prevnext-button\"\n          disabled={selectPrevDisabled}\n          onClick={selectPrev}\n        >\n          {t('select prev')}\n        </button>\n        <div className=\"selection-num\">\n          {selectIndexString}\n        </div>\n        <button\n          className=\"select-prevnext-button\"\n          disabled={selectNextDisabled}\n          onClick={selectNext}\n        >\n          {t('select next')}\n        </button>\n        <button\n          disabled={swapNextDisabled}\n          onClick={swapWithNext}\n        >\n          {t('swap with next')}\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default SelectionInfo;\n","import { createSelector } from 'reselect';\n\nimport { Glyph } from '../kageUtils/glyph';\nimport { getGlyphLineBBX } from '../kageUtils/bbx';\n\nimport { draggedGlyphSelector } from './draggedGlyph';\n\nexport const submitGlyphSelector = createSelector([\n  draggedGlyphSelector,\n], (glyph: Glyph): Glyph => {\n  return glyph.filter((glyphLine) => getGlyphLineBBX(glyphLine)[0] < 200);\n});\n","import React from 'react';\nimport { useSelector } from 'react-redux';\n\nimport { submitGlyphSelector } from '../selectors/submitGlyph';\nimport { AppState } from '../reducers';\nimport { makeGlyphSeparatedForSubmit } from '../kage';\n\nimport GlyphComponent from './Glyph';\n\nconst SubmitPreview = () => {\n  const submitGlyph = useSelector(submitGlyphSelector);\n  const buhinMap = useSelector((state: AppState) => state.buhinMap);\n  const shotai = useSelector((state: AppState) => state.shotai);\n  const xorMaskType = useSelector((state: AppState) => state.xorMaskType);\n\n  return (\n    <svg className=\"preview-thumbnail\" viewBox=\"0 0 200 200\" width=\"50\" height=\"50\">\n      <GlyphComponent\n        buhinMap={buhinMap}\n        glyph={submitGlyph}\n        shotai={shotai}\n        xorMaskType={xorMaskType}\n        selection={[]}\n        makeGlyphSeparated={makeGlyphSeparatedForSubmit}\n      />\n    </svg>\n  );\n};\n\nexport default SubmitPreview;\n","import React, { useCallback } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\n\nimport { useTranslation } from 'react-i18next';\n\nimport { AppState } from '../reducers';\nimport { editorActions } from '../actions/editor';\nimport { selectActions } from '../actions/select';\nimport { undoActions } from '../actions/undo';\nimport { displayActions } from '../actions/display';\n\nimport SelectionInfo from './SelectionInfo';\nimport SubmitPreview from './SubmitPreview';\n\nimport './EditorControls.css';\n\nconst EditorControls = () => {\n  const glyph = useSelector((state: AppState) => state.glyph);\n  const selection = useSelector((state: AppState) => state.selection);\n  const clipboard = useSelector((state: AppState) => state.clipboard);\n  const freehandMode = useSelector((state: AppState) => state.freehandMode);\n  const undoLength = useSelector((state: AppState) => state.undoStacks.undo.length);\n  const redoLength = useSelector((state: AppState) => state.undoStacks.redo.length);\n\n  const undoDisabled = undoLength === 0;\n  const redoDisabled = redoLength === 0;\n  const pasteDisabled = clipboard.length === 0;\n  const decomposeDisabled = !selection.some((index) => glyph[index].value[0] === 99);\n\n  const dispatch = useDispatch();\n  const undo = useCallback(() => {\n    dispatch(undoActions.undo());\n  }, [dispatch]);\n  const redo = useCallback(() => {\n    dispatch(undoActions.redo());\n  }, [dispatch]);\n  const selectAll = useCallback(() => {\n    dispatch(selectActions.selectAll());\n  }, [dispatch]);\n  const selectDeselected = useCallback(() => {\n    dispatch(selectActions.selectDeselected());\n  }, [dispatch]);\n  const copy = useCallback(() => {\n    dispatch(editorActions.copy());\n  }, [dispatch]);\n  const paste = useCallback(() => {\n    dispatch(editorActions.paste());\n  }, [dispatch]);\n  const cut = useCallback(() => {\n    dispatch(editorActions.cut());\n  }, [dispatch]);\n  const toggleFreehand = useCallback(() => {\n    dispatch(editorActions.toggleFreehand());\n  }, [dispatch]);\n  const decompose = useCallback(() => {\n    dispatch(editorActions.decomposeSelected());\n  }, [dispatch]);\n  const options = useCallback(() => {\n    dispatch(displayActions.openOptionModal());\n  }, [dispatch]);\n  const finishEdit = useCallback((evt: React.MouseEvent) => {\n    dispatch(editorActions.finishEdit(evt.nativeEvent));\n  }, [dispatch]);\n\n  const { t } = useTranslation();\n  return (\n    <div className=\"editor-controls\">\n      <SelectionInfo />\n      <div className=\"control-buttons\">\n        <button\n          disabled={undoDisabled}\n          onClick={undo}\n        >\n          {t('undo')}\n        </button>\n        <button\n          disabled={redoDisabled}\n          onClick={redo}\n        >\n          {t('redo')}\n        </button>\n        <button\n          disabled={glyph.length === 0}\n          onClick={selectAll}\n        >\n          {t('select all')}\n        </button>\n        <button\n          disabled={glyph.length === 0}\n          onClick={selectDeselected}\n        >\n          {t('invert selection')}\n        </button>\n        <button\n          disabled={selection.length === 0}\n          onClick={copy}\n        >\n          {t('copy')}\n        </button>\n        <button\n          disabled={pasteDisabled}\n          onClick={paste}\n        >\n          {t('paste')}\n        </button>\n        <button\n          disabled={selection.length === 0}\n          onClick={cut}\n        >\n          {t('cut')}\n        </button>\n        <button\n          onClick={toggleFreehand}\n        >\n          {freehandMode ? t('end freehand') : t('start freehand')}\n        </button>\n        <button\n          disabled={decomposeDisabled}\n          onClick={decompose}\n        >\n          {t('decompose')}\n        </button>\n        <button\n          onClick={options}\n        >\n          {t('options')}\n        </button>\n      </div>\n      <div className=\"preview\">\n        <SubmitPreview />\n        <button onClick={finishEdit}>\n          {t('finish edit')}\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default EditorControls;\n","import React, { useCallback } from 'react';\n\nimport './PartsList.css';\n\nconst getImageURL = (name: string) => (\n  `https://glyphwiki.org/glyph/${name}.50px.png`\n);\n\ninterface PartsListProps {\n  names: string[];\n  handleItemClick: (partName: string, evt: React.MouseEvent<HTMLImageElement>) => void;\n  handleItemMouseEnter: (partName: string, evt: React.MouseEvent<HTMLImageElement>) => void;\n}\n\nconst PartsList = (props: PartsListProps) => {\n  const { handleItemClick, handleItemMouseEnter } = props;\n  const handleImageClick = useCallback((evt: React.MouseEvent<HTMLImageElement>) => {\n    const partName = evt.currentTarget.dataset.name!;\n    handleItemClick(partName, evt);\n  }, [handleItemClick]);\n  const handleImageMouseEnter = useCallback((evt: React.MouseEvent<HTMLImageElement>) => {\n    const partName = evt.currentTarget.dataset.name!;\n    handleItemMouseEnter(partName, evt);\n  }, [handleItemMouseEnter]);\n\n  return (\n    <div className=\"parts-list\">\n      {props.names.map((name) => (\n        <img\n          key={name} alt={name} title={name}\n          data-name={name}\n          src={getImageURL(name)}\n          width={50} height={50}\n          loading=\"lazy\"\n          onClick={handleImageClick}\n          onMouseEnter={handleImageMouseEnter}\n        />\n      ))}\n    </div>\n  );\n};\n\nexport default PartsList;\n","import React, { useRef, useCallback, useState, useEffect } from 'react';\nimport { useDispatch } from 'react-redux';\n\nimport { useTranslation } from 'react-i18next';\n\nimport { editorActions } from '../actions/editor';\nimport { search } from '../callapi';\nimport args from '../args';\n\nimport PartsList from './PartsList';\n\nimport './PartsSearch.css';\n\nconst searchSuggestions = [\n  '1',\n  '2',\n  '3',\n  '4',\n];\n\nconst initialQuery = args.name || '';\n\nclass QueryTooShortError extends Error { }\n\ninterface SearchState {\n  query: string;\n  result: string[] | null;\n  err: any;\n}\n\nconst initialSearchState: SearchState = {\n  query: '',\n  result: [],\n  err: null,\n};\n\nconst PartsSearch = () => {\n  const queryInputRef = useRef<HTMLInputElement>(null);\n  const [searchState, setSearchState] = useState<SearchState>(initialSearchState);\n\n  const startSearch = (query: string) => {\n    setSearchState({\n      query,\n      result: null,\n      err: null,\n    });\n    search(query)\n      .then((result) => {\n        if (result === 'tooshort') {\n          throw new QueryTooShortError('query too short');\n        }\n        if (result === 'nodata') {\n          return [];\n        }\n        return result.split('\\t');\n      })\n      .then((names): SearchState => ({\n        query,\n        result: names,\n        err: null,\n      }))\n      .catch((reason): SearchState => ({\n        query,\n        result: null,\n        err: reason,\n      }))\n      .then((newSearchState) => {\n        setSearchState((currentSearchState) => (\n          (currentSearchState.query === query)\n            ? newSearchState\n            : currentSearchState // query has changed, discard result\n        ));\n      });\n  };\n\n  useEffect(() => {\n    if (initialQuery) {\n      startSearch(initialQuery);\n    }\n  }, []);\n  const handleSearch = useCallback(() => {\n    if (!queryInputRef.current) {\n      return;\n    }\n    const query = queryInputRef.current.value;\n    if (!query) {\n      setSearchState({\n        query,\n        result: [],\n        err: null,\n      });\n      return;\n    }\n    startSearch(query);\n  }, []);\n  const handleFormSubmit = useCallback((evt: React.FormEvent) => {\n    evt.preventDefault();\n    handleSearch();\n  }, [handleSearch]);\n\n  const hoverNameRef = useRef<HTMLDivElement>(null);\n  const handleItemMouseEnter = useCallback((partName: string) => {\n    if (!hoverNameRef.current) {\n      return;\n    }\n    hoverNameRef.current.textContent = partName;\n  }, []);\n  const dispatch = useDispatch();\n  const handleItemClick = useCallback((partName: string, evt: React.MouseEvent) => {\n    if (evt.shiftKey) {\n      if (!queryInputRef.current) {\n        return;\n      }\n      queryInputRef.current.value = partName;\n      startSearch(partName);\n    } else {\n      dispatch(editorActions.insertPart(partName));\n    }\n  }, [dispatch]);\n\n  const { t } = useTranslation();\n  return (\n    <div className=\"parts-search-area\">\n      <form className=\"parts-search-box\" onSubmit={handleFormSubmit}>\n        <input defaultValue={initialQuery} list=\"searchList\" ref={queryInputRef} />\n        <button>\n          {t('search')}\n        </button>\n        <datalist id=\"searchList\">\n          {searchSuggestions.map((suggestion, index) => (\n            <option key={index} value={suggestion} />\n          ))}\n        </datalist>\n      </form>\n      <div className=\"parts-list-area\">\n        {searchState.err\n          ? searchState.err instanceof QueryTooShortError\n            ? <div className=\"message\">{t('search query too short')}</div>\n            : <div className=\"message\">{t('search error', { message: searchState.err })}</div>\n          : !searchState.result\n            ? <div className=\"message\">{t('searching')}</div>\n            : searchState.result.length === 0\n              ? <div className=\"message\">{t('no search result')}</div>\n              : <PartsList\n                names={searchState.result}\n                handleItemClick={handleItemClick}\n                handleItemMouseEnter={handleItemMouseEnter}\n              />}\n      </div>\n      <div className=\"parts-hover-name\" ref={hoverNameRef}>&nbsp;</div>\n    </div>\n  )\n};\n\nexport default PartsSearch;\n","import React, { useRef, useEffect } from 'react';\nimport { useSelector } from 'react-redux';\n\nimport args from '../args';\n\nimport { AppState } from '../reducers';\nimport { submitGlyphSelector } from '../selectors/submitGlyph';\nimport { unparseGlyph } from '../kageUtils/glyph';\n\n\nconst glyphName = args.name || 'sandbox';\n\nconst formAction = `${args.ssl ? 'https' : 'http'}://${args.host}/wiki/${encodeURIComponent(glyphName)}`;\n\nconst formStyle: React.CSSProperties = {\n  visibility: 'hidden',\n  position: 'absolute',\n};\n\nconst SubmitForm = () => {\n  const exitEvent = useSelector((state: AppState) => state.exitEvent);\n  const formRef = useRef<HTMLFormElement>(null);\n  useEffect(() => {\n    if (exitEvent) {\n      formRef.current?.submit();\n    }\n  }, [exitEvent]);\n  const glyph = useSelector(submitGlyphSelector);\n  return (\n    <form\n      style={formStyle}\n      ref={formRef}\n      action={formAction}\n      method=\"get\"\n    >\n      <input type=\"hidden\" name=\"page\" value={glyphName} />\n      <input type=\"hidden\" name=\"action\" value=\"preview\" />\n      <input type=\"hidden\" name=\"textbox\" value={unparseGlyph(glyph)} />\n      <input type=\"hidden\" name=\"related\" value={args.related} />\n      <input type=\"hidden\" name=\"summary\" value={args.summary} />\n      {args.edittime && <input type=\"hidden\" name=\"edittime\" value={args.edittime} />}\n    </form>\n  );\n};\n\nexport default SubmitForm;","import React, { useCallback } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\n\nimport ReactModal from 'react-modal';\nimport { useTranslation } from 'react-i18next';\n\nimport { displayActions } from '../actions/display';\nimport { AppState } from '../reducers';\nimport { KShotai } from '../kage';\nimport { XorMaskType, xorMaskTypes } from '../xorMask';\n\nimport './OptionModal.css';\n\nconst OptionModal = () => {\n  const showOptionModal = useSelector((state: AppState) => state.showOptionModal);\n  const grid = useSelector((state: AppState) => state.grid);\n  const shotai = useSelector((state: AppState) => state.shotai);\n  const xorMaskType = useSelector((state: AppState) => state.xorMaskType);\n  const showStrokeCenterLine = useSelector((state: AppState) => state.showStrokeCenterLine);\n\n  const dispatch = useDispatch();\n  const handleRequestClose = useCallback(() => {\n    dispatch(displayActions.closeOptionModal());\n  }, [dispatch]);\n\n  const handleGridDisplayChange = useCallback((evt: React.ChangeEvent<HTMLInputElement>) => {\n    dispatch(displayActions.setGridDisplay(evt.currentTarget.checked));\n  }, [dispatch]);\n  const handleGridOriginXChange = useCallback((evt: React.ChangeEvent<HTMLInputElement>) => {\n    dispatch(displayActions.setGridOriginX(evt.currentTarget.valueAsNumber));\n  }, [dispatch]);\n  const handleGridOriginYChange = useCallback((evt: React.ChangeEvent<HTMLInputElement>) => {\n    dispatch(displayActions.setGridOriginY(evt.currentTarget.valueAsNumber));\n  }, [dispatch]);\n  const handleGridSpacingXChange = useCallback((evt: React.ChangeEvent<HTMLInputElement>) => {\n    dispatch(displayActions.setGridSpacingX(evt.currentTarget.valueAsNumber));\n  }, [dispatch]);\n  const handleGridSpacingYChange = useCallback((evt: React.ChangeEvent<HTMLInputElement>) => {\n    dispatch(displayActions.setGridSpacingY(evt.currentTarget.valueAsNumber));\n  }, [dispatch]);\n  const handleShotaiChange = useCallback((evt: React.ChangeEvent<HTMLSelectElement>) => {\n    dispatch(displayActions.setShotai(+evt.currentTarget.value as KShotai));\n  }, [dispatch]);\n  const handleStrokeCenterLineChange = useCallback((evt: React.ChangeEvent<HTMLInputElement>) => {\n    dispatch(displayActions.setStrokeCenterLineDisplay(evt.currentTarget.checked));\n  }, [dispatch]);\n  const handleXorMaskTypeChange = useCallback((evt: React.ChangeEvent<HTMLSelectElement>) => {\n    dispatch(displayActions.setXorMaskType(evt.currentTarget.value as XorMaskType));\n  }, [dispatch]);\n  \n  const { t, i18n } = useTranslation();\n  const handleLanguageChange = useCallback((evt: React.ChangeEvent<HTMLSelectElement>) => {\n    i18n.changeLanguage(evt.currentTarget.value);\n  }, [i18n]);\n\n  return (\n    <ReactModal\n      isOpen={showOptionModal}\n      onRequestClose={handleRequestClose}\n      shouldCloseOnEsc={false} // handled by hotkeys-js\n      className={'modal-content'}\n    >\n      <fieldset>\n        <legend>{t('grid option')}</legend>\n        <div>\n          <label>\n            <input type=\"checkbox\" checked={grid.display} onChange={handleGridDisplayChange} />\n            {t('enable grid')}\n          </label>\n        </div>\n        <div>\n          {t('grid origin x')} <input\n            type=\"number\"\n            value={grid.originX}\n            min={0}\n            max={200}\n            onChange={handleGridOriginXChange}\n            disabled={!grid.display}\n          />\n          {' '}\n          {t('grid origin y')} <input\n            type=\"number\"\n            value={grid.originY}\n            min={0}\n            max={200}\n            onChange={handleGridOriginYChange}\n            disabled={!grid.display}\n          />\n        </div>\n        <div>\n          {t('grid spacing x')} <input\n            type=\"number\"\n            value={grid.spacingX}\n            min={2}\n            max={200}\n            onChange={handleGridSpacingXChange}\n            disabled={!grid.display}\n          />\n          {' '}\n          {t('grid spacing y')} <input\n            type=\"number\"\n            value={grid.spacingY}\n            min={2}\n            max={200}\n            onChange={handleGridSpacingYChange}\n            disabled={!grid.display}\n          />\n        </div>\n      </fieldset>\n      <div>\n        {t('glyph font style')} <select\n          value={shotai}\n          onChange={handleShotaiChange}\n        >\n          <option value={0}>{t('mincho style')}</option>\n          <option value={1}>{t('gothic style')}</option>\n        </select>\n      </div>\n      <div>\n        <label>\n          <input\n            type=\"checkbox\"\n            checked={showStrokeCenterLine}\n            onChange={handleStrokeCenterLineChange}\n          />\n          {t('show stroke center line')}\n        </label>\n      </div>\n      <div>\n        {t('negative mask type')} <select\n          value={xorMaskType}\n          onChange={handleXorMaskTypeChange}\n        >\n          {xorMaskTypes.map((maskType) => (\n            <option key={maskType} value={maskType}>{t(`negative mask type ${maskType}`)}</option>\n          ))}\n        </select>\n      </div>\n      <div>\n        {t('display language')} <select\n          value={i18n.language}\n          onChange={handleLanguageChange}\n        >\n          <option value=\"ja\"></option>\n          <option value=\"en\">English</option>\n          <option value=\"ko\"></option>\n          <option value=\"zh-Hans\"></option>\n          <option value=\"zh-Hant\"></option>\n        </select>\n      </div>\n      <div>\n        <button onClick={handleRequestClose}>{t('close modal')}</button>\n      </div>\n    </ReactModal>\n  )\n};\n\nif (process.env.NODE_ENV !== 'test') {\n  ReactModal.setAppElement('#root');\n}\n\nexport default OptionModal;\n","import React from 'react';\n\nimport GlyphArea from './components/GlyphArea';\nimport EditorControls from './components/EditorControls';\nimport PartsSearch from './components/PartsSearch'\nimport SubmitForm from './components/SubmitForm';\nimport OptionModal from './components/OptionModal';\n\nimport { useShortcuts } from './shortcuts';\n\nimport './App.css';\nimport { useTranslation } from 'react-i18next';\n\nfunction App() {\n  const { i18n } = useTranslation();\n  useShortcuts();\n  return (\n    <div className=\"App\" lang={i18n.language}>\n      <GlyphArea />\n      <EditorControls />\n      <PartsSearch />\n      <SubmitForm />\n      <OptionModal />\n    </div>\n  );\n}\n\nexport default App;\n","import { useDispatch } from 'react-redux';\nimport { useHotkeys }from 'react-hotkeys-hook';\n\nimport { selectActions } from './actions/select';\nimport { editorActions } from './actions/editor';\nimport { undoActions } from './actions/undo';\n\nexport const useShortcuts = () => {\n  const dispatch = useDispatch();\n  useHotkeys('ctrl+a, command+a', (evt) => {\n    dispatch(selectActions.selectAll());\n    evt.preventDefault();\n  }, {}, [dispatch]);\n  useHotkeys('ctrl+i, command+i', (evt) => {\n    dispatch(selectActions.selectDeselected());\n    evt.preventDefault();\n  }, {}, [dispatch]);\n\n  useHotkeys('ctrl+z, command+z', (evt) => {\n    dispatch(undoActions.undo());\n    evt.preventDefault();\n  }, {}, [dispatch]);\n  useHotkeys('ctrl+y, command+y, ctrl+shift+z, command+shift+z', (evt) => {\n    dispatch(undoActions.redo());\n    evt.preventDefault();\n  }, {}, [dispatch]);\n  useHotkeys('ctrl+x, command+x', (evt) => {\n    dispatch(editorActions.cut());\n    evt.preventDefault();\n  }, {}, [dispatch]);\n  useHotkeys('ctrl+c, command+c', (evt) => {\n    dispatch(editorActions.copy());\n    evt.preventDefault();\n  }, {}, [dispatch]);\n  useHotkeys('ctrl+v, command+v', (evt) => {\n    dispatch(editorActions.paste());\n    evt.preventDefault();\n  }, {}, [dispatch]);\n  useHotkeys('del', (evt) => {\n    dispatch(editorActions.delete());\n    evt.preventDefault();\n  }, {}, [dispatch]);\n\n  useHotkeys('esc', () => {\n    dispatch(editorActions.escape());\n  }, {}, [dispatch]);\n\n  useHotkeys('ctrl+h, left', (evt) => {\n    dispatch(editorActions.moveSelected([-1, 0]));\n    evt.preventDefault();\n  }, {}, [dispatch]);\n  useHotkeys('ctrl+j, down', (evt) => {\n    dispatch(editorActions.moveSelected([0, 1]));\n    evt.preventDefault();\n  }, {}, [dispatch]);\n  useHotkeys('ctrl+k, up', (evt) => {\n    dispatch(editorActions.moveSelected([0, -1]));\n    evt.preventDefault();\n  }, {}, [dispatch]);\n  useHotkeys('ctrl+l, right', (evt) => {\n    dispatch(editorActions.moveSelected([1, 0]));\n    evt.preventDefault();\n  }, {}, [dispatch]);\n  useHotkeys('ctrl+shift+h, shift+left', (evt) => {\n    dispatch(editorActions.moveSelected([-5, 0]));\n    evt.preventDefault();\n  }, {}, [dispatch]);\n  useHotkeys('ctrl+shift+j, shift+down', (evt) => {\n    dispatch(editorActions.moveSelected([0, 5]));\n    evt.preventDefault();\n  }, {}, [dispatch]);\n  useHotkeys('ctrl+shift+k, shift+up', (evt) => {\n    dispatch(editorActions.moveSelected([0, -5]));\n    evt.preventDefault();\n  }, {}, [dispatch]);\n  useHotkeys('ctrl+shift+l, shift+right', (evt) => {\n    dispatch(editorActions.moveSelected([5, 0]));\n    evt.preventDefault();\n  }, {}, [dispatch]);\n\n  useHotkeys('ctrl+s, command+s', (evt) => {\n    dispatch(editorActions.finishEdit(evt));\n    evt.preventDefault();\n  }, {}, [dispatch]);\n};\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);  \n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n}\n\nexport default reportWebVitals;\n","import i18n from 'i18next';\nimport { initReactI18next } from 'react-i18next';\n\nimport args from \"./args\";\n\nimport jaTranslation from './locales/ja.json';\nimport enTranslation from './locales/en.json';\nimport koTranslation from './locales/ko.json';\nimport zhCNTranslation from './locales/zh_CN.json';\nimport zhTWTranslation from './locales/zh_TW.json';\n\nconst resources = {\n  \"ja\": {\n    translation: jaTranslation,\n  },\n  \"en\": {\n    translation: enTranslation,\n  },\n  \"ko\": {\n    translation: koTranslation,\n  },\n  \"zh-Hans\": {\n    translation: zhCNTranslation,\n  },\n  \"zh-Hant\": {\n    translation: zhTWTranslation,\n  },\n};\n\nlet lng = 'ja';\nswitch (args.host.split('.')[0]) {\n  case 'en':\n    lng = 'en';\n    break;\n  case 'ko':\n    lng = 'ko';\n    break;\n  case 'zhs':\n    lng = 'zh-Hans';\n    break;\n  case 'zht':\n    lng = 'zh-Hant';\n    break;\n}\n\ni18n\n  .use(initReactI18next) // passes i18n down to react-i18next\n  .init({\n    resources,\n    lng,\n    fallbackLng: {\n      'zh-Hans': ['zh-Hant', 'ja'],\n      'zh-Hant': ['zh-Hans', 'ja'],\n      'default': ['ja'],\n    },\n\n    returnObjects: true,\n    interpolation: {\n      escapeValue: false, // react already safes from xss\n    },\n  });\n\nexport default i18n;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport { Provider } from 'react-redux';\n\nimport store from './store';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\nimport './i18n';\n\nimport './index.css';\n\nReactDOM.render(\n  <React.StrictMode>\n    <Provider store={store}>\n      <App />\n    </Provider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}