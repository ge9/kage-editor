(this["webpackJsonpkage-editor"]=this["webpackJsonpkage-editor"]||[]).push([[0],{39:function(e){e.exports=JSON.parse('{"stroke type":"\u7dda\u7a2e","stroke type 1":"\u76f4\u7dda","stroke type 2":"\u66f2\u7dda","stroke type 3":"\u6298\u308c","stroke type 4":"\u4e59\u7dda","stroke type 6":"\u8907\u66f2\u7dda","stroke type 7":"\u7e26\u6255\u3044","head type":"\u982d\u5f62\u72b6","head type 1-0":"\u958b\u653e","head type 1-2":"\u63a5\u7d9a(\u6a2a)","head type 1-32":"\u63a5\u7d9a(\u7e26)","head type 1-12":"\u5de6\u4e0a\u30ab\u30c9","head type 1-22":"\u53f3\u4e0a\u30ab\u30c9","head type 2-0":"\u958b\u653e","head type 2-32":"\u63a5\u7d9a","head type 2-12":"\u5de6\u4e0a\u30ab\u30c9","head type 2-22":"\u53f3\u4e0a\u30ab\u30c9","head type 2-7":"\u7d30\u5165\u308a","head type 3-0":"\u958b\u653e","head type 3-32":"\u63a5\u7d9a(\u7e26)","head type 3-12":"\u5de6\u4e0a\u30ab\u30c9","head type 3-22":"\u53f3\u4e0a\u30ab\u30c9","head type 4-0":"\u958b\u653e","head type 4-22":"\u53f3\u4e0a\u30ab\u30c9","head type 6-0":"\u958b\u653e","head type 6-32":"\u63a5\u7d9a","head type 6-12":"\u5de6\u4e0a\u30ab\u30c9","head type 6-22":"\u53f3\u4e0a\u30ab\u30c9","head type 6-7":"\u7d30\u5165\u308a","head type 7-0":"\u958b\u653e","head type 7-32":"\u63a5\u7d9a","head type 7-12":"\u5de6\u4e0a\u30ab\u30c9","head type 7-22":"\u53f3\u4e0a\u30ab\u30c9","tail type":"\u5c3e\u5f62\u72b6","tail type 1-0":"\u958b\u653e","tail type 1-2":"\u63a5\u7d9a(\u6a2a)","tail type 1-32":"\u63a5\u7d9a(\u7e26)","tail type 1-13":"\u5de6\u4e0b\u30ab\u30c9","tail type 1-23":"\u53f3\u4e0b\u30ab\u30c9","tail type 1-4":"\u5de6\u30cf\u30cd","tail type 1-313":"\u5de6\u4e0bzh\u7528\u65e7","tail type 1-413":"\u5de6\u4e0bzh\u7528\u65b0","tail type 1-24":"\u53f3\u4e0bH/T","tail type 2-7":"\u5de6\u6255\u3044","tail type 2-0":"\u53f3\u6255\u3044","tail type 2-8":"\u6b62\u3081","tail type 2-4":"\u5de6\u30cf\u30cd","tail type 2-5":"\u53f3\u30cf\u30cd","tail type 3-0":"\u958b\u653e","tail type 3-5":"\u4e0a\u30cf\u30cd","tail type 4-0":"\u958b\u653e","tail type 4-5":"\u4e0a\u30cf\u30cd","tail type 6-7":"\u5de6\u6255\u3044","tail type 6-0":"\u53f3\u6255\u3044","tail type 6-8":"\u6b62\u3081","tail type 6-4":"\u5de6\u30cf\u30cd","tail type 6-5":"\u53f3\u30cf\u30cd","tail type 7-7":"\u5de6\u6255\u3044","invalid stroke shape types":"\u30a8\u30e9\u30fc:\u3042\u308a\u3048\u306a\u3044\u7b46\u753b\u30fb\u5f62\u72b6\u306e\u7d44\u307f\u5408\u308f\u305b\u3067\u3059","part":"\u90e8\u54c1","alias of":"({{entity}} \u306e\u30a8\u30a4\u30ea\u30a2\u30b9)","stretch":"\u30b9\u30c8\u30ec\u30c3\u30c1:","selecting multiple strokes":"\u8907\u6570\u9078\u629e\u4e2d","select prev":"\u2190","swap with prev":"\u5165\u66ff\u2190","select next":"\u2192","swap with next":"\u2192\u5165\u66ff","undo":"\u5143\u306b\u623b\u3059","redo":"\u3084\u308a\u76f4\u3059","select all":"\u3059\u3079\u3066\u3092\u9078\u629e","invert selection":"\u9078\u629e\u7bc4\u56f2\u3092\u53cd\u8ee2","copy":"\u30b3\u30d4\u30fc","paste":"\u8cbc\u308a\u4ed8\u3051","cut":"\u5207\u308a\u53d6\u308a","start freehand":"\u624b\u66f8\u304d\u958b\u59cb","end freehand":"\u624b\u66f8\u304d\u7d42\u4e86","decompose":"\u90e8\u54c1\u5206\u89e3","options":"\u8868\u793a\u8a2d\u5b9a...","finish edit":"\u7de8\u96c6\u7d42\u4e86","search":"\u691c\u7d22","searching":"\u691c\u7d22\u4e2d","search error":"\u30a8\u30e9\u30fc:{{message}}","search query too short":"\u30a8\u30e9\u30fc:\u30ad\u30fc\u30ef\u30fc\u30c9\u304c\u77ed\u3059\u304e\u307e\u3059","no search result":"\u8a72\u5f53\u90e8\u54c1\u306a\u3057"}')},42:function(e,t,n){e.exports=n(77)},61:function(e,t,n){},62:function(e,t,n){},63:function(e,t,n){},64:function(e,t,n){},65:function(e,t,n){},66:function(e,t,n){},67:function(e,t,n){},73:function(e,t,n){},74:function(e,t,n){},75:function(e,t,n){},76:function(e,t,n){},77:function(e,t,n){"use strict";n.r(t);var a,r=n(0),c=n.n(r),l=n(18),u=n.n(l),o=n(3),i=n(19),s=n(32),v=function(e){switch(e){case 0:case 1:case 9:return 7;case 2:case 3:case 4:return 9;case 6:case 7:case 99:return 11;default:return 0}},f=function(e){var t=e.value.slice();return 99===t[0]&&(t[7]=e.partName||""),t.join(":")},h=function(e){return e.split(/[$\r\n]+/).map((function(e){return function(e){for(var t=e.split(":"),n=+t[0],a=v(n),r=[],c=0;c<a;c++)r.push(Math.floor(+t[c]||0));return 99===r[0]?{value:r,partName:t[7]||""}:{value:r}}(e)})).filter((function(e){return 0!==(t=e).value.length&&(0!==t.value[0]||97===t.value[1]||98===t.value[1]||99===t.value[1]);var t}))},p=function(e){return e.map((function(e){return f(e)})).join("$")},d=new URLSearchParams(window.location.hash.slice(1)),b=n(7),m=n(1),O=n(9),g=n.n(O),j=g()("SELECT"),y={selectSingle:j("SELECT_SINGLE"),selectAddSingle:j("SELECT_ADD_SINGLE"),selectRemoveSingle:j("SELECT_REMOVE_SINGLE"),selectNone:j("SELECT_NONE"),selectAll:j("SELECT_ALL"),selectDeselected:j("SELECT_TOGGLE_ALL"),selectPrev:j("SELECT_PREV"),selectNext:j("SELECT_NEXT")},E=n(2),k=n(22);!function(e){e[e.north=0]="north",e[e.south=1]="south",e[e.east=2]="east",e[e.west=3]="west",e[e.southeast=4]="southeast"}(a||(a={}));var S,M=g()("EDITOR"),w={startBackgroundDrag:M("BACKGROUND_DRAG_START"),startSelectionDrag:M("SELECTION_DRAG_START"),startPointDrag:M("MOVE_POINT_START"),startResize:M("RESIZE_START"),mouseMove:M("MOUSE_MOVE"),mouseUp:M("MOUSE_UP"),updateCTMInv:M("UPDATE_CTMINV")},C=n(10),T=n(6),x=[[{position:"start",strokeTypes:[1],shapeTypes:[2]},{position:"start",strokeTypes:[1,2,3,4,6,7],shapeTypes:[12]}],[{position:"start",strokeTypes:[1],shapeTypes:[2]},{position:"end",strokeTypes:[1],shapeTypes:[13,313,413]}],[{position:"end",strokeTypes:[1],shapeTypes:[2]},{position:"start",strokeTypes:[1,2,3,4,6,7],shapeTypes:[22]}],[{position:"end",strokeTypes:[1],shapeTypes:[2]},{position:"end",strokeTypes:[1],shapeTypes:[23,24]}]],N=function(e,t){return e.position===t.position&&e.strokeTypes.includes(t.strokeType)&&e.shapeTypes.includes(t.shapeType)},I=function(e){var t=[];switch(e.value[0]){case 1:case 2:case 3:case 4:case 6:case 7:t.push({position:"start",strokeType:e.value[0],shapeType:e.value[1],coord:[e.value[3],e.value[4]],pointIndex:0});var n=(v(e.value[0])-3)/2-1;t.push({position:"end",strokeType:e.value[0],shapeType:e.value[2],coord:[e.value[3+2*n],e.value[3+2*n+1]],pointIndex:n})}return t},D=Object(T.a)((function(e,t){var n,a=[],r=Object(C.a)(t);try{for(r.s();!(n=r.n()).done;){var c,l=n.value,u=l.lineIndex,o=l.pointIndex,i=Object(C.a)(I(e[u]));try{for(i.s();!(c=i.n()).done;){var s=c.value;s.pointIndex===o&&a.push(s)}}catch(f){i.e(f)}finally{i.f()}}}catch(f){r.e(f)}finally{r.f()}var v=[];return e.forEach((function(e,t){var n,r=Object(C.a)(I(e));try{var c=function(){var e=n.value;a.some((function(t){return a=e,(n=t).coord[0]===a.coord[0]&&n.coord[1]===a.coord[1]&&x.some((function(e){var t=Object(E.a)(e,2),r=t[0],c=t[1];return N(r,n)&&N(c,a)||N(c,n)&&N(r,a)}));var n,a}))&&v.push({lineIndex:t,pointIndex:e.pointIndex})};for(r.s();!(n=r.n()).done;)c()}catch(f){r.e(f)}finally{r.f()}})),v}),(function(e,t){var n=Object(E.a)(e,2),a=n[0],r=n[1],c=Object(E.a)(t,2),l=c[0],u=c[1];return a===l&&r.length===u.length&&r.every((function(e,t){return e.lineIndex===u[t].lineIndex&&e.pointIndex===u[t].pointIndex}))})),P=Object(T.a)((function(e,t){var n,a=[],r=Object(C.a)(t);try{for(r.s();!(n=r.n()).done;){var c=n.value,l=e[c];a.push({lineIndex:c,pointIndex:0}),a.push({lineIndex:c,pointIndex:(v(l.value[0])-3)/2-1})}}catch(u){r.e(u)}finally{r.f()}return D(e,a).filter((function(e){var n=e.lineIndex;return!t.includes(n)}))})),_=function(e,t,n){switch(e.value[0]){case 99:var a=e.value.slice();return a[3]=t(a[3]),a[4]=n(a[4]),a[5]=t(a[5]),a[6]=n(a[6]),{value:a,partName:e.partName};case 0:case 1:case 2:case 3:case 4:case 6:case 7:case 9:for(var r=e.value.slice(),c=3;c+2<=r.length;c+=2)r[c]=t(r[c]),r[c+1]=n(r[c+1]);return{value:r};default:return e}},A=function(e,t,n,a){if(0===t.length)return e;var r,c=e.slice(),l=Object(C.a)(t);try{for(l.s();!(r=l.n()).done;){var u=r.value,o=u.lineIndex,i=u.pointIndex,s=c[o],v=s.value.slice();v[3+2*i]=n(v[3+2*i]),v[3+2*i+1]=a(v[3+2*i+1]),c[o]=Object(m.a)(Object(m.a)({},s),{},{value:v})}}catch(f){l.e(f)}finally{l.f()}return c},R=function(e,t,n,a){if(0===t.length)return e;var r=P(e,t),c=function(e){return Math.round(e+n)},l=function(e){return Math.round(e+a)};return e=e.map((function(e,n){return t.includes(n)?_(e,c,l):e})),e=A(e,r,c,l)},L=function(e,t,n,a,r){if(0===t.length)return e;var c=t[0],l={lineIndex:c,pointIndex:n},u=D(e,[l]).filter((function(e){return e.lineIndex!==c}));u.push(l);return e=A(e,u,(function(e){return Math.round(e+a)}),(function(e){return Math.round(e+r)}))},z=function(e,t,n,a){return e.map((function(e,r){return t.includes(r)?function(e,t,n){var a=Object(E.a)(t,4),r=a[0],c=a[1],l=a[2],u=a[3],o=Object(E.a)(n,4),i=o[0],s=o[1],v=o[2],f=o[3];return _(e,(function(e){return Math.round(i+(e-r)*(v-i)/(l-r))}),(function(e){return Math.round(s+(e-c)*(f-s)/(u-c))}))}(e,n,a):e}))},H=n(33),Y=g()("EDITOR"),G={loadedBuhin:Y("LOAD_BUHIN_DATA"),loadedStretchParam:Y("LOAD_STRETCH_PARAM"),changeStrokeType:Y("CHANGE_STROKE_TYPE"),changeHeadShapeType:Y("CHANGE_HEAD_SHAPE_TYPE"),changeTailShapeType:Y("CHANGE_TAIL_SHAPE_TYPE"),changeStretchCoeff:Y("CHANGE_STRETCH_COEFF"),swapWithPrev:Y("SWAP_WITH_PREV"),swapWithNext:Y("SWAP_WITH_NEXT"),insertPart:Y("ADD_PART"),paste:Y("PASTE"),copy:Y("COPY_SELECTION"),cut:Y("CUT_SELECTION"),delete:Y("DELETE_SELECTION"),decomposeSelected:Y("DECOMPOSE_SELECTION"),moveSelected:Y("MOVE_SELECTED"),toggleFreehand:Y("TOGGLE_FREEHAND_MODE"),openOptionModal:Y("OPEN_OPTION_MODAL"),closeOptionModal:Y("CLOSE_OPTION_MODAL"),finishEdit:Y("FINISH_EDIT")},X=n(8),U=n.n(X),B=n(16),F=function(){var e=Object(B.a)(U.a.mark((function e(t){var n;return U.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://asia-northeast1-ku6goma.cloudfunctions.net/gwproxy"+t);case 2:if((n=e.sent).ok){e.next=5;break}throw new Error("API error occurred");case 5:return e.t0=URLSearchParams,e.next=8,n.text();case 8:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),W=function(){var e=Object(B.a)(U.a.mark((function e(t){var n;return U.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F("/get_source.cgi?name=".concat(encodeURIComponent(t)));case 2:return n=e.sent,e.abrupt("return",n.get("data"));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),K=function(){var e=Object(B.a)(U.a.mark((function e(t){var n;return U.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F("/search4ge.cgi?query=".concat(encodeURIComponent(t)));case 2:return n=e.sent,e.abrupt("return",n.get("data"));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),V=new H.Kage,$=new Set,q=function(e,t){return e.length===t.length&&e.every((function(e,n){return e===t[n]}))},J=Object(T.a)((function(e,t){var n=e.map(f);return V.kBuhin.search=function(e){var n=t.get(e);return"undefined"===typeof n?(function(e){$.has(e)||($.add(e),W(e).then((function(t){if("string"!==typeof t)throw new Error("failed to get buhin source of ".concat(e));var n=/^0:1:0:(-?\d+):(-?\d+):(-?\d+):(-?\d+)(?=$|\$)/.exec(t);if(n){var a=[+n[1]||0,+n[2]||0,+n[3]||0,+n[4]||0];Re.dispatch(G.loadedStretchParam([e,a]))}Re.dispatch(G.loadedBuhin([e,t])),$.delete(e)})).catch((function(e){return console.error(e)})))}(e),""):n},V.makeGlyphSeparated(n)}),(function(e,t){var n=Object(E.a)(e,2),a=n[0],r=n[1],c=Object(E.a)(t,2),l=c[0];return r===c[1]&&q(a,l)})),Z=function(e){return Object(T.a)((function(e,t){return J(e,t)}),e)},Q=Z(),ee=Z((function(e,t){var n=Object(E.a)(e,2),a=n[0],r=n[1],c=Object(E.a)(t,2),l=c[0];return r===c[1]&&q(a,l)})),te=g()("UNDO"),ne={undo:te("UNDO"),redo:te("REDO")},ae=function(e,t){return n=e.glyph,a=t.glyph,n===a||n.length===a.length&&n.every((function(e,t){var n=a[t];return e===n||e.partName===n.partName&&e.value.length===n.value.length&&e.value.every((function(e,t){return e===n.value[t]}))}))?t:Object(m.a)(Object(m.a)({},t),{},{undoStacks:{undo:e.undoStacks.undo.concat([e.glyph]).slice(-30),redo:[]}});var n,a},re=n(5),ce=function(e){var t=e.map((function(e){return Object(E.a)(e,1)[0]})),n=e.map((function(e){return Object(E.a)(e,2)[1]}));return[Math.min.apply(Math,Object(b.a)(t)),Math.min.apply(Math,Object(b.a)(n)),Math.max.apply(Math,Object(b.a)(t)),Math.max.apply(Math,Object(b.a)(n))]},le=function(e){switch(e.value[0]){case 99:return ce([[e.value[3],e.value[4]],[e.value[5],e.value[6]]]);case 0:case 1:case 2:case 3:case 4:case 6:case 7:case 9:for(var t=[],n=3;n+2<=e.value.length;n+=2)t.push([e.value[n],e.value[n+1]]);return ce(t);default:return ce([])}},ue=function(e,t){var n=Object(E.a)(e,4),a=n[0],r=n[1],c=n[2],l=n[3],u=Object(E.a)(t,4),o=u[0],i=u[1],s=u[2],v=u[3];return[Math.min(a,o),Math.min(r,i),Math.max(c,s),Math.max(l,v)]},oe=Object(T.a)((function(e){return e.map(le).reduce(ue,ce([]))}),(function(e,t){var n=Object(E.a)(e,1)[0],a=Object(E.a)(t,1)[0];return n.length===a.length&&n.every((function(e,t){return e===a[t]}))})),ie=function(e){return function(e){return e.reduce((function(e,t){return e+t}),0)}(e)/e.length},se=function(e,t,n){return e*(1-n)+t*n},ve=function(e,t){return e*e+t*t},fe=function(e,t){var n=Object(E.a)(t[0],2),a=n[0],r=n[1],c=Object(E.a)(t[t.length-1],2),l=c[0],u=c[1],o=l-a,i=u-r;if(e.length>0&&ve(o,i)<Math.pow(25,2)){var s=e[e.length-1];if([1,2].includes(s.value[0])&&ve(a-s.value[s.value.length-2],r-s.value[s.value.length-1])<Math.pow(10,2)){if(o<0){var v={value:s.value.slice()};return v.value[2]=4,e.slice(0,-1).concat([v])}if(2===s.value[0]&&o>0&&i<0){var f={value:s.value.slice()};return f.value[2]=5,e.slice(0,-1).concat([f])}}}var h=ie(t.map((function(e){return Object(E.a)(e,1)[0]}))),p=ie(t.map((function(e){var t=Object(E.a)(e,2);t[0];return t[1]}))),d=se((a+l)/2,h,3),b=se((r+u)/2,p,3),m=(o*b-i*d+a*u-r*l)/Math.sqrt(ve(o,i));if(Math.abs(m)>5){var O=0,g=0;return o<0&&i>0&&m<0?(O=0,g=7):o>0&&i>0&&m>0?(O=7,g=0):o>0&&i>0&&m<0?(O=7,g=8):o>0&&i<0&&m>0&&(O=0,g=7),pe(e,{value:[2,O,g,a,r,d,b,l,u]})}return pe(e,{value:[1,0,0,a,r,l,u]})},he=function(e){return Math.round(e)},pe=function(e,t){return e=Oe(e,t),ge(t),e=je(e,t),t=_(t,he,he),(e=ye(e,t)).concat([t])},de=function(e,t,n,a){return e[t].value[n]===a?e:e.map((function(e,r){if(r!==t)return e;var c=Object(m.a)(Object(m.a)({},e),{},{value:e.value.slice()});return c.value[n]=a,c}))},be=function(e,t,n,a,r,c){for(var l="start"===n?1:2,u="start"===n?3:t.value.length-2,o=u+1,i=t.value[u],s=t.value[o],v=i-10,f=i+10,h=s-10,p=s+10,d=e.length-1;d>=0;d--){var b=e[d];if(1===b.value[0]){var m=b.value[3],O=b.value[4],g=b.value[5],j=b.value[6];if(!(g-m<Math.abs(j-O))){if([0,2].includes(b.value[1])&&v<=m&&m<=f&&h<=O&&O<=p)return t.value[u]=m,t.value[o]=O,t.value[l]=a,de(e,d,1,2);if([0,2].includes(b.value[2])&&v<=g&&g<=f&&h<=j&&j<=p)return t.value[u]=g,t.value[o]=j,t.value[l]=c,de(e,d,2,2);if(O===j&&h<=O&&O<=p&&m<=i&&i<=g)return t.value[o]=O,t.value[l]=r,e}}}return e},me=function(e,t,n){for(var a="start"===n?1:2,r="start"===n?3:5,c=r+1,l=t.value[r],u=t.value[c],o=l-10,i=l+10,s=u-10,v=u+10,f=e.length-1;f>=0;f--){var h=e[f];if([1,2,3,4,6,7].includes(h.value[0])){var p=h.value[3],d=h.value[4],b=h.value[5],m=h.value[6];if(!(1===h.value[0]&&b-p>Math.abs(m-d))){if("start"===n){if([0,12].includes(h.value[1])&&o<=p&&p<=i&&s<=d&&d<=v)return t.value[r]=p,t.value[c]=d,t.value[a]=2,de(e,f,1,12);if(1===h.value[0]&&[0,13,313,413].includes(h.value[2])&&o<=b&&b<=i&&s<=m&&m<=v)return t.value[r]=b,t.value[c]=m,t.value[a]=2,0===h.value[2]?de(e,f,2,13):e}else{if([0,22].includes(h.value[1])&&o<=p&&p<=i&&s<=d&&d<=v)return t.value[r]=p,t.value[c]=d,t.value[a]=2,de(e,f,1,22);if(1===h.value[0]&&[0,23,24].includes(h.value[2])&&o<=b&&b<=i&&s<=m&&m<=v)return t.value[r]=b,t.value[c]=m,t.value[a]=2,0===h.value[2]?de(e,f,2,23):e}if(p===b&&o<=p&&p<=i&&d<=u&&u<=m)return t.value[r]=p,t.value[a]=2,e}}}return e},Oe=function(e,t){if(1!==t.value[0])return t.value[4]>t.value[6]?e:be(e,t,"start",12,32,22);var n=t.value[3],a=t.value[4],r=t.value[5],c=t.value[6];return r-n>Math.abs(c-a)?me(e,t,"start"):c-a>0?be(e,t,"start",12,32,22):e},ge=function(e){if(1===e.value[0]){var t=e.value[3],n=e.value[4],a=e.value[5]-t,r=e.value[6]-n;Math.abs(a)>20*Math.abs(r)?e.value[6]=n:Math.abs(r)>20*Math.abs(a)&&(e.value[5]=t)}},je=function(e,t){if(1!==t.value[0])return e;var n=t.value[3],a=t.value[4],r=t.value[5],c=t.value[6];return r-n>Math.abs(c-a)?me(e,t,"end"):c-a>0?be(e,t,"end",13,32,23):e},ye=function(e,t){if(1!==t.value[0])return e;var n=t.value[3],a=t.value[4],r=t.value[5],c=t.value[6];if(a!==c)return e;var l=a-10,u=a+10;return e.forEach((function(t,c){if(1===t.value[0]&&0===t.value[2]){var o=t.value[3],i=t.value[4],s=t.value[5],v=t.value[6];s-o>Math.abs(v-i)||l<=v&&v<=u&&n<=s&&s<=r&&(e=de(e,c,2,32),e=de(e,c,6,a))}})),e},Ee=function(e,t,n,r,c){if(1===t.length){var l=e[t[0]];switch(l.value[0]){case 0:case 9:case 99:var u=l.value.slice();switch(n){case a.north:u[4]+=c;break;case a.west:u[3]+=r;break;case a.south:u[6]+=c;break;case a.east:u[5]+=r;break;case a.southeast:u[5]+=r,u[6]+=c}var o=99===l.value[0]?{value:u,partName:l.partName}:{value:u};return e.map((function(e,n){return n===t[0]?o:e}))}}var i=oe(t.map((function(t){return e[t]}))),s=i.slice();switch(n){case a.north:s[1]=Math.min(s[1]+c,s[3]-20);break;case a.west:s[0]=Math.min(s[0]+r,s[2]-20);break;case a.south:s[3]=Math.max(s[3]+c,s[1]+20);break;case a.east:s[2]=Math.max(s[2]+r,s[0]+20);break;case a.southeast:s[2]=Math.max(s[2]+r,s[0]+20),s[3]=Math.max(s[3]+c,s[1]+20)}return z(e,t,i,s)},ke=Object(re.a)([function(e){return e.glyph},function(e){return e.selection},function(e){return e.dragSelection},function(e){return e.dragPoint},function(e){return e.resizeSelection},function(e){return e.freehandStroke}],(function(e,t,n,a,r,c){if(n){var l=Object(E.a)(n,4),u=l[0],o=l[1],i=l[2],s=l[3];e=R(e,t,i-u,s-o)}else if(a){var v=Object(E.a)(a,2),f=v[0],h=Object(E.a)(v[1],4),p=h[0],d=h[1],b=h[2],m=h[3];e=L(e,t,f,b-p,m-d)}else if(r){var O=Object(E.a)(r,2),g=O[0],j=Object(E.a)(O[1],4),y=j[0],k=j[1],S=j[2],M=j[3];e=Ee(e,t,g,S-y,M-k)}else c&&(e=fe(e,c));return e})),Se=function(e){return 99!==e.value[0]?null:[e.value[9],e.value[10],e.value[1],e.value[2]]},Me=function(e,t){if(99!==e.value[0])return e;var n=Object(E.a)(t,4),a=n[0],r=n[1],c=n[2],l=n[3],u=e.value.slice();return u[9]=a,u[10]=r,u[1]=c,u[2]=l,{value:u,partName:e.partName}},we=function(e){var t=Object(E.a)(e,4),n=t[0],a=t[1],r=t[2];return r<=100&&(r+=200,n=a=0),[n,a,r,t[3]]},Ce=function(e,t){var n=Object(E.a)(e,4),a=n[0],r=n[1],c=n[2],l=n[3];if(a===c&&r===l)return 0;var u,o=we(t),i=Object(E.a)(o,4),s=i[0],v=i[1],f=i[2],h=i[3];return s===f-200&&v===h?0:(u=Math.round(Math.abs(a-c)>Math.abs(r-l)?(f-100-a)/(c-a)*20:(h+100-r)/(l-r)*20),Math.max(-10,Math.min(10,u))||0)},Te=[1,2,3,4,6,7],xe={1:[0,2,32,12,22],2:[0,32,12,22,7],3:[0,32,12,22],4:[0,22],6:[0,32,12,22,7],7:[0,32,12,22]},Ne={1:[0,2,32,13,23,4,313,413,24],2:[7,0,8,4,5],3:[0,5],4:[0,5],6:[7,0,8,4,5],7:[7]},Ie=[[1,0,0],[1,0,2],[1,0,32],[1,0,13],[1,0,23],[1,0,4],[1,0,313],[1,0,413],[1,0,24],[1,2,0],[1,2,2],[1,32,0],[1,32,32],[1,32,13],[1,32,23],[1,32,4],[1,32,313],[1,32,413],[1,32,24],[1,12,0],[1,12,32],[1,12,13],[1,12,23],[1,12,313],[1,12,413],[1,12,24],[1,22,0],[1,22,32],[1,22,13],[1,22,23],[1,22,4],[1,22,313],[1,22,413],[1,22,24],[2,0,7],[2,0,5],[2,32,7],[2,32,4],[2,32,5],[2,12,7],[2,22,7],[2,22,4],[2,22,5],[2,7,0],[2,7,8],[2,7,4],[3,0,0],[3,0,5],[3,32,0],[3,32,5],[3,12,0],[3,12,5],[3,22,0],[3,22,5],[4,0,0],[4,0,5],[4,22,0],[4,22,5],[6,0,7],[6,0,5],[6,32,7],[6,32,4],[6,32,5],[6,12,7],[6,22,7],[6,22,4],[6,22,5],[6,7,0],[6,7,8],[6,7,4],[7,0,7],[7,32,7],[7,12,7],[7,22,7]],De=Object(T.a)((function(e){return!Te.includes(e.value[0])||Ie.some((function(t){var n=Object(E.a)(t,3),a=n[0],r=n[1],c=n[2];return a===e.value[0]&&r===e.value[1]&&c===e.value[2]}))})),Pe=function(e,t,n){var a=e.slice();return a[t]=n,a},_e={glyph:h(d.get("data")||""),selection:[],areaSelectRect:null,dragSelection:null,dragPoint:null,resizeSelection:null,freehandStroke:null,ctmInv:null,buhinMap:new Map,stretchParamMap:new Map,freehandMode:!1,showOptionModal:!1,clipboard:[],undoStacks:{undo:[],redo:[]},exiting:!1},Ae=Object(s.reducerWithInitialState)(_e).withHandling((function(e){return e.case(y.selectSingle,(function(e,t){return Object(m.a)(Object(m.a)({},e),{},{selection:[t]})})).case(y.selectAddSingle,(function(e,t){return Object(m.a)(Object(m.a)({},e),{},{selection:e.selection.includes(t)?e.selection:e.selection.concat([t])})})).case(y.selectRemoveSingle,(function(e,t){return Object(m.a)(Object(m.a)({},e),{},{selection:e.selection.filter((function(e){return t!==e}))})})).case(y.selectAll,(function(e){return Object(m.a)(Object(m.a)({},e),{},{selection:e.glyph.map((function(e,t){return t}))})})).case(y.selectDeselected,(function(e){return Object(m.a)(Object(m.a)({},e),{},{selection:e.glyph.map((function(e,t){return t})).filter((function(t){return!e.selection.includes(t)}))})})).case(y.selectNone,(function(e){return Object(m.a)(Object(m.a)({},e),{},{selection:[]})})).case(y.selectPrev,(function(e){if(0===e.glyph.length)return Object(m.a)(Object(m.a)({},e),{},{selection:[]});var t=0===e.selection.length?0:Math.min.apply(Math,Object(b.a)(e.selection));return Object(m.a)(Object(m.a)({},e),{},{selection:[(t-1+e.glyph.length)%e.glyph.length]})})).case(y.selectNext,(function(e){if(0===e.glyph.length)return Object(m.a)(Object(m.a)({},e),{},{selection:[]});var t=0===e.selection.length?-1:Math.max.apply(Math,Object(b.a)(e.selection));return Object(m.a)(Object(m.a)({},e),{},{selection:[(t+1+e.glyph.length)%e.glyph.length]})}))})).withHandling((function(e){return e.case(w.startBackgroundDrag,(function(e,t){if(!e.ctmInv)return e;var n=e.ctmInv(t.clientX,t.clientY),a=Object(E.a)(n,2),r=a[0],c=a[1];return e.freehandMode?Object(m.a)(Object(m.a)({},e),{},{freehandStroke:[[r,c]]}):Object(m.a)(Object(m.a)({},e),{},{areaSelectRect:[r,c,r,c]})})).case(w.startSelectionDrag,(function(e,t){if(!e.ctmInv)return e;var n=e.ctmInv(t.clientX,t.clientY),a=Object(E.a)(n,2),r=a[0],c=a[1];return Object(m.a)(Object(m.a)({},e),{},{dragSelection:[r,c,r,c]})})).case(w.startPointDrag,(function(e,t){var n=Object(E.a)(t,2),a=n[0],r=n[1];if(!e.ctmInv)return e;var c=e.ctmInv(a.clientX,a.clientY),l=Object(E.a)(c,2),u=l[0],o=l[1];return Object(m.a)(Object(m.a)({},e),{},{dragPoint:[r,[u,o,u,o]]})})).case(w.startResize,(function(e,t){var n=Object(E.a)(t,2),a=n[0],r=n[1];if(!e.ctmInv)return e;var c=e.ctmInv(a.clientX,a.clientY),l=Object(E.a)(c,2),u=l[0],o=l[1];return Object(m.a)(Object(m.a)({},e),{},{resizeSelection:[r,[u,o,u,o]]})})).case(w.mouseMove,(function(e,t){if(!e.ctmInv)return e;if(e.areaSelectRect){var n=Object(E.a)(e.areaSelectRect,2),a=n[0],r=n[1],c=e.ctmInv(t.clientX,t.clientY),l=Object(E.a)(c,2),u=l[0],o=l[1];return Object(m.a)(Object(m.a)({},e),{},{areaSelectRect:[a,r,u,o]})}if(e.dragSelection){var i=Object(E.a)(e.dragSelection,2),s=i[0],v=i[1],f=e.ctmInv(t.clientX,t.clientY),h=Object(E.a)(f,2),p=h[0],d=h[1];return Object(m.a)(Object(m.a)({},e),{},{dragSelection:[s,v,p,d]})}if(e.dragPoint){var b=Object(E.a)(e.dragPoint,2),O=b[0],g=Object(E.a)(b[1],2),j=g[0],y=g[1],k=e.ctmInv(t.clientX,t.clientY),S=Object(E.a)(k,2),M=S[0],w=S[1];return Object(m.a)(Object(m.a)({},e),{},{dragPoint:[O,[j,y,M,w]]})}if(e.resizeSelection){var C=Object(E.a)(e.resizeSelection,2),T=C[0],x=Object(E.a)(C[1],2),N=x[0],I=x[1],D=e.ctmInv(t.clientX,t.clientY),P=Object(E.a)(D,2),_=P[0],A=P[1];return Object(m.a)(Object(m.a)({},e),{},{resizeSelection:[T,[N,I,_,A]]})}if(e.freehandStroke){var R=e.ctmInv(t.clientX,t.clientY),L=Object(E.a)(R,2),z=L[0],H=L[1],Y=e.freehandStroke.concat([[z,H]]);if(Y.length>=3){var G=Object(E.a)(Y[Y.length-2],2),X=G[0],U=G[1];Math.abs(z-X)<2&&Math.abs(H-U)<2&&Y.splice(Y.length-2,1)}return Object(m.a)(Object(m.a)({},e),{},{freehandStroke:Y})}return e})).case(w.mouseUp,(function(e,t){if(!e.ctmInv)return e;if(e.areaSelectRect){var n=Object(E.a)(e.areaSelectRect,2),a=n[0],r=n[1],c=e.ctmInv(t.clientX,t.clientY),l=Object(E.a)(c,2),u=l[0],o=l[1],i=function(e,t,n,a,r,c){for(var l=Q(e,t),u=[],o=[[n,a],[n,c],[r,c],[r,a],[n,a]],i=0;i<l.length;i++){l[i].array.some((function(e){var t=e.array.map((function(e){return[e.x,e.y]}));return t.push(t[0]),Object(k.a)(o,t)||Object(k.a)(t,o)||Object(k.b)(o,t)}))&&u.push(i)}return u}(e.glyph,e.buhinMap,a,r,u,o),s=Array.from(new Set(e.selection.concat(i)));return Object(m.a)(Object(m.a)({},e),{},{selection:s,areaSelectRect:null})}if(e.dragSelection){var v=Object(E.a)(e.dragSelection,2),f=v[0],h=v[1],p=e.ctmInv(t.clientX,t.clientY),d=Object(E.a)(p,2),b=d[0],O=d[1],g=R(e.glyph,e.selection,b-f,O-h);return ae(e,Object(m.a)(Object(m.a)({},e),{},{glyph:g,dragSelection:null}))}if(e.dragPoint){var j=Object(E.a)(e.dragPoint,2),y=j[0],S=Object(E.a)(j[1],2),M=S[0],w=S[1],C=e.ctmInv(t.clientX,t.clientY),T=Object(E.a)(C,2),x=T[0],N=T[1],I=L(e.glyph,e.selection,y,x-M,N-w);return ae(e,Object(m.a)(Object(m.a)({},e),{},{glyph:I,dragPoint:null}))}if(e.resizeSelection){var D=Object(E.a)(e.resizeSelection,2),P=D[0],_=Object(E.a)(D[1],2),A=_[0],z=_[1],H=e.ctmInv(t.clientX,t.clientY),Y=Object(E.a)(H,2),G=Y[0],X=Y[1],U=Ee(e.glyph,e.selection,P,G-A,X-z);return ae(e,Object(m.a)(Object(m.a)({},e),{},{glyph:U,resizeSelection:null}))}if(e.freehandStroke){var B=e.ctmInv(t.clientX,t.clientY),F=Object(E.a)(B,2),W=F[0],K=F[1],V=e.freehandStroke.concat([[W,K]]),$=fe(e.glyph,V);return ae(e,Object(m.a)(Object(m.a)({},e),{},{glyph:$,freehandStroke:null}))}return e})).case(w.updateCTMInv,(function(e,t){return Object(m.a)(Object(m.a)({},e),{},{ctmInv:t})}))})).withHandling((function(e){return e.case(G.loadedBuhin,(function(e,t){var n=Object(E.a)(t,2),a=n[0],r=n[1],c=new Map(e.buhinMap);return c.set(a,r),Object(m.a)(Object(m.a)({},e),{},{buhinMap:c})})).case(G.loadedStretchParam,(function(e,t){var n=Object(E.a)(t,2),a=n[0],r=n[1],c=new Map(e.stretchParamMap);return c.set(a,r),Object(m.a)(Object(m.a)({},e),{},{stretchParamMap:c})})).case(G.changeStrokeType,(function(e,t){if(1!==e.selection.length)return e;var n=e.selection[0],a=function(e,t){var n=e.value[0];if(!Te.includes(n)||!Te.includes(t))return e;var a={value:e.value.slice()};a.value[0]=t,xe[t].includes(a.value[1])||(a.value[1]=xe[t][0]),Ne[t].includes(a.value[2])||(a.value[2]=Ne[t][0]);var r=(v(n)-3)/2,c=(v(t)-3)/2;if(r===c)return a;if(2===r&&3===c){var l=a.value[3],u=a.value[4],o=a.value[5],i=a.value[6],s=Math.round((l+o)/2),f=Math.round((u+i)/2);return a.value=a.value.slice(0,3).concat([l,u,s,f,o,i]),a}if(2===r&&4===c){var h=a.value[3],p=a.value[4],d=a.value[5],b=a.value[6],m=Math.round((2*h+d)/3),O=Math.round((2*p+b)/3),g=Math.round((h+2*d)/3),j=Math.round((p+2*b)/3);return a.value=a.value.slice(0,3).concat([h,p,m,O,g,j,d,b]),a}if(3===r&&2===c){var y=a.value[3],E=a.value[4],k=a.value[7],S=a.value[8];return a.value=a.value.slice(0,3).concat([y,E,k,S]),a}if(3===r&&4===c){var M=a.value[3],w=a.value[4],C=a.value[5],T=a.value[6],x=a.value[7],N=a.value[8],I=Math.round((M+2*C)/3),D=Math.round((w+2*T)/3),P=Math.round((x+2*C)/3),_=Math.round((N+2*T)/3);return a.value=a.value.slice(0,3).concat([M,w,I,D,P,_,x,N]),a}if(4===r&&2===c){var A=a.value[3],R=a.value[4],L=a.value[9],z=a.value[10];return a.value=a.value.slice(0,3).concat([A,R,L,z]),a}if(4===r&&3===c){var H=a.value[3],Y=a.value[4],G=a.value[5],X=a.value[6],U=a.value[7],B=a.value[8],F=a.value[9],W=a.value[10],K=Math.round((G+U)/2),V=Math.round((X+B)/2);return a.value=a.value.slice(0,3).concat([H,Y,K,V,F,W]),a}return a}(e.glyph[n],t);return ae(e,Object(m.a)(Object(m.a)({},e),{},{glyph:Pe(e.glyph,n,a)}))})).case(G.changeHeadShapeType,(function(e,t){if(1!==e.selection.length)return e;var n=e.selection[0],a=Object(m.a)(Object(m.a)({},e.glyph[n]),{},{value:e.glyph[n].value.slice()});return a.value[1]=t,ae(e,Object(m.a)(Object(m.a)({},e),{},{glyph:Pe(e.glyph,n,a)}))})).case(G.changeTailShapeType,(function(e,t){if(1!==e.selection.length)return e;var n=e.selection[0],a=Object(m.a)(Object(m.a)({},e.glyph[n]),{},{value:e.glyph[n].value.slice()});return a.value[2]=t,ae(e,Object(m.a)(Object(m.a)({},e),{},{glyph:Pe(e.glyph,n,a)}))})).case(G.changeStretchCoeff,(function(e,t){if(1!==e.selection.length)return e;var n=e.selection[0],a=e.glyph[n];if(!a.partName)return e;var r=e.stretchParamMap.get(a.partName);if(!r)return e;var c=Me(e.glyph[n],function(e,t){var n=Object(E.a)(e,4),a=n[0],r=n[1];return[a-100,r-100,a+(n[2]-a)*t/20+100,r+(n[3]-r)*t/20-100]}(r,t));return ae(e,Object(m.a)(Object(m.a)({},e),{},{glyph:Pe(e.glyph,n,c)}))})).case(G.swapWithPrev,(function(e){if(1!==e.selection.length)return e;var t=e.selection[0];if(0===t)return e;var n=e.glyph.slice();return n[t-1]=e.glyph[t],n[t]=e.glyph[t-1],ae(e,Object(m.a)(Object(m.a)({},e),{},{glyph:n,selection:[t-1]}))})).case(G.swapWithNext,(function(e){if(1!==e.selection.length)return e;var t=e.selection[0];if(t===e.glyph.length-1)return e;var n=e.glyph.slice();return n[t+1]=e.glyph[t],n[t]=e.glyph[t+1],ae(e,Object(m.a)(Object(m.a)({},e),{},{glyph:n,selection:[t+1]}))})).case(G.insertPart,(function(e,t){return ae(e,Object(m.a)(Object(m.a)({},e),{},{glyph:e.glyph.concat([{value:[99,0,0,0,0,200,200,0,0,0],partName:t}]),selection:[e.glyph.length]}))})).case(G.paste,(function(e){return ae(e,Object(m.a)(Object(m.a)({},e),{},{glyph:e.glyph.concat(e.clipboard),selection:e.clipboard.map((function(t,n){return e.glyph.length+n}))}))})).case(G.copy,(function(e){var t=e.selection.map((function(t){return e.glyph[t]})),n=oe(t),a=Object(E.a)(n,2),r=a[0],c=a[1],l=function(e){return 230+e-r},u=function(e){return 20+e-c};return Object(m.a)(Object(m.a)({},e),{},{clipboard:e.selection.map((function(t){return _(e.glyph[t],l,u)}))})})).case(G.cut,(function(e){return ae(e,Object(m.a)(Object(m.a)({},e),{},{glyph:e.glyph.filter((function(t,n){return!e.selection.includes(n)})),clipboard:e.selection.map((function(t){return e.glyph[t]})),selection:[]}))})).case(G.delete,(function(e){return ae(e,Object(m.a)(Object(m.a)({},e),{},{glyph:e.glyph.filter((function(t,n){return!e.selection.includes(n)})),selection:[]}))})).case(G.decomposeSelected,(function(e){var t=[],n=[];return e.glyph.forEach((function(a,r){if(e.selection.includes(r)){var c=function(e,t){if(99!==e.value[0])return[e];var n=t.get(e.partName);if(!n)return[e];var a=!1;V.kBuhin.search=function(e){var n=t.get(e);return"string"!==typeof n?(a=!0,""):n};var r=h(n),c=V.getEachStrokes(p(r)),l=V.getBox(c),u=e.value[3],o=e.value[4],i=e.value[5],s=e.value[6],v=we(Se(e)),f=Object(E.a)(v,4),d=f[0],b=f[1],m=f[2],O=f[3],g=!(d===m-200&&b===O);return g&&a?[e]:r.map((function(e){var t=_(e,(function(e){var t=g?V.stretch(m-200,d,e,l.minX,l.maxX):e;return Math.round(t/200*(i-u)+u)}),(function(e){var t=g?V.stretch(O,b,e,l.minY,l.maxY):e;return Math.round(t/200*(s-o)+o)}));if(!g||99!==t.value[0])return t;var n=we(Se(t)),a=Object(E.a)(n,4),r=a[0],c=a[1],v=a[2],f=a[3];if(r!==v-200||c!==f)return t;var h=t.value[3],p=t.value[4],j=t.value[5],y=t.value[6];if(h===j||p===y)return t;var k=function(e){return(e-h)/(j-h)*200},S=function(e){return(e-p)/(y-p)*200};return Me(t,[k(r+100),S(c+100),k(v-100)+100,S(f+100)])}))}(a,e.buhinMap);n=n.concat(c.map((function(e,n){return t.length+n}))),t=t.concat(c)}else t.push(a)})),ae(e,Object(m.a)(Object(m.a)({},e),{},{glyph:t,selection:n}))})).case(G.moveSelected,(function(e,t){var n=Object(E.a)(t,2),a=n[0],r=n[1];return ae(e,Object(m.a)(Object(m.a)({},e),{},{glyph:R(e.glyph,e.selection,a,r)}))})).case(G.toggleFreehand,(function(e){return Object(m.a)(Object(m.a)({},e),{},{selection:e.freehandMode?e.selection:[],freehandMode:!e.freehandMode})})).case(G.openOptionModal,(function(e){return Object(m.a)(Object(m.a)({},e),{},{showOptionModal:!0})})).case(G.closeOptionModal,(function(e){return Object(m.a)(Object(m.a)({},e),{},{showOptionModal:!1})})).case(G.finishEdit,(function(e){return Object(m.a)(Object(m.a)({},e),{},{exiting:!0})}))})).withHandling((function(e){return e.case(ne.undo,(function(e){return 0===e.undoStacks.undo.length?e:Object(m.a)(Object(m.a)({},e),{},{glyph:e.undoStacks.undo[e.undoStacks.undo.length-1],selection:[],undoStacks:{undo:e.undoStacks.undo.slice(0,-1),redo:e.undoStacks.redo.concat([e.glyph])}})})).case(ne.redo,(function(e){return 0===e.undoStacks.redo.length?e:Object(m.a)(Object(m.a)({},e),{},{glyph:e.undoStacks.redo[e.undoStacks.redo.length-1],selection:[],undoStacks:{undo:e.undoStacks.undo.concat([e.glyph]),redo:e.undoStacks.redo.slice(0,-1)}})}))})),Re=Object(i.b)(Ae),Le=(n(61),function(e){return c.a.createElement(c.a.Fragment,null,e.polygons.array.map((function(e,t){return c.a.createElement("polygon",{key:t,points:e.array.map((function(e){var t=e.x,n=e.y;return"".concat(t,",").concat(n," ")})).join("")})})))}),ze=(n(62),function(e){var t=(e.makeGlyphSeparated||Q)(e.glyph,e.buhinMap),n=e.selection,a=t.map((function(e,t){return t})).filter((function(e){return!n.includes(e)}));return c.a.createElement(c.a.Fragment,null,c.a.createElement("g",{className:"strokes-deselected"},a.map((function(n){return c.a.createElement("g",{key:n,onMouseDown:function(t){var a;return null===(a=e.handleMouseDownDeselectedStroke)||void 0===a?void 0:a.call(e,t,n)}},c.a.createElement(Le,{polygons:t[n]}))}))),c.a.createElement("g",{className:"strokes-selected"},n.map((function(n){return c.a.createElement("g",{key:n,onMouseDown:function(t){var a;return null===(a=e.handleMouseDownSelectedStroke)||void 0===a?void 0:a.call(e,t,n)}},c.a.createElement(Le,{polygons:t[n]}))}))))}),He=(n(63),function(e){if(!e.rect)return null;var t=Object(E.a)(e.rect,4),n=t[0],a=t[1],r=t[2],l=t[3];if(n>r){var u=n;n=r,r=u}if(a>l){var o=a;a=l,l=o}return c.a.createElement("rect",{className:"areaselect-rect",x:n,y:a,width:r-n,height:l-a})});!function(e){e[e.none=0]="none",e[e.online=1]="online",e[e.match=2]="match"}(S||(S={}));var Ye=function(e,t){var n=e[t.lineIndex],a=(v(n.value[0])-3)/2-1;if(0!==t.pointIndex&&t.pointIndex!==a)return S.none;for(var r=n.value[3+2*t.pointIndex],c=n.value[3+2*t.pointIndex+1],l=function(e,t,n,a){return e===n&&e===r&&t<=c&&c<=a||t===a&&t===c&&e<=r&&r<=n},u=S.none,o=0;o<e.length;o++)if(t.lineIndex!==o){var i=e[o];if(![0,9,99].includes(i.value[0])){if(i.value[3]===r&&i.value[4]===c)return S.match;var s=(v(i.value[0])-3)/2-1;if(i.value[3+2*s]===r&&i.value[3+2*s+1]===c)return S.match;switch(i.value[0]){case 3:case 4:(l(i.value[3],i.value[4],i.value[5],i.value[6])||l(i.value[5],i.value[6],i.value[7],i.value[8]))&&(u=S.online);break;case 1:case 7:l(i.value[3],i.value[4],i.value[5],i.value[6])&&(u=S.online)}}}return u},Ge=(n(64),function(e){return c.a.createElement("rect",{x:e.x-4,y:e.y-4,width:8,height:8,className:"controlpoint-rect ".concat(e.className||""),onMouseDown:e.handleMouseDown})}),Xe=(n(65),Object(re.a)([ke,function(e){return e.selection}],(function(e,t){if(0===t.length)return{rectControl:null,pointControl:[]};if(t.length>1){var n=t.map((function(t){return e[t]}));return{rectControl:{multiSelect:!0,coords:oe(n)},pointControl:[]}}var a=e[t[0]];switch(a.value[0]){case 0:case 9:case 99:return{rectControl:{multiSelect:!1,coords:[a.value[3],a.value[4],a.value[5],a.value[6]]},pointControl:[]};case 1:case 2:case 3:case 4:case 6:case 7:for(var r=[],c=3;c+2<=a.value.length;c+=2){var l=Ye(e,{lineIndex:t[0],pointIndex:(c-3)/2}),u="";l===S.match?u="match":l===S.online&&(u="online"),r.push({x:a.value[c],y:a.value[c+1],className:u})}return{rectControl:null,pointControl:r};default:return{rectControl:null,pointControl:[]}}}))),Ue=function(){var e=Object(o.d)(Xe),t=e.rectControl,n=e.pointControl,l=Object(o.c)(),u=Object(r.useCallback)((function(e,t){l(w.startResize([e,t])),e.stopPropagation()}),[l]),i=Object(r.useCallback)((function(e){return u(e,a.north)}),[u]),s=Object(r.useCallback)((function(e){return u(e,a.west)}),[u]),v=Object(r.useCallback)((function(e){return u(e,a.south)}),[u]),f=Object(r.useCallback)((function(e){return u(e,a.east)}),[u]),h=Object(r.useCallback)((function(e){return u(e,a.southeast)}),[u]),p=Object(r.useMemo)((function(){return n.map((function(e,t){return function(e){l(w.startPointDrag([e,t])),e.stopPropagation()}}))}),[l,n]);return c.a.createElement(c.a.Fragment,null,t&&c.a.createElement(c.a.Fragment,null,c.a.createElement("rect",{className:"selection-rect",x:t.coords[0],y:t.coords[1],width:t.coords[2]-t.coords[0],height:t.coords[3]-t.coords[1]}),c.a.createElement(Ge,{x:(t.coords[0]+t.coords[2])/2,y:t.coords[1],className:"north",handleMouseDown:i}),c.a.createElement(Ge,{x:t.coords[0],y:(t.coords[1]+t.coords[3])/2,className:"west",handleMouseDown:s}),c.a.createElement(Ge,{x:(t.coords[0]+t.coords[2])/2,y:t.coords[3],className:"south",handleMouseDown:v}),c.a.createElement(Ge,{x:t.coords[2],y:(t.coords[1]+t.coords[3])/2,className:"east",handleMouseDown:f}),c.a.createElement(Ge,{x:t.coords[2],y:t.coords[3],className:"southeast",handleMouseDown:h})),n.map((function(e,t){var n=e.x,a=e.y,r=e.className;return c.a.createElement(Ge,{key:t,x:n,y:a,className:r,handleMouseDown:p[t]})})))},Be=(n(66),function(){var e=Object(o.d)(ke),t=Object(o.d)((function(e){return e.buhinMap})),n=Object(o.d)((function(e){return e.selection})),a=Object(o.d)((function(e){return e.areaSelectRect})),l=Object(o.d)((function(e){return e.freehandMode}))?"freehand":"",u=Object(o.c)(),i=Object(r.useCallback)((function(e){var t=e.currentTarget.getScreenCTM();if(t){var n=e.currentTarget.createSVGPoint(),a=t.inverse();u(w.updateCTMInv((function(e,t){n.x=e,n.y=t;var r=n.matrixTransform(a);return[r.x,r.y]})))}}),[u]),s=Object(r.useCallback)((function(e){e.shiftKey||e.ctrlKey||u(y.selectNone()),u(w.startBackgroundDrag(e))}),[u]),v=Object(r.useCallback)((function(e,t){e.shiftKey||e.ctrlKey?u(y.selectAddSingle(t)):u(y.selectSingle(t)),u(w.startSelectionDrag(e)),e.stopPropagation()}),[u]),f=Object(r.useCallback)((function(e,t){(e.shiftKey||e.ctrlKey)&&u(y.selectRemoveSingle(t)),u(w.startSelectionDrag(e)),e.stopPropagation()}),[u]);return Object(r.useEffect)((function(){var e=function(e){u(w.mouseMove(e))},t=function(e){u(w.mouseUp(e))};return document.addEventListener("mousemove",e),document.addEventListener("mouseup",t),function(){document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t)}}),[u]),c.a.createElement("div",{className:"glyph-area"},c.a.createElement("svg",{width:"100%",height:"100%",viewBox:"-20 -20 500 240",className:l,onMouseDownCapture:i,onMouseDown:s},c.a.createElement("rect",{x:"0",y:"0",width:"200",height:"200",className:"glyph-boundary"}),c.a.createElement("rect",{x:"12",y:"12",width:"176",height:"176",className:"glyph-guide"}),c.a.createElement(ze,{glyph:e,buhinMap:t,selection:n,handleMouseDownDeselectedStroke:v,handleMouseDownSelectedStroke:f}),c.a.createElement(Ue,null),c.a.createElement(He,{rect:a})))}),Fe=n(78),We=(n(67),Object(re.a)([function(e){return e.selection},ke],(function(e,t){return 1!==e.length?null:t[e[0]]}))),Ke=Object(re.a)([We],(function(e){if(!e)return null;if(!Te.includes(e.value[0]))return null;for(var t=[],n=3;n+2<=e.value.length;n+=2)t.push("(".concat(e.value[n],",").concat(e.value[n+1],")"));return{strokeType:e.value[0],headShapeType:e.value[1],tailShapeType:e.value[2],validTypes:De(e),coordString:t.join(" \u2192 ")}})),Ve=Object(re.a)([We,function(e){return e.buhinMap},function(e){return e.stretchParamMap}],(function(e,t,n){if(!e)return null;if(99!==e.value[0])return null;var a=e.partName,r=t.get(a),c=null;if(r){var l=/^(?:0:1:0:[^$]+\$)?99:0:0:0:0:200:200:([^$]+)$/.exec(r);l&&(c=l[1])}var u=n.get(a),o=u?Ce(u,Se(e)):null;return{partName:a,entityName:c,coordString:"(".concat(e.value[3],",").concat(e.value[4],") \u2192 (").concat(e.value[5],",").concat(e.value[6],")"),stretchCoeff:o}})),$e=Object(re.a)([function(e){return e.selection},We],(function(e,t){if(e.length>1)return{isMultiple:!0};if(0===e.length)return{isMultiple:!1};var n=t,a=n.value[0];if(Te.includes(a)||99===a)return null;for(var r=[],c=3;c+2<=n.value.length;c+=2)r.push("(".concat(n.value[c],",").concat(n.value[c+1],")"));return{isMultiple:!1,coordString:r.join(" \u2192 ")}})),qe=Object(re.a)([function(e){return e.glyph.length},function(e){return e.selection}],(function(e,t){var n=t.map((function(e){return e+1})).sort((function(e,t){return e-t})).join(",");return"".concat(n||"-"," / ").concat(e||"-")})),Je=Object(re.a)([function(e){return e.glyph.length},function(e){return e.selection}],(function(e,t){return{swapPrevDisabled:1!==t.length||0===t[0],swapNextDisabled:1!==t.length||t[0]===e-1,selectPrevDisabled:0===e,selectNextDisabled:0===e}})),Ze=function(){var e=Object(o.d)(Ke),t=Object(o.d)(Ve),n=Object(o.d)($e),a=Object(o.d)(qe),l=Object(o.d)(Je,o.b),u=l.swapPrevDisabled,i=l.swapNextDisabled,s=l.selectPrevDisabled,v=l.selectNextDisabled,f=Object(o.c)(),h=Object(r.useCallback)((function(e){f(G.changeStrokeType(+e.currentTarget.value))}),[f]),p=Object(r.useCallback)((function(e){f(G.changeHeadShapeType(+e.currentTarget.value))}),[f]),d=Object(r.useCallback)((function(e){f(G.changeTailShapeType(+e.currentTarget.value))}),[f]),b=Object(r.useCallback)((function(e){f(G.changeStretchCoeff(+e.currentTarget.value))}),[f]),m=Object(r.useCallback)((function(){f(y.selectPrev())}),[f]),O=Object(r.useCallback)((function(){f(y.selectNext())}),[f]),g=Object(r.useCallback)((function(){f(G.swapWithPrev())}),[f]),j=Object(r.useCallback)((function(){f(G.swapWithNext())}),[f]),E=Object(Fe.a)().t;return c.a.createElement("div",{className:"select-control"},c.a.createElement("div",{className:"selected-info"},e&&c.a.createElement(c.a.Fragment,null,c.a.createElement("div",null,E("stroke type"),c.a.createElement("select",{value:e.strokeType,onChange:h},Te.map((function(e){return c.a.createElement("option",{key:e,value:e},E("stroke type ".concat(e)))})))," ",E("head type"),c.a.createElement("select",{value:e.headShapeType,onChange:p},xe[e.strokeType].map((function(t){return c.a.createElement("option",{key:t,value:t},E("head type ".concat(e.strokeType,"-").concat(t)))})))," ",E("tail type"),c.a.createElement("select",{value:e.tailShapeType,onChange:d},Ne[e.strokeType].map((function(t){return c.a.createElement("option",{key:t,value:t},E("tail type ".concat(e.strokeType,"-").concat(t)))})))," ",!e.validTypes&&c.a.createElement("span",{className:"alert"},E("invalid stroke shape types"))),c.a.createElement("div",null,e.coordString)),t&&c.a.createElement(c.a.Fragment,null,c.a.createElement("div",null,E("part")," ",c.a.createElement("strong",null,t.partName)," ",t.entityName&&E("alias of",{entity:t.entityName})),c.a.createElement("div",null,t.coordString),null!==t.stretchCoeff&&c.a.createElement("div",null,E("stretch")," ",c.a.createElement("input",{type:"range",min:-10,max:10,value:t.stretchCoeff,onChange:b})," ",t.stretchCoeff)),n&&c.a.createElement(c.a.Fragment,null,n.isMultiple&&c.a.createElement("div",null,E("selecting multiple strokes")),n.coordString&&c.a.createElement("div",null,n.coordString))),c.a.createElement("div",{className:"selection-control"},c.a.createElement("button",{disabled:u,onClick:g},E("swap with prev")),c.a.createElement("button",{className:"select-prevnext-button",disabled:s,onClick:m},E("select prev")),c.a.createElement("div",{className:"selection-num"},a),c.a.createElement("button",{className:"select-prevnext-button",disabled:v,onClick:O},E("select next")),c.a.createElement("button",{disabled:i,onClick:j},E("swap with next"))))},Qe=Object(re.a)([ke],(function(e){return e.filter((function(e){return le(e)[0]<200}))})),et=function(){var e=Object(o.d)(Qe),t=Object(o.d)((function(e){return e.buhinMap}));return c.a.createElement("svg",{className:"preview-thumbnail",viewBox:"0 0 200 200",width:"50",height:"50"},c.a.createElement(ze,{buhinMap:t,glyph:e,selection:[],makeGlyphSeparated:ee}))},tt=(n(73),function(){var e=Object(o.d)((function(e){return e.glyph})),t=Object(o.d)((function(e){return e.selection})),n=Object(o.d)((function(e){return e.clipboard})),a=Object(o.d)((function(e){return e.freehandMode})),l=0===Object(o.d)((function(e){return e.undoStacks.undo.length})),u=0===Object(o.d)((function(e){return e.undoStacks.redo.length})),i=0===n.length,s=!t.some((function(t){return 99===e[t].value[0]})),v=Object(o.c)(),f=Object(r.useCallback)((function(){v(ne.undo())}),[v]),h=Object(r.useCallback)((function(){v(ne.redo())}),[v]),p=Object(r.useCallback)((function(){v(y.selectAll())}),[v]),d=Object(r.useCallback)((function(){v(y.selectDeselected())}),[v]),b=Object(r.useCallback)((function(){v(G.copy())}),[v]),m=Object(r.useCallback)((function(){v(G.paste())}),[v]),O=Object(r.useCallback)((function(){v(G.cut())}),[v]),g=Object(r.useCallback)((function(){v(G.toggleFreehand())}),[v]),j=Object(r.useCallback)((function(){v(G.decomposeSelected())}),[v]),E=Object(r.useCallback)((function(){v(G.openOptionModal())}),[v]),k=Object(r.useCallback)((function(){v(G.finishEdit())}),[v]),S=Object(Fe.a)().t;return c.a.createElement("div",{className:"editor-controls"},c.a.createElement(Ze,null),c.a.createElement("div",{className:"control-buttons"},c.a.createElement("button",{disabled:l,onClick:f},S("undo")),c.a.createElement("button",{disabled:u,onClick:h},S("redo")),c.a.createElement("button",{disabled:a||0===e.length,onClick:p},S("select all")),c.a.createElement("button",{disabled:a||0===e.length,onClick:d},S("invert selection")),c.a.createElement("button",{disabled:0===t.length,onClick:b},S("copy")),c.a.createElement("button",{disabled:i,onClick:m},S("paste")),c.a.createElement("button",{disabled:0===t.length,onClick:O},S("cut")),c.a.createElement("button",{onClick:g},S(a?"end freehand":"start freehand")),c.a.createElement("button",{disabled:s,onClick:j},S("decompose")),c.a.createElement("button",{disabled:!0,onClick:E},S("options"))),c.a.createElement("div",{className:"preview"},c.a.createElement(et,null),c.a.createElement("button",{onClick:k},S("finish edit"))))}),nt=n(37),at=n(38),rt=n(40),ct=n(41),lt=(n(74),n(75),function(e){return"https://glyphwiki.org/glyph/".concat(e,".50px.png")}),ut=function(e){var t=e.handleItemClick,n=e.handleItemMouseEnter,a=Object(r.useCallback)((function(e){var n=e.currentTarget.dataset.name;t(n,e)}),[t]),l=Object(r.useCallback)((function(e){var t=e.currentTarget.dataset.name;n(t,e)}),[n]);return c.a.createElement("div",{className:"parts-list"},e.names.map((function(e){return c.a.createElement("img",{key:e,alt:e,title:e,"data-name":e,src:lt(e),width:50,height:50,onClick:a,onMouseEnter:l})})))},ot=["\u30a8\u30c7\u30a3\u30bf\u90e8\u54c11","\u30a8\u30c7\u30a3\u30bf\u90e8\u54c12","\u30a8\u30c7\u30a3\u30bf\u90e8\u54c13","\u30a8\u30c7\u30a3\u30bf\u90e8\u54c14"],it=d.get("name")||"",st=function(e){Object(at.a)(n,e);var t=Object(rt.a)(n);function n(){return Object(nt.a)(this,n),t.apply(this,arguments)}return n}(Object(ct.a)(Error)),vt=function(){var e=Object(r.useRef)(null),t=Object(r.useState)(!1),n=Object(E.a)(t,2),a=n[0],l=n[1],u=Object(r.useState)([]),i=Object(E.a)(u,2),s=i[0],v=i[1],f=Object(r.useState)(null),h=Object(E.a)(f,2),p=h[0],d=h[1],b=function(e){l(!0),K(e).then((function(e){if("tooshort"===e)throw new st("query too short");return"nodata"===e?[]:e.split("\t")})).then((function(e){l(!1),v(e)})).catch((function(e){l(!1),d(e)}))};Object(r.useEffect)((function(){it&&b(it)}),[]);var m=Object(r.useCallback)((function(){if(e.current){var t=e.current.value;t?b(t):v([])}}),[]),O=Object(r.useCallback)((function(e){e.preventDefault(),m()}),[m]),g=Object(r.useRef)(null),j=Object(r.useCallback)((function(e){g.current&&(g.current.textContent=e)}),[]),y=Object(o.c)(),k=Object(r.useCallback)((function(t,n){if(n.shiftKey){if(!e.current)return;e.current.value=t,b(t)}else y(G.insertPart(t))}),[y]),S=Object(Fe.a)().t;return c.a.createElement("div",{className:"parts-search-area"},c.a.createElement("form",{className:"parts-search-box",onSubmit:O},c.a.createElement("input",{defaultValue:it,list:"searchList",ref:e}),c.a.createElement("button",{onClick:m},S("search")),c.a.createElement("datalist",{id:"searchList"},ot.map((function(e,t){return c.a.createElement("option",{key:t,value:e})})))),c.a.createElement("div",{className:"parts-list-area"},a?c.a.createElement("div",{className:"message"},S("searching")):p?p instanceof st?c.a.createElement("div",{className:"message"},S("search query too short")):c.a.createElement("div",{className:"message"},S("search error",{message:p})):0===s.length?c.a.createElement("div",{className:"message"},S("no search result")):c.a.createElement(ut,{names:s,handleItemClick:k,handleItemMouseEnter:j})),c.a.createElement("div",{className:"parts-hover-name",ref:g},"\xa0"))},ft=d.get("host"),ht="false"!==d.get("ssl"),pt=d.get("name")||"sandbox",dt=d.get("related")||"u3013",bt=d.get("edittime"),mt=d.get("summary")||"";ft&&["glyphwiki.org","en.glyphwiki.org","ko.glyphwiki.org","zhs.glyphwiki.org","zht.glyphwiki.org"].includes(ft)||(ft="glyphwiki.org");var Ot="".concat(ht?"https":"http","://").concat(ft,"/wiki/").concat(encodeURIComponent(pt),"?action=preview"),gt=function(){var e=Object(o.d)((function(e){return e.exiting})),t=Object(r.useRef)(null);Object(r.useLayoutEffect)((function(){var n;e&&(null===(n=t.current)||void 0===n||n.submit())}),[e]);var n=Object(o.d)(Qe);return c.a.createElement("form",{style:{visibility:"hidden",position:"absolute"},ref:t,action:Ot,method:"post"},c.a.createElement("input",{type:"hidden",name:"page",value:pt}),c.a.createElement("input",{type:"hidden",name:"action",value:"preview"}),c.a.createElement("input",{type:"hidden",name:"textbox",value:p(n)}),c.a.createElement("input",{type:"hidden",name:"related",value:dt}),c.a.createElement("input",{type:"hidden",name:"summary",value:mt}),bt&&c.a.createElement("input",{type:"hidden",name:"edittime",value:bt}))},jt=n(4);var yt=function(){return function(){var e=Object(o.c)();Object(jt.a)("ctrl+a, command+a",(function(t){e(y.selectAll()),t.preventDefault()}),{},[e]),Object(jt.a)("ctrl+i, command+i",(function(t){e(y.selectDeselected()),t.preventDefault()}),{},[e]),Object(jt.a)("ctrl+z, command+z",(function(t){e(ne.undo()),t.preventDefault()}),{},[e]),Object(jt.a)("ctrl+y, command+y, ctrl+shift+z, command+shift+z",(function(t){e(ne.redo()),t.preventDefault()}),{},[e]),Object(jt.a)("ctrl+x, command+x",(function(t){e(G.cut()),t.preventDefault()}),{},[e]),Object(jt.a)("ctrl+c, command+c",(function(t){e(G.copy()),t.preventDefault()}),{},[e]),Object(jt.a)("ctrl+v, command+v",(function(t){e(G.paste()),t.preventDefault()}),{},[e]),Object(jt.a)("del",(function(t){e(G.delete()),t.preventDefault()}),{},[e]),Object(jt.a)("del",(function(t){e(G.delete()),t.preventDefault()}),{},[e]),Object(jt.a)("ctrl+h, left",(function(t){e(G.moveSelected([-1,0])),t.preventDefault()}),{},[e]),Object(jt.a)("ctrl+j, down",(function(t){e(G.moveSelected([0,1])),t.preventDefault()}),{},[e]),Object(jt.a)("ctrl+k, up",(function(t){e(G.moveSelected([0,-1])),t.preventDefault()}),{},[e]),Object(jt.a)("ctrl+l, right",(function(t){e(G.moveSelected([1,0])),t.preventDefault()}),{},[e]),Object(jt.a)("ctrl+shift+h, shift+left",(function(t){e(G.moveSelected([-5,0])),t.preventDefault()}),{},[e]),Object(jt.a)("ctrl+shift+j, shift+down",(function(t){e(G.moveSelected([0,5])),t.preventDefault()}),{},[e]),Object(jt.a)("ctrl+shift+k, shift+up",(function(t){e(G.moveSelected([0,-5])),t.preventDefault()}),{},[e]),Object(jt.a)("ctrl+shift+l, shift+right",(function(t){e(G.moveSelected([5,0])),t.preventDefault()}),{},[e])}(),c.a.createElement("div",{className:"App"},c.a.createElement(Be,null),c.a.createElement(tt,null),c.a.createElement(vt,null),c.a.createElement(gt,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Et=n(27),kt=n(17),St={ja:{translation:n(39)}},Mt=d.get("host"),wt="ja";if(Mt)switch(Mt.split(".")[0]){case"en":wt="en";break;case"ko":wt="ko";break;case"zhs":wt="zh-Hans";break;case"zht":wt="zh-Hant"}Et.a.use(kt.e).init({resources:St,lng:wt,returnObjects:!0,interpolation:{escapeValue:!1}});Et.a,n(76);u.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(o.a,{store:Re},c.a.createElement(yt,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[42,1,2]]]);
//# sourceMappingURL=main.1849c241.chunk.js.map